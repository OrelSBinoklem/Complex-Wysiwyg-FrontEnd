{"version":3,"sources":["js/nested-sortable/jquery.mjs.nestedSortable.js"],"names":["$","widget","extend","ui","sortable","prototype","options","tabSize","disableNesting","errorClass","doNotClear","listType","maxLevels","protectRoot","rootID","rtl","isAllowed","item","parent","_create","this","element","data","is","Error","apply","arguments","destroy","removeData","unbind","_mouseDrag","event","position","_generatePosition","positionAbs","_convertPositionTo","lastPositionAbs","o","scroll","scrolled","scrollParent","document","tagName","overflowOffset","top","offsetHeight","pageY","scrollSensitivity","scrollTop","scrollSpeed","left","offsetWidth","pageX","scrollLeft","window","height","width","ddmanager","dropBehaviour","prepareOffsets","previousTopOffset","placeholder","offset","axis","helper","style","i","items","length","itemElement","intersection","_intersectsWithPointer","currentItem","contains","type","mouseenter","direction","tolerance","_intersectsWithSides","mouseleave","_rearrange","_clearEmpty","_trigger","_uiHash","parentItem","parentNode","closest","level","_getLevel","childLevels","_getChildLevels","previousItem","previousSibling","nodeName","toLowerCase","nextItem","nextSibling","newList","createElement","beyondMaxLevels","outerWidth","after","_isAllowed","children","appendChild","prepend","_contactContainers","drag","_mouseStop","noPropagation","removeClass","domPosition","prev","serialize","_getItemsAsjQuery","connected","str","each","res","attr","attribute","match","expression","pid","push","key","join","toHierarchy","_recursiveItems","id","ret","startDepthCount","toArray","_recursiveArray","depth","right","sDepth","item_id","parent_id","sort","a","b","emptyList","remove","list","self","result","index","child","Math","max","levels","isRoot","hasClass","nestedSortable","addClass","mjs","jQuery"],"mappings":"CAaA,SAAUA,GAETA,EAAEC,OAAO,qBAAsBD,EAAEE,UAAWF,EAAEG,GAAGC,SAASC,WAEzDC,SACCC,QAAS,GACTC,eAAgB,gCAChBC,WAAY,2BACZC,YAAY,EACZC,SAAU,KACVC,UAAW,EACXC,aAAa,EACbC,OAAQ,KACRC,KAAK,EACLC,UAAW,SAASC,EAAMC,GAAU,OAAO,IAG5CC,QAAS,WAGR,GAFAC,KAAKC,QAAQC,KAAK,WAAYF,KAAKC,QAAQC,KAAK,oBAE3CF,KAAKC,QAAQE,GAAGH,KAAKd,QAAQK,UACjC,KAAM,IAAIa,OAAM,mFAEjB,OAAOxB,GAAEG,GAAGC,SAASC,UAAUc,QAAQM,MAAML,KAAMM,YAGpDC,QAAS,WAIR,MAHAP,MAAKC,QACHO,WAAW,kBACXC,OAAO,mBACF7B,EAAEG,GAAGC,SAASC,UAAUsB,QAAQF,MAAML,KAAMM,YAGpDI,WAAY,SAASC,GAGpBX,KAAKY,SAAWZ,KAAKa,kBAAkBF,GACvCX,KAAKc,YAAcd,KAAKe,mBAAmB,YAEtCf,KAAKgB,kBACThB,KAAKgB,gBAAkBhB,KAAKc,YAG7B,IAAIG,GAAIjB,KAAKd,OAGb,IAAGc,KAAKd,QAAQgC,OAAQ,CACvB,GAAIC,IAAW,CACZnB,MAAKoB,aAAa,IAAMC,UAA4C,QAAhCrB,KAAKoB,aAAa,GAAGE,SAEvDtB,KAAKuB,eAAeC,IAAMxB,KAAKoB,aAAa,GAAGK,aAAgBd,EAAMe,MAAQT,EAAEU,kBAClF3B,KAAKoB,aAAa,GAAGQ,UAAYT,EAAWnB,KAAKoB,aAAa,GAAGQ,UAAYX,EAAEY,YACxElB,EAAMe,MAAQ1B,KAAKuB,eAAeC,IAAMP,EAAEU,oBACjD3B,KAAKoB,aAAa,GAAGQ,UAAYT,EAAWnB,KAAKoB,aAAa,GAAGQ,UAAYX,EAAEY,aAE5E7B,KAAKuB,eAAeO,KAAO9B,KAAKoB,aAAa,GAAGW,YAAepB,EAAMqB,MAAQf,EAAEU,kBAClF3B,KAAKoB,aAAa,GAAGa,WAAad,EAAWnB,KAAKoB,aAAa,GAAGa,WAAahB,EAAEY,YAC1ElB,EAAMqB,MAAQhC,KAAKuB,eAAeO,KAAOb,EAAEU,oBAClD3B,KAAKoB,aAAa,GAAGa,WAAad,EAAWnB,KAAKoB,aAAa,GAAGa,WAAahB,EAAEY,eAI/ElB,EAAMe,MAAQ9C,EAAEyC,UAAUO,YAAcX,EAAEU,kBAC5CR,EAAWvC,EAAEyC,UAAUO,UAAUhD,EAAEyC,UAAUO,YAAcX,EAAEY,aACtDjD,EAAEsD,QAAQC,UAAYxB,EAAMe,MAAQ9C,EAAEyC,UAAUO,aAAeX,EAAEU,oBACxER,EAAWvC,EAAEyC,UAAUO,UAAUhD,EAAEyC,UAAUO,YAAcX,EAAEY,cAE3DlB,EAAMqB,MAAQpD,EAAEyC,UAAUY,aAAehB,EAAEU,kBAC7CR,EAAWvC,EAAEyC,UAAUY,WAAWrD,EAAEyC,UAAUY,aAAehB,EAAEY,aACxDjD,EAAEsD,QAAQE,SAAWzB,EAAMqB,MAAQpD,EAAEyC,UAAUY,cAAgBhB,EAAEU,oBACxER,EAAWvC,EAAEyC,UAAUY,WAAWrD,EAAEyC,UAAUY,aAAehB,EAAEY,eAI9DV,KAAa,GAASvC,EAAEG,GAAGsD,YAAcpB,EAAEqB,eAC7C1D,EAAEG,GAAGsD,UAAUE,eAAevC,KAAMW,GAItCX,KAAKc,YAAcd,KAAKe,mBAAmB,WAGxC,IAAIyB,GAAoBxC,KAAKyC,YAAYC,SAASlB,GAGjDxB,MAAKd,QAAQyD,MAA6B,KAArB3C,KAAKd,QAAQyD,OAAa3C,KAAK4C,OAAO,GAAGC,MAAMf,KAAO9B,KAAKY,SAASkB,KAAK,MAC9F9B,KAAKd,QAAQyD,MAA6B,KAArB3C,KAAKd,QAAQyD,OAAa3C,KAAK4C,OAAO,GAAGC,MAAMrB,IAAMxB,KAAKY,SAASY,IAAI,KAGhG,KAAK,GAAIsB,GAAI9C,KAAK+C,MAAMC,OAAS,EAAGF,GAAK,EAAGA,IAAK,CAGhD,GAAIjD,GAAOG,KAAK+C,MAAMD,GAAIG,EAAcpD,EAAKA,KAAK,GAAIqD,EAAelD,KAAKmD,uBAAuBtD,EACjG,IAAKqD,KAEFD,GAAejD,KAAKoD,YAAY,IAC/BpD,KAAKyC,YAA4B,GAAhBS,EAAoB,OAAS,UAAU,IAAMD,GAC7DrE,EAAEyE,SAASrD,KAAKyC,YAAY,GAAIQ,IACX,gBAArBjD,KAAKd,QAAQoE,MAA0B1E,EAAEyE,SAASrD,KAAKC,QAAQ,GAAIgD,IAEtE,CAMD,GAJArE,EAAEqE,GAAaM,aAEfvD,KAAKwD,UAA4B,GAAhBN,EAAoB,OAAS,KAEhB,WAA1BlD,KAAKd,QAAQuE,YAA0BzD,KAAK0D,qBAAqB7D,GAIpE,KAHAjB,GAAEqE,GAAaU,aACf3D,KAAK4D,WAAWjD,EAAOd,GAMxBG,KAAK6D,YAAYZ,GAEjBjD,KAAK8D,SAAS,SAAUnD,EAAOX,KAAK+D,UACpC,QAIF,GAAIC,GAAchE,KAAKyC,YAAY,GAAGwB,WAAWA,YAC5CrF,EAAEoB,KAAKyC,YAAY,GAAGwB,WAAWA,YAAYC,QAAQ,gBAAgBlB,OAC7DpE,EAAEoB,KAAKyC,YAAY,GAAGwB,WAAWA,YACjC,KACTE,EAAQnE,KAAKoE,UAAUpE,KAAKyC,aAC5B4B,EAAcrE,KAAKsE,gBAAgBtE,KAAK4C,QAGxC2B,EAAevE,KAAKyC,YAAY,GAAG+B,gBAAkB5F,EAAEoB,KAAKyC,YAAY,GAAG+B,iBAAmB,IAClG,IAAoB,MAAhBD,EACH,KAAiD,MAA1CA,EAAa,GAAGE,SAASC,eAAyBH,EAAa,IAAMvE,KAAKoD,YAAY,IAAMmB,EAAa,IAAMvE,KAAK4C,OAAO,IAAI,CACrI,IAAI2B,EAAa,GAAGC,gBAEb,CACND,EAAe,IACf,OAHAA,EAAe3F,EAAE2F,EAAa,GAAGC,iBASjC,GAAIG,GAAW3E,KAAKyC,YAAY,GAAGmC,YAAchG,EAAEoB,KAAKyC,YAAY,GAAGmC,aAAe,IACtF,IAAgB,MAAZD,EACF,KAA6C,MAAtCA,EAAS,GAAGF,SAASC,eAAyBC,EAAS,IAAM3E,KAAKoD,YAAY,IAAMuB,EAAS,IAAM3E,KAAK4C,OAAO,IAAI,CACxH,IAAI+B,EAAS,GAAGC,YAET,CACLD,EAAW,IACX,OAHAA,EAAW/F,EAAE+F,EAAS,GAAGC,aAQlC,GAAIC,GAAUxD,SAASyD,cAAc7D,EAAE1B,SA4CvC,OA1CAS,MAAK+E,gBAAkB,EAGL,MAAdf,GAAkC,MAAZW,IACvB1D,EAAEtB,KAAQK,KAAKc,YAAYgB,KAAO9B,KAAK4C,OAAOoC,aAAehB,EAAWtB,SAASZ,KAAOkC,EAAWgB,eACnG/D,EAAEtB,KAAQK,KAAKc,YAAYgB,KAAOkC,EAAWtB,SAASZ,OACxDkC,EAAWiB,MAAMjF,KAAKyC,YAAY,IAClCzC,KAAK6D,YAAYG,EAAW,IAC5BhE,KAAK8D,SAAS,SAAUnD,EAAOX,KAAK+D,YAGZ,MAAhBQ,IACLtD,EAAEtB,KAAQK,KAAKc,YAAYgB,KAAO9B,KAAK4C,OAAOoC,aAAeT,EAAa7B,SAASZ,KAAOyC,EAAaS,aAAe/D,EAAE9B,UACxH8B,EAAEtB,KAAQK,KAAKc,YAAYgB,KAAOyC,EAAa7B,SAASZ,KAAOb,EAAE9B,UACpEa,KAAKkF,WAAWX,EAAcJ,EAAOA,EAAME,EAAY,GAClDE,EAAaY,SAASlE,EAAE1B,UAAUyD,QACtCuB,EAAa,GAAGa,YAAYP,GAGrBrC,GAAsBA,GAAqB+B,EAAa7B,SAASlB,IACnE+C,EAAaY,SAASlE,EAAE1B,UAAU8F,QAAQrF,KAAKyC,aAInD8B,EAAaY,SAASlE,EAAE1B,UAAU,GAAG6F,YAAYpF,KAAKyC,YAAY,IAEpEzC,KAAK8D,SAAS,SAAUnD,EAAOX,KAAK+D,YAGpC/D,KAAKkF,WAAWlB,EAAYG,EAAOA,EAAME,GAI1CrE,KAAKsF,mBAAmB3E,GAGrB/B,EAAEG,GAAGsD,WAAWzD,EAAEG,GAAGsD,UAAUkD,KAAKvF,KAAMW,GAG7CX,KAAK8D,SAAS,OAAQnD,EAAOX,KAAK+D,WAElC/D,KAAKgB,gBAAkBhB,KAAKc,aACrB,GAIR0E,WAAY,SAAS7E,EAAO8E,GAGvBzF,KAAK+E,kBAER/E,KAAKyC,YAAYiD,YAAY1F,KAAKd,QAAQG,YAEtCW,KAAK2F,YAAYC,KACpBhH,EAAEoB,KAAK2F,YAAYC,MAAMX,MAAMjF,KAAKyC,aAEpC7D,EAAEoB,KAAK2F,YAAY7F,QAAQuF,QAAQrF,KAAKyC,aAGzCzC,KAAK8D,SAAS,SAAUnD,EAAOX,KAAK+D,WAKrC,KAAK,GAAIjB,GAAI9C,KAAK+C,MAAMC,OAAS,EAAGF,GAAK,EAAGA,IAAK,CAChD,GAAIjD,GAAOG,KAAK+C,MAAMD,GAAGjD,KAAK,EAC9BG,MAAK6D,YAAYhE,GAGlBjB,EAAEG,GAAGC,SAASC,UAAUuG,WAAWnF,MAAML,KAAMM,YAIhDuF,UAAW,SAAS3G,GAEnB,GAAI+B,GAAIrC,EAAEE,UAAWkB,KAAKd,QAASA,GAClC6D,EAAQ/C,KAAK8F,kBAAkB7E,GAAKA,EAAE8E,WACnCC,IAqBJ,OAnBApH,GAAEmE,GAAOkD,KAAK,WACb,GAAIC,IAAOtH,EAAEqC,EAAEpB,MAAQG,MAAMmG,KAAKlF,EAAEmF,WAAa,OAAS,IACvDC,MAAMpF,EAAEqF,YAAc,iBACrBC,GAAO3H,EAAEqC,EAAEpB,MAAQG,MAAMF,OAAOmB,EAAE1B,UACnCO,OAAOmB,EAAE8B,OACToD,KAAKlF,EAAEmF,WAAa,OAAS,IAC7BC,MAAMpF,EAAEqF,YAAc,gBAErBJ,IACHF,EAAIQ,MAAOvF,EAAEwF,KAAOP,EAAI,IAAM,KAAOjF,EAAEwF,KAAOxF,EAAEqF,WAAaJ,EAAI,GAAKA,EAAI,IAAM,MAE5EK,EAAOtF,EAAEwF,KAAOxF,EAAEqF,WAAaC,EAAI,GAAKA,EAAI,GAAMtF,EAAEvB,YAItDsG,EAAIhD,QAAU/B,EAAEwF,KACnBT,EAAIQ,KAAKvF,EAAEwF,IAAM,KAGXT,EAAIU,KAAK,MAIjBC,YAAa,SAASzH,GAarB,QAAS0H,GAAgB/G,GACxB,GAAIgH,IAAMjI,EAAEiB,GAAMsG,KAAKlF,EAAEmF,WAAa,OAAS,IAAIC,MAAMpF,EAAEqF,YAAc,gBACzE,IAAIO,EAAI,CACP,GAAIzD,IAAeyD,GAAOA,EAAG,GAQ7B,OAPIjI,GAAEiB,GAAMsF,SAASlE,EAAE1B,UAAU4F,SAASlE,EAAE8B,OAAOC,OAAS,IAC3DI,EAAY+B,YACZvG,EAAEiB,GAAMsF,SAASlE,EAAE1B,UAAU4F,SAASlE,EAAE8B,OAAOkD,KAAK,WACnD,GAAI9B,GAAQyC,EAAgB5G,KAC5BoD,GAAY+B,SAASqB,KAAKrC,MAGrBf,GAtBT,GAAInC,GAAIrC,EAAEE,UAAWkB,KAAKd,QAASA,GAE/B4H,GADM7F,EAAE8F,iBAAmB,KAQ/B,OALAnI,GAAEoB,KAAKC,SAASkF,SAASlE,EAAE8B,OAAOkD,KAAK,WACtC,GAAI9B,GAAQyC,EAAgB5G,KAC5B8G,GAAIN,KAAKrC,KAGH2C,GAkBRE,QAAS,SAAS9H,GAuBjB,QAAS+H,GAAgBpH,EAAMqH,EAAOpF,GAErC,GACI+E,GACAN,EAFAY,EAAQrF,EAAO,CAcnB,IAVIlD,EAAEiB,GAAMsF,SAASlE,EAAE1B,UAAU4F,SAASlE,EAAE8B,OAAOC,OAAS,IAC3DkE,IACAtI,EAAEiB,GAAMsF,SAASlE,EAAE1B,UAAU4F,SAASlE,EAAE8B,OAAOkD,KAAK,WACnDkB,EAAQF,EAAgBrI,EAAEoB,MAAOkH,EAAOC,KAEzCD,KAGDL,EAAMjI,EAAEiB,GAAMsG,KAAKlF,EAAEmF,WAAa,MAAOC,MAAMpF,EAAEqF,YAAc,iBAE3DY,IAAUE,EAAS,EACtBb,EAAMtF,EAAEvB,WACF,CACN,GAAIsE,GAAcpF,EAAEiB,GAAMC,OAAOmB,EAAE1B,UAC3BO,OAAOmB,EAAE8B,OACToD,KAAKlF,EAAEmF,WAAa,MACpBC,MAAMpF,EAAEqF,YAAc,gBAC9BC,GAAMvC,EAAW,GAQlB,MALI6C,IACFC,EAAIN,MAAMa,QAAWR,EAAG,GAAIS,UAAaf,EAAKW,MAASA,EAAOpF,KAAQA,EAAMqF,MAASA,IAGvFrF,EAAOqF,EAAQ,EAnDhB,GAAIlG,GAAIrC,EAAEE,UAAWkB,KAAKd,QAASA,GAClCkI,EAASnG,EAAE8F,iBAAmB,EAC3BD,KACAhF,EAAO,CAgBX,OAdAgF,GAAIN,MACHa,QAAWpG,EAAEvB,OACb4H,UAAa,OACbJ,MAASE,EACTtF,KAAQ,IACRqF,MAAiD,GAAvCvI,EAAEqC,EAAE8B,MAAO/C,KAAKC,SAAS+C,OAAS,KAG7CpE,EAAEoB,KAAKC,SAASkF,SAASlE,EAAE8B,OAAOkD,KAAK,WACtCnE,EAAOmF,EAAgBjH,KAAMoH,EAAS,EAAGtF,KAG1CgF,EAAMA,EAAIS,KAAK,SAASC,EAAEC,GAAI,MAAQD,GAAE1F,KAAO2F,EAAE3F,QAwClD+B,YAAa,SAAShE,GAErB,GAAI6H,GAAY9I,EAAEiB,GAAMsF,SAASnF,KAAKd,QAAQK,WAC1CmI,EAAU1E,QAAW0E,EAAUvC,WAAWnC,QAAWhD,KAAKd,QAAQI,YACrEoI,EAAUC,UAKZvD,UAAW,SAASvE,GAEnB,GAAIsE,GAAQ,CAEZ,IAAInE,KAAKd,QAAQK,SAEhB,IADA,GAAIqI,GAAO/H,EAAKqE,QAAQlE,KAAKd,QAAQK,UAC9BqI,GAAQA,EAAK5E,OAAS,IACX4E,EAAKzH,GAAG,iBACzBgE,IACAyD,EAAOA,EAAK9H,SAASoE,QAAQlE,KAAKd,QAAQK,SAI5C,OAAO4E,IAGRG,gBAAiB,SAASxE,EAAQoH,GACjC,GAAIW,GAAO7H,KACPiB,EAAIjB,KAAKd,QACT4I,EAAS,CAOb,OANAZ,GAAQA,GAAS,EAEjBtI,EAAEkB,GAAQqF,SAASlE,EAAE1B,UAAU4F,SAASlE,EAAE8B,OAAOkD,KAAK,SAAU8B,EAAOC,GACrEF,EAASG,KAAKC,IAAIL,EAAKvD,gBAAgB0D,EAAOd,EAAQ,GAAIY,KAGrDZ,EAAQY,EAAS,EAAIA,GAG7B5C,WAAY,SAASlB,EAAYG,EAAOgE,GACvC,GAAIlH,GAAIjB,KAAKd,QACZkJ,IAASxJ,EAAEoB,KAAK2F,YAAY7F,QAAQuI,SAAS,eAC7C7I,EAAYQ,KAAKyC,YAAYyB,QAAQ,gBAAgBoE,eAAe,SAAU,cAK1ErH,EAAErB,UAAUI,KAAKoD,YAAaY,IAClCA,GAAcA,EAAWqE,SAASpH,EAAE7B,iBACpC6B,EAAExB,cAA8B,MAAduE,IAAuBoE,GAAUA,GAAUjE,EAAQ,IACpEnE,KAAKyC,YAAY8F,SAAStH,EAAE5B,YACxBG,EAAY2I,GAAuB,GAAb3I,EACzBQ,KAAK+E,gBAAkBoD,EAAS3I,EAEhCQ,KAAK+E,gBAAkB,GAGrBvF,EAAY2I,GAAuB,GAAb3I,GACzBQ,KAAKyC,YAAY8F,SAAStH,EAAE5B,YAC5BW,KAAK+E,gBAAkBoD,EAAS3I,IAEhCQ,KAAKyC,YAAYiD,YAAYzE,EAAE5B,YAC/BW,KAAK+E,gBAAkB,OAO3BnG,EAAE4J,IAAIF,eAAerJ,UAAUC,QAAUN,EAAEE,UAAWF,EAAEG,GAAGC,SAASC,UAAUC,QAASN,EAAE4J,IAAIF,eAAerJ,UAAUC,UACpHuJ","file":"jquery.mjs.nestedSortable.js","sourcesContent":["/*\n * jQuery UI Nested Sortable\n * v 1.3.5 / 21 jun 2012\n * http://mjsarfatti.com/code/nestedSortable\n *\n * Depends on:\n *\t jquery.ui.sortable.js 1.8+\n *\n * Copyright (c) 2010-2012 Manuele J Sarfatti\n * Licensed under the MIT License\n * http://www.opensource.org/licenses/mit-license.php\n */\n\n(function($) {\n\n\t$.widget(\"mjs.nestedSortable\", $.extend({}, $.ui.sortable.prototype, {\n\n\t\toptions: {\n\t\t\ttabSize: 20,\n\t\t\tdisableNesting: 'mjs-nestedSortable-no-nesting',\n\t\t\terrorClass: 'mjs-nestedSortable-error',\n\t\t\tdoNotClear: false,\n\t\t\tlistType: 'ol',\n\t\t\tmaxLevels: 0,\n\t\t\tprotectRoot: false,\n\t\t\trootID: null,\n\t\t\trtl: false,\n\t\t\tisAllowed: function(item, parent) { return true; }\n\t\t},\n\n\t\t_create: function() {\n\t\t\tthis.element.data('sortable', this.element.data('nestedSortable'));\n\n\t\t\tif (!this.element.is(this.options.listType))\n\t\t\t\tthrow new Error('nestedSortable: Please check the listType option is set to your actual list type');\n\n\t\t\treturn $.ui.sortable.prototype._create.apply(this, arguments);\n\t\t},\n\n\t\tdestroy: function() {\n\t\t\tthis.element\n\t\t\t\t.removeData(\"nestedSortable\")\n\t\t\t\t.unbind(\".nestedSortable\");\n\t\t\treturn $.ui.sortable.prototype.destroy.apply(this, arguments);\n\t\t},\n\n\t\t_mouseDrag: function(event) {\n\n\t\t\t//Compute the helpers position\n\t\t\tthis.position = this._generatePosition(event);\n\t\t\tthis.positionAbs = this._convertPositionTo(\"absolute\");\n\n\t\t\tif (!this.lastPositionAbs) {\n\t\t\t\tthis.lastPositionAbs = this.positionAbs;\n\t\t\t}\n\n\t\t\tvar o = this.options;\n\n\t\t\t//Do scrolling\n\t\t\tif(this.options.scroll) {\n\t\t\t\tvar scrolled = false;\n\t\t\t\tif(this.scrollParent[0] != document && this.scrollParent[0].tagName != 'HTML') {\n\n\t\t\t\t\tif((this.overflowOffset.top + this.scrollParent[0].offsetHeight) - event.pageY < o.scrollSensitivity)\n\t\t\t\t\t\tthis.scrollParent[0].scrollTop = scrolled = this.scrollParent[0].scrollTop + o.scrollSpeed;\n\t\t\t\t\telse if(event.pageY - this.overflowOffset.top < o.scrollSensitivity)\n\t\t\t\t\t\tthis.scrollParent[0].scrollTop = scrolled = this.scrollParent[0].scrollTop - o.scrollSpeed;\n\n\t\t\t\t\tif((this.overflowOffset.left + this.scrollParent[0].offsetWidth) - event.pageX < o.scrollSensitivity)\n\t\t\t\t\t\tthis.scrollParent[0].scrollLeft = scrolled = this.scrollParent[0].scrollLeft + o.scrollSpeed;\n\t\t\t\t\telse if(event.pageX - this.overflowOffset.left < o.scrollSensitivity)\n\t\t\t\t\t\tthis.scrollParent[0].scrollLeft = scrolled = this.scrollParent[0].scrollLeft - o.scrollSpeed;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tif(event.pageY - $(document).scrollTop() < o.scrollSensitivity)\n\t\t\t\t\t\tscrolled = $(document).scrollTop($(document).scrollTop() - o.scrollSpeed);\n\t\t\t\t\telse if($(window).height() - (event.pageY - $(document).scrollTop()) < o.scrollSensitivity)\n\t\t\t\t\t\tscrolled = $(document).scrollTop($(document).scrollTop() + o.scrollSpeed);\n\n\t\t\t\t\tif(event.pageX - $(document).scrollLeft() < o.scrollSensitivity)\n\t\t\t\t\t\tscrolled = $(document).scrollLeft($(document).scrollLeft() - o.scrollSpeed);\n\t\t\t\t\telse if($(window).width() - (event.pageX - $(document).scrollLeft()) < o.scrollSensitivity)\n\t\t\t\t\t\tscrolled = $(document).scrollLeft($(document).scrollLeft() + o.scrollSpeed);\n\n\t\t\t\t}\n\n\t\t\t\tif(scrolled !== false && $.ui.ddmanager && !o.dropBehaviour)\n\t\t\t\t\t$.ui.ddmanager.prepareOffsets(this, event);\n\t\t\t}\n\n\t\t\t//Regenerate the absolute position used for position checks\n\t\t\tthis.positionAbs = this._convertPositionTo(\"absolute\");\n\n      // Find the top offset before rearrangement,\n      var previousTopOffset = this.placeholder.offset().top;\n\n\t\t\t//Set the helper position\n\t\t\tif(!this.options.axis || this.options.axis != \"y\") this.helper[0].style.left = this.position.left+'px';\n\t\t\tif(!this.options.axis || this.options.axis != \"x\") this.helper[0].style.top = this.position.top+'px';\n\n\t\t\t//Rearrange\n\t\t\tfor (var i = this.items.length - 1; i >= 0; i--) {\n\n\t\t\t\t//Cache variables and intersection, continue if no intersection\n\t\t\t\tvar item = this.items[i], itemElement = item.item[0], intersection = this._intersectsWithPointer(item);\n\t\t\t\tif (!intersection) continue;\n\n\t\t\t\tif(itemElement != this.currentItem[0] //cannot intersect with itself\n\t\t\t\t\t&&\tthis.placeholder[intersection == 1 ? \"next\" : \"prev\"]()[0] != itemElement //no useless actions that have been done before\n\t\t\t\t\t&&\t!$.contains(this.placeholder[0], itemElement) //no action if the item moved is the parent of the item checked\n\t\t\t\t\t&& (this.options.type == 'semi-dynamic' ? !$.contains(this.element[0], itemElement) : true)\n\t\t\t\t\t//&& itemElement.parentNode == this.placeholder[0].parentNode // only rearrange items within the same container\n\t\t\t\t) {\n\n\t\t\t\t\t$(itemElement).mouseenter();\n\n\t\t\t\t\tthis.direction = intersection == 1 ? \"down\" : \"up\";\n\n\t\t\t\t\tif (this.options.tolerance == \"pointer\" || this._intersectsWithSides(item)) {\n\t\t\t\t\t\t$(itemElement).mouseleave();\n\t\t\t\t\t\tthis._rearrange(event, item);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Clear emtpy ul's/ol's\n\t\t\t\t\tthis._clearEmpty(itemElement);\n\n\t\t\t\t\tthis._trigger(\"change\", event, this._uiHash());\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar parentItem = (this.placeholder[0].parentNode.parentNode &&\n\t\t\t\t\t\t\t $(this.placeholder[0].parentNode.parentNode).closest('.ui-sortable').length)\n\t\t\t\t       \t\t\t? $(this.placeholder[0].parentNode.parentNode)\n\t\t\t\t       \t\t\t: null,\n\t\t\t    level = this._getLevel(this.placeholder),\n\t\t\t    childLevels = this._getChildLevels(this.helper);\n\n      // To find the previous sibling in the list, keep backtracking until we hit a valid list item.\n\t\t\tvar previousItem = this.placeholder[0].previousSibling ? $(this.placeholder[0].previousSibling) : null;\n\t\t\tif (previousItem != null) {\n\t\t\t\twhile (previousItem[0].nodeName.toLowerCase() != 'li' || previousItem[0] == this.currentItem[0] || previousItem[0] == this.helper[0]) {\n\t\t\t\t\tif (previousItem[0].previousSibling) {\n\t\t\t\t\t\tpreviousItem = $(previousItem[0].previousSibling);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpreviousItem = null;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n      // To find the next sibling in the list, keep stepping forward until we hit a valid list item.\n      var nextItem = this.placeholder[0].nextSibling ? $(this.placeholder[0].nextSibling) : null;\n      if (nextItem != null) {\n        while (nextItem[0].nodeName.toLowerCase() != 'li' || nextItem[0] == this.currentItem[0] || nextItem[0] == this.helper[0]) {\n          if (nextItem[0].nextSibling) {\n            nextItem = $(nextItem[0].nextSibling);\n          } else {\n            nextItem = null;\n            break;\n          }\n        }\n      }\n\n\t\t\tvar newList = document.createElement(o.listType);\n\n\t\t\tthis.beyondMaxLevels = 0;\n\t\t\t\n\t\t\t// If the item is moved to the left, send it to its parent's level unless there are siblings below it.\n\t\t\tif (parentItem != null && nextItem == null &&\n\t\t\t\t\t(o.rtl && (this.positionAbs.left + this.helper.outerWidth() > parentItem.offset().left + parentItem.outerWidth()) ||\n\t\t\t\t\t!o.rtl && (this.positionAbs.left < parentItem.offset().left))) {\n\t\t\t\tparentItem.after(this.placeholder[0]);\n\t\t\t\tthis._clearEmpty(parentItem[0]);\n\t\t\t\tthis._trigger(\"change\", event, this._uiHash());\n\t\t\t}\n\t\t\t// If the item is below a sibling and is moved to the right, make it a child of that sibling.\n\t\t\telse if (previousItem != null &&\n\t\t\t\t\t\t(o.rtl && (this.positionAbs.left + this.helper.outerWidth() < previousItem.offset().left + previousItem.outerWidth() - o.tabSize) ||\n\t\t\t\t\t\t!o.rtl && (this.positionAbs.left > previousItem.offset().left + o.tabSize))) {\n\t\t\t\tthis._isAllowed(previousItem, level, level+childLevels+1);\n\t\t\t\tif (!previousItem.children(o.listType).length) {\n\t\t\t\t\tpreviousItem[0].appendChild(newList);\n\t\t\t\t}\n        // If this item is being moved from the top, add it to the top of the list.\n        if (previousTopOffset && (previousTopOffset <= previousItem.offset().top)) {\n          previousItem.children(o.listType).prepend(this.placeholder);\n        }\n        // Otherwise, add it to the bottom of the list.\n        else {\n\t\t\t\t  previousItem.children(o.listType)[0].appendChild(this.placeholder[0]);\n        }\n\t\t\t\tthis._trigger(\"change\", event, this._uiHash());\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._isAllowed(parentItem, level, level+childLevels);\n\t\t\t}\n\n\t\t\t//Post events to containers\n\t\t\tthis._contactContainers(event);\n\n\t\t\t//Interconnect with droppables\n\t\t\tif($.ui.ddmanager) $.ui.ddmanager.drag(this, event);\n\n\t\t\t//Call callbacks\n\t\t\tthis._trigger('sort', event, this._uiHash());\n\n\t\t\tthis.lastPositionAbs = this.positionAbs;\n\t\t\treturn false;\n\n\t\t},\n\n\t\t_mouseStop: function(event, noPropagation) {\n\n\t\t\t// If the item is in a position not allowed, send it back\n\t\t\tif (this.beyondMaxLevels) {\n\n\t\t\t\tthis.placeholder.removeClass(this.options.errorClass);\n\n\t\t\t\tif (this.domPosition.prev) {\n\t\t\t\t\t$(this.domPosition.prev).after(this.placeholder);\n\t\t\t\t} else {\n\t\t\t\t\t$(this.domPosition.parent).prepend(this.placeholder);\n\t\t\t\t}\n\n\t\t\t\tthis._trigger(\"revert\", event, this._uiHash());\n\n\t\t\t}\n\n\t\t\t// Clean last empty ul/ol\n\t\t\tfor (var i = this.items.length - 1; i >= 0; i--) {\n\t\t\t\tvar item = this.items[i].item[0];\n\t\t\t\tthis._clearEmpty(item);\n\t\t\t}\n\n\t\t\t$.ui.sortable.prototype._mouseStop.apply(this, arguments);\n\n\t\t},\n\n\t\tserialize: function(options) {\n\n\t\t\tvar o = $.extend({}, this.options, options),\n\t\t\t\titems = this._getItemsAsjQuery(o && o.connected),\n\t\t\t    str = [];\n\n\t\t\t$(items).each(function() {\n\t\t\t\tvar res = ($(o.item || this).attr(o.attribute || 'id') || '')\n\t\t\t\t\t\t.match(o.expression || (/(.+)[-=_](.+)/)),\n\t\t\t\t    pid = ($(o.item || this).parent(o.listType)\n\t\t\t\t\t\t.parent(o.items)\n\t\t\t\t\t\t.attr(o.attribute || 'id') || '')\n\t\t\t\t\t\t.match(o.expression || (/(.+)[-=_](.+)/));\n\n\t\t\t\tif (res) {\n\t\t\t\t\tstr.push(((o.key || res[1]) + '[' + (o.key && o.expression ? res[1] : res[2]) + ']')\n\t\t\t\t\t\t+ '='\n\t\t\t\t\t\t+ (pid ? (o.key && o.expression ? pid[1] : pid[2]) : o.rootID));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif(!str.length && o.key) {\n\t\t\t\tstr.push(o.key + '=');\n\t\t\t}\n\n\t\t\treturn str.join('&');\n\n\t\t},\n\n\t\ttoHierarchy: function(options) {\n\n\t\t\tvar o = $.extend({}, this.options, options),\n\t\t\t\tsDepth = o.startDepthCount || 0,\n\t\t\t    ret = [];\n\n\t\t\t$(this.element).children(o.items).each(function () {\n\t\t\t\tvar level = _recursiveItems(this);\n\t\t\t\tret.push(level);\n\t\t\t});\n\n\t\t\treturn ret;\n\n\t\t\tfunction _recursiveItems(item) {\n\t\t\t\tvar id = ($(item).attr(o.attribute || 'id') || '').match(o.expression || (/(.+)[-=_](.+)/));\n\t\t\t\tif (id) {\n\t\t\t\t\tvar currentItem = {\"id\" : id[2]};\n\t\t\t\t\tif ($(item).children(o.listType).children(o.items).length > 0) {\n\t\t\t\t\t\tcurrentItem.children = [];\n\t\t\t\t\t\t$(item).children(o.listType).children(o.items).each(function() {\n\t\t\t\t\t\t\tvar level = _recursiveItems(this);\n\t\t\t\t\t\t\tcurrentItem.children.push(level);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn currentItem;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\ttoArray: function(options) {\n\n\t\t\tvar o = $.extend({}, this.options, options),\n\t\t\t\tsDepth = o.startDepthCount || 0,\n\t\t\t    ret = [],\n\t\t\t    left = 2;\n\n\t\t\tret.push({\n\t\t\t\t\"item_id\": o.rootID,\n\t\t\t\t\"parent_id\": 'none',\n\t\t\t\t\"depth\": sDepth,\n\t\t\t\t\"left\": '1',\n\t\t\t\t\"right\": ($(o.items, this.element).length + 1) * 2\n\t\t\t});\n\n\t\t\t$(this.element).children(o.items).each(function () {\n\t\t\t\tleft = _recursiveArray(this, sDepth + 1, left);\n\t\t\t});\n\n\t\t\tret = ret.sort(function(a,b){ return (a.left - b.left); });\n\n\t\t\treturn ret;\n\n\t\t\tfunction _recursiveArray(item, depth, left) {\n\n\t\t\t\tvar right = left + 1,\n\t\t\t\t    id,\n\t\t\t\t    pid;\n\n\t\t\t\tif ($(item).children(o.listType).children(o.items).length > 0) {\n\t\t\t\t\tdepth ++;\n\t\t\t\t\t$(item).children(o.listType).children(o.items).each(function () {\n\t\t\t\t\t\tright = _recursiveArray($(this), depth, right);\n\t\t\t\t\t});\n\t\t\t\t\tdepth --;\n\t\t\t\t}\n\n\t\t\t\tid = ($(item).attr(o.attribute || 'id')).match(o.expression || (/(.+)[-=_](.+)/));\n\n\t\t\t\tif (depth === sDepth + 1) {\n\t\t\t\t\tpid = o.rootID;\n\t\t\t\t} else {\n\t\t\t\t\tvar parentItem = ($(item).parent(o.listType)\n\t\t\t\t\t\t\t\t\t\t\t .parent(o.items)\n\t\t\t\t\t\t\t\t\t\t\t .attr(o.attribute || 'id'))\n\t\t\t\t\t\t\t\t\t\t\t .match(o.expression || (/(.+)[-=_](.+)/));\n\t\t\t\t\tpid = parentItem[2];\n\t\t\t\t}\n\n\t\t\t\tif (id) {\n\t\t\t\t\t\tret.push({\"item_id\": id[2], \"parent_id\": pid, \"depth\": depth, \"left\": left, \"right\": right});\n\t\t\t\t}\n\n\t\t\t\tleft = right + 1;\n\t\t\t\treturn left;\n\t\t\t}\n\n\t\t},\n\n\t\t_clearEmpty: function(item) {\n\n\t\t\tvar emptyList = $(item).children(this.options.listType);\n\t\t\tif (emptyList.length && !emptyList.children().length && !this.options.doNotClear) {\n\t\t\t\temptyList.remove();\n\t\t\t}\n\n\t\t},\n\n\t\t_getLevel: function(item) {\n\n\t\t\tvar level = 1;\n\n\t\t\tif (this.options.listType) {\n\t\t\t\tvar list = item.closest(this.options.listType);\n\t\t\t\twhile (list && list.length > 0 && \n                    \t!list.is('.ui-sortable')) {\n\t\t\t\t\tlevel++;\n\t\t\t\t\tlist = list.parent().closest(this.options.listType);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn level;\n\t\t},\n\n\t\t_getChildLevels: function(parent, depth) {\n\t\t\tvar self = this,\n\t\t\t    o = this.options,\n\t\t\t    result = 0;\n\t\t\tdepth = depth || 0;\n\n\t\t\t$(parent).children(o.listType).children(o.items).each(function (index, child) {\n\t\t\t\t\tresult = Math.max(self._getChildLevels(child, depth + 1), result);\n\t\t\t});\n\n\t\t\treturn depth ? result + 1 : result;\n\t\t},\n\n\t\t_isAllowed: function(parentItem, level, levels) {\n\t\t\tvar o = this.options,\n\t\t\t\tisRoot = $(this.domPosition.parent).hasClass('ui-sortable') ? true : false,\n\t\t\t\tmaxLevels = this.placeholder.closest('.ui-sortable').nestedSortable('option', 'maxLevels'); // this takes into account the maxLevels set to the recipient list\n\n\t\t\t// Is the root protected?\n\t\t\t// Are we trying to nest under a no-nest?\n\t\t\t// Are we nesting too deep?\n\t\t\tif (!o.isAllowed(this.currentItem, parentItem) ||\n\t\t\t\tparentItem && parentItem.hasClass(o.disableNesting) ||\n\t\t\t\to.protectRoot && (parentItem == null && !isRoot || isRoot && level > 1)) {\n\t\t\t\t\tthis.placeholder.addClass(o.errorClass);\n\t\t\t\t\tif (maxLevels < levels && maxLevels != 0) {\n\t\t\t\t\t\tthis.beyondMaxLevels = levels - maxLevels;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.beyondMaxLevels = 1;\n\t\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (maxLevels < levels && maxLevels != 0) {\n\t\t\t\t\tthis.placeholder.addClass(o.errorClass);\n\t\t\t\t\tthis.beyondMaxLevels = levels - maxLevels;\n\t\t\t\t} else {\n\t\t\t\t\tthis.placeholder.removeClass(o.errorClass);\n\t\t\t\t\tthis.beyondMaxLevels = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t}));\n\n\t$.mjs.nestedSortable.prototype.options = $.extend({}, $.ui.sortable.prototype.options, $.mjs.nestedSortable.prototype.options);\n})(jQuery);\n"]}