{"version":3,"sources":["js/main.js"],"names":["crossModulesFunctions","jQuery","$","next","openOptions","animations","openOptionsTimeLine__close","pause","css","display","opacity","transform","openOptionsTimeLine","restart","TimelineLite","append","TweenMax","to","addClass","closeOptions","handlerComplete","onComplete","removeClass","on","this","hasClass","e","target","closest","add","size","refreshMenuView","session","data","sessionGroupSynchronizations","length","activeGroups","haveCookie","undefined","cookie","secureEvalJSON","groups","sessionGroupsForNames","key","one","name","filter","item","i","arr","toJSON","removeCookie","activeGroupsObj","html","oneGroup","activeParamsObj","synchroParams","active","empty","groupsSessionToJson","$main","find","each","activeParams","push","attr","sendSessionSortableGroups","onChangeSessionGroups","applyAllParamsLocalSession","sendSessionAddGroup","sendSessionDeleteGroup","sendSessionActivatedGroup","activated","onSessionActivatedGroup","sendSessionActivatedParam","nameParam","onSessionActivatedParam","onlyChange","prepend","sortable","axis","items","placeholder","forceHelperSize","forcePlaceholderSize","update","disableSelection","modal","val","trim","alert","text","remove","responseHandlers","toggleClass","pageLoaded","ls","iframe","pageManagerVisualizator","setSizeIFrame","w","h","resolutions","currentResolution","screenshotsCollection","getCurrentRelatedScreenshotsCollection","pixelPerfect","refreshScrins","getScreenshotsObjList","showPageProofsOrDesign","setPositionIFrame","position","left","top","setScrollIFrame","scroll","getLocalSessionParams","pages","currentPage","$container","selectPage","sendSelectPage","onSelectPage","sendAddPage","onChangePages","pagesNestedToJson","sendAddPageGroup","sendDeletePageOrGroup","sendUpdatePageOrGroup","onUpdatePageOrGroup","sendSortablePageOrGroup","sendCollapseUncollapsePageOrGroup","createMenuItem","type","refreshMenuPages","localSession","dragItemList","res","recursion","el","urn","_class","collapsed","sub","globalSession","refreshNestedEl","refreshCollapsed","json","previousLevel","stack","0","level","parents","obj","itemToJson","$item","clearEmptyUl","parent","clearCollapseNotNested","not","sendAddResolution","onChangeResolutions","resolutionsToJson","refreshMenuResolutions","sendDeleteResolution","onChangeScreenshots","sendSelectResolution","onSelectResolution","parseInt","sendScrollIFrame","wWindow","wDocument","leftScroll","l_factor","hWindow","hDocument","topScroll","t_factor","window","_options","nameIFrame","width","document","height","scrollTop","scrollLeft","onScrollIFrame","sendChangePosIFrame","w_c","h_c","l","t","$iframe","$fittingWrap","$outerWrap","onChangePosIFrame","sendResizeIFrame","lastSizeIFrame","onResizeIFrame","modules","$mapNavigatorContainer","pixelsScrollableInSeconds","minWOuterScroll","minHOuterScroll","minWDraggable","minHDraggable","minWIFrame","minHIFrame","responsiveToMovementOfTheCursorInAConfinedSpace","movementOfTheCursorInAConfinedSpaceSpred","gorizontalFixation","verticalFixation","minHeightCalculateAuto","heightCalculateRatio","calculatedHeightAsMaxHeight","stopAllAnimationsAtResize","mCustomScrollbar","theme","scrollbarPosition","scrollInertia","mouseWheel","scrollAmount","event","getPage","location","href","get","focus","getGroup","$cutItems","after","$li","newName","o","nestedSortable","handle","revert","tabSize","toleranceElement","listType","helper","maxLevels","isTree","start","stop","ui","hasError","test","resizeIFrame__timeoutId","curSizeIFrame","setInterval","clearInterval","pmv.prepaste.iframe","pmv.load.iframe","setTimeout","_create","startDeviationSpinner","sendStartSpinnerScreenshotDeviation","spinDeviationSpinner","sendSpinSpinnerScreenshotDeviation","stopDeviationSpinner","sendStopSpinnerScreenshotDeviation","handlerFastChangePageProofsOrDesign","which","ctrlKey","shiftKey","altKey","sendHTMLOrDesign","stopPropagation","cancelBubble","preventDefault","refreshButtonsPageProofsOrDesign","show","sendBindScreenshot","allScreenshotsForCurPageToJson","sendUnbindScreenshot","sendSortableScreenshot","sendActiveScreenshot","sendChangeSOrFScreenshotDeviation","sendChangeGridScreenshotDeviation","b","currentTarget","lpx","lper","parseFloat","tpx","tper","allScreenshotsForCurPageToJsonTemp","screenshotsCollectionTemp","screenshotsObjListTemp","onFastChangeScreenshots","sendCollapseUncollapseScreenshotsFolder","onCollapseUncollapseScreenshotsFolder","collapseUncollapseScreenshotsFolderToJson","state","onHTMLOrDesign","newScreenshotsForCurPage","$liResolution","w_h","newScrinshot","pos","refreshMenuViewScreenshotsForResolutions","allScreenshotsForCurPageTemp","createScreenshotsList","designScreenshotsRelatedResolutionAndPage","refreshSortableScreensotsInResolutions","setParamDeviation","setParamDeviation__relative","setParamDeviation__deviation","$static","first","$fixed","last","prop","$relative","deviationInput","refreshSpinner","spinner","min","max","spin","step","resolution","screenshotsRelated","screenshotsObjList","screenshots","s","cursor","distance","connectWith","refreshMenuAllScreenshots","collapsedToObj","designScreenshotsFoldersUncollapsed","designScreenshots","refreshMenuAllScreenshots__specific","map","dirScrins","_destroy","callbacks","onUpdate","$size","_","contents","windowThumbnail__timeoutId","mouseenter","clearTimeout","mouseleave","ready","console","log","navigator","userAgent","tooltip","popover","socket","io","connect","once","sessionModel"],"mappings":"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","file":"main.js","sourcesContent":["/****************************************************/\r\n/*Шаблонизатор*/\r\n/****************************************************/\r\nvar crossModulesFunctions = {};\r\njQuery(function($) {\r\n    var session;\r\n    var socket = io.connect('/');\r\n\r\n    socket.once('session.load', function (data) {\r\n        session = new modules.sessionModel(data, socket);\r\n        next();\r\n    });\r\n    \r\n    function next() {\r\n        //Глобальные настройки\r\n        (function() {\r\n            var animations = {};\r\n            $( \".shab__global-settings-btn\" ).on(\"click\", function () {\r\n                if( !$(this).hasClass('active') ) {\r\n                    openOptions();\r\n                } else {\r\n                    closeOptions();\r\n                }\r\n            });\r\n\r\n            $( \"body\" ).on(\"click click.body.iframe\", function (e) {\r\n                if( $(e.target).closest($(\".shab__global-settings-btn\").add($(\".shab__global-settings\"))).size() == 0 ) {\r\n                    if( $(\".shab__global-settings-btn\").hasClass('active') ) {\r\n                        closeOptions();\r\n                    }\r\n                }\r\n            });\r\n\r\n            function openOptions() {\r\n                if( \"openOptionsTimeLine__close\" in animations ) { animations.openOptionsTimeLine__close.pause() }\r\n                $(\" .shab__global-settings\").css({\r\n                    display: \"block\",\r\n                    opacity: 0,\r\n                    transform: \"scale(0.8, 0.8)\"\r\n                });\r\n\r\n                if( !(\"openOptionsTimeLine\" in animations) ) {\r\n                    animations.openOptionsTimeLine = (new TimelineLite()).append([\r\n                        TweenMax.to($(\".shab__global-settings\"), 0.5,\r\n                            {css:{transform: \"scale(1, 1)\" }}),\r\n                        TweenMax.to($(\".shab__global-settings\"), 0.3,\r\n                            {css:{ opacity: 1 }})\r\n                    ]);\r\n                } else {\r\n                    animations.openOptionsTimeLine.restart();\r\n                }\r\n\r\n                $( \".shab__global-settings-btn\" ).addClass('active');\r\n            }\r\n\r\n            function closeOptions() {\r\n                if( \"openOptionsTimeLine\" in animations ) { animations.openOptionsTimeLine.pause() }\r\n                if( !(\"openOptionsTimeLine__close\" in animations) ) {\r\n                    animations.openOptionsTimeLine__close = (new TimelineLite()).append([\r\n                        TweenMax.to($(\".shab__global-settings\"), 0.5,\r\n                            {css:{ transform: \"scale(0.8, 0.8)\"}, onComplete: handlerComplete}),\r\n                        TweenMax.to($(\".shab__global-settings\"), 0.5,\r\n                            {css:{ opacity: 0 }})\r\n                    ]);\r\n                } else {\r\n                    animations.openOptionsTimeLine__close.restart();\r\n                }\r\n                function handlerComplete() {\r\n                    $(\".shab__global-settings\").css('display', 'none');\r\n                }\r\n\r\n                $( \".shab__global-settings-btn\" ).removeClass('active');\r\n            }\r\n\r\n            //$('#text-encoding-server').selectpicker();\r\n\r\n            //Кодировка на хосте\r\n            //$('#text-encoding-server').selectpicker('val', shablonizator.settings.find('text_encoding_server').text());\r\n\r\n            /*$('#text-encoding-server').on('change', function(){\r\n                shablonizator.textEncodingServer = $(this).val();\r\n                shablonizator.settings.find('text_encoding_server').text($(this).val());\r\n                shablonizator.save_g_settings();\r\n            });*/\r\n        })();\r\n\r\n        /****************************************************/\r\n        /*Синхронизация по группам сессий*/\r\n        /****************************************************/\r\n        (function() {\r\n            //Свернуть-развернуть список выбора групп\r\n            $(\".shab__btn-open-groups-session\").on(\"click\", function () {\r\n                if(!$(this).hasClass('active')) {\r\n                    $(this).addClass('active');\r\n                    $(\".shab__session-groups-list\").addClass('open');\r\n                } else {\r\n                    $(this).removeClass('active');\r\n                    $(\".shab__session-groups-list\").removeClass('open');\r\n                }\r\n            });\r\n            $(\"body\").on(\"click click.body.iframe\", function (e) {\r\n                if( $(e.target).closest($(\".shab__btn-open-groups-session\").add($(\".shab__session-groups-list\")).add($(\"#shab-add-group-session\")).add($(\"#shab-delete-group-session\"))).length == 0 ) {\r\n                    $(\".shab__btn-open-groups-session\").removeClass('active');\r\n                    $(\".shab__session-groups-list\").removeClass('open');\r\n                }\r\n            });\r\n\r\n            //Формирование меню групп сессий\r\n            $(\".shab__session-groups-list\").prepend(\"<ul class='shab__session-groups-list-ul'></ul>\");\r\n            refreshMenuView();\r\n            $(\".shab__session-groups-list-ul\").sortable({\r\n                    axis: \"y\",\r\n                    //handle: 'button',\r\n                    items: \"> li\",\r\n                    placeholder: \"placeholder\",\r\n                    forceHelperSize: true,\r\n                    forcePlaceholderSize: true,\r\n                    update: function() {\r\n                        sendSessionSortableGroups();\r\n                    }\r\n                })\r\n                .disableSelection();\r\n            function refreshMenuView() {\r\n                if(session.data.sessionGroupSynchronizations.length) {\r\n                    var haveCookie = $.cookie('adaptive_pixel_perfect_groups_session') !== undefined;\r\n                    var activeGroups;\r\n\r\n                    if(haveCookie) {\r\n                        activeGroups = $.secureEvalJSON($.cookie('adaptive_pixel_perfect_groups_session')).groups;\r\n                        //список в обьект по именам групп сессий\r\n                        var sessionGroupsForNames = {};\r\n                        for(var key in session.data.sessionGroupSynchronizations) {\r\n                            var one = session.data.sessionGroupSynchronizations[key];\r\n                            sessionGroupsForNames[one.name] = one;\r\n                        }\r\n\r\n                        //Удаляем имена выбранных групп которых уже нету\r\n                        activeGroups.filter(function(item, i, arr) {\r\n                            return item in sessionGroupsForNames;\r\n                        });\r\n                        $.cookie('adaptive_pixel_perfect_groups_session', $.toJSON({\"groups\": activeGroups}));\r\n                        if(!activeGroups.length) {\r\n                            $.removeCookie('adaptive_pixel_perfect_groups_session');\r\n                            haveCookie = false;\r\n                            activeGroups = [];\r\n                        }\r\n                    }\r\n                    var activeGroupsObj = {};\r\n                    for(var i in activeGroups) {\r\n                        activeGroupsObj[activeGroups[i]] = true;\r\n                    }\r\n\r\n                    //Формируем меню\r\n                    var html = \"\";\r\n\r\n                    for(var key in session.data.sessionGroupSynchronizations) {\r\n                        var oneGroup = session.data.sessionGroupSynchronizations[key];\r\n\r\n                        var activeParamsObj = {};\r\n                        for(var i in oneGroup.synchroParams) {\r\n                            activeParamsObj[oneGroup.synchroParams[i]] = true;\r\n                        }\r\n\r\n                        var active = (haveCookie && (oneGroup.name in activeGroupsObj))?\"active\":\"\";\r\n                        html += '<li class=\"shab__session-groups-list-item '+active+'\" data-name=\"'+(oneGroup.name)+'\">' +\r\n                            '<button class=\"btn btn-default btn-xs shab__session-groups-synchro-params-btn '+((\"pages\"       in activeParamsObj)?\"active\":\"\")+'\" data-param=\"pages\"><i class=\"fa fa-file-o\"></i></button>' +\r\n                            '<button class=\"btn btn-default btn-xs shab__session-groups-synchro-params-btn '+((\"resolutions\" in activeParamsObj)?\"active\":\"\")+'\" data-param=\"resolutions\"><i class=\"fa fa-arrows\"></i></button>' +\r\n                            '<button class=\"btn btn-default btn-xs shab__session-groups-synchro-params-btn '+((\"iframe\"      in activeParamsObj)?\"active\":\"\")+'\" data-param=\"iframe\"><i class=\"fa fa-desktop\"></i></button>' +\r\n                            '<button class=\"btn btn-default btn-xs btn-block shab__session-groups-list-btn '+active+'\">'+(oneGroup.name)+'</button>' +\r\n                            '<div class=\"btn btn-default btn-xs shab__session-groups-btn-drag\"><span class=\"glyphicon glyphicon-move\"></span></div>' +\r\n                            '<button class=\"btn btn-default btn-xs shab__session-groups-delete-btn\"><span class=\"glyphicon glyphicon-remove\"></span></button>' +\r\n                            '</li>';\r\n                    }\r\n\r\n                    $(\".shab__session-groups-list-ul\").empty().append(html);\r\n                } else {\r\n                    if($.cookie('adaptive_pixel_perfect_groups_session') !== undefined) {\r\n                        $.removeCookie('adaptive_pixel_perfect_groups_session');\r\n                    }\r\n                }\r\n            }\r\n\r\n            //Добавить группу\r\n            $('.shab__add-group-session').on('click', function(){\r\n                $('#shab-add-group-session .modal').modal('show');\r\n            });\r\n            $('#shab-add-group-session .btn-select').on('click', function(){\r\n                var name = $('#shab-add-group-session .shab-add-group-session__name').val();\r\n                if($.trim(name)) {\r\n                    var html = '<li class=\"shab__session-groups-list-item\" data-name=\"'+($.trim(name))+'\">' +\r\n                        '<button class=\"btn btn-default btn-xs shab__session-groups-synchro-params-btn\" data-param=\"pages\"><i class=\"fa fa-file-o\"></i></button>' +\r\n                        '<button class=\"btn btn-default btn-xs shab__session-groups-synchro-params-btn\" data-param=\"resolutions\"><i class=\"fa fa-arrows\"></i></button>' +\r\n                        '<button class=\"btn btn-default btn-xs shab__session-groups-synchro-params-btn\" data-param=\"iframe\"><i class=\"fa fa-desktop\"></i></button>' +\r\n                        '<button class=\"btn btn-default btn-xs btn-block shab__session-groups-list-btn\">'+($.trim(name))+'</button>' +\r\n                        '<div class=\"btn btn-default btn-xs shab__session-groups-btn-drag\"><span class=\"glyphicon glyphicon-move\"></span></div>' +\r\n                        '<button class=\"btn btn-default btn-xs shab__session-groups-delete-btn\"><span class=\"glyphicon glyphicon-remove\"></span></button>' +\r\n                        '</li>';\r\n                    $(\".shab__session-groups-list-ul\").append(html);\r\n\r\n                    sendSessionAddGroup();\r\n                } else {\r\n                    alert(\"Имя недолжно быть пустым\");\r\n                }\r\n                $('#shab-add-group-session .modal').modal('hide');\r\n            });\r\n\r\n            //Удалить группу\r\n            $('.shab__session-groups-list').on('click', \" .shab__session-groups-delete-btn\", function(){\r\n                $('#shab-delete-group-session .modal').modal('show');\r\n\r\n                var name = $(this).closest(\".shab__session-groups-list-item\").attr(\"data-name\");\r\n                $('#shab-delete-group-session .shab-delete-group-session__name')\r\n                    .attr(\"data-name\", name)\r\n                    .text(name);\r\n            });\r\n            $('#shab-delete-group-session .btn-select').on('click', function(){\r\n                var name = $('#shab-delete-group-session .shab-delete-group-session__name').attr(\"data-name\");\r\n                $(\".shab__session-groups-list-item[data-name='\"+name+\"']\").remove();\r\n\r\n                sendSessionDeleteGroup();\r\n\r\n                $('#shab-delete-group-session .modal').modal('hide');\r\n            });\r\n\r\n            //Активировать-деактивировать группу\r\n            $('.shab__session-groups-list').on('click', \" .shab__session-groups-list-btn\", function(){\r\n                if($(\".shab__session-groups-list.open\").length) {\r\n                    if(!$(this).hasClass(\"active\")) {\r\n                        $(this).addClass(\"active\")\r\n                            .closest(\".shab__session-groups-list-item\").addClass(\"active\");\r\n                    } else {\r\n                        $(this).removeClass(\"active\")\r\n                            .closest(\".shab__session-groups-list-item\").removeClass(\"active\");\r\n                    }\r\n\r\n                    sendSessionActivatedGroup($(this).closest(\".shab__session-groups-list-item\").attr(\"data-name\"), $(this).hasClass(\"active\"));\r\n                }\r\n            });\r\n\r\n            //Активировать-деактивировать параметр группы\r\n            $('.shab__session-groups-list').on('click', \" .shab__session-groups-synchro-params-btn\", function(){\r\n                if(!$(this).hasClass(\"active\")) {\r\n                    $(this).addClass(\"active\");\r\n                } else {\r\n                    $(this).removeClass(\"active\");\r\n                }\r\n\r\n                sendSessionActivatedParam($(this).closest(\".shab__session-groups-list-item\").attr(\"data-name\"), $(this).attr(\"data-param\"), $(this).hasClass(\"active\"));\r\n            });\r\n\r\n            function groupsSessionToJson($main) {\r\n                var sessionGroupSynchronizations = [];\r\n                $main.find(\" .shab__session-groups-list-ul > li\").each(function() {\r\n                    var activeParams = [];\r\n                    $(this).find(\" .shab__session-groups-synchro-params-btn.active\").each(function() {\r\n                        activeParams.push($(this).attr(\"data-param\"));\r\n                    });\r\n                    sessionGroupSynchronizations.push({\r\n                        name: $(this).attr(\"data-name\"),\r\n                        synchroParams: activeParams\r\n                    });\r\n                });\r\n                return sessionGroupSynchronizations;\r\n            }\r\n\r\n            //Запись и отправка данных сессии\r\n            function sendSessionSortableGroups() {\r\n                session.onChangeSessionGroups(groupsSessionToJson($('.shab__session-groups-list')));\r\n                applyAllParamsLocalSession(true);\r\n            }\r\n            function sendSessionAddGroup() {\r\n                session.onChangeSessionGroups(groupsSessionToJson($('.shab__session-groups-list')));\r\n                applyAllParamsLocalSession(true);\r\n            }\r\n            function sendSessionDeleteGroup() {\r\n                session.onChangeSessionGroups(groupsSessionToJson($('.shab__session-groups-list')));\r\n                applyAllParamsLocalSession(true);\r\n            }\r\n            function sendSessionActivatedGroup(name, activated) {\r\n                session.onSessionActivatedGroup(name, activated);\r\n                applyAllParamsLocalSession(true);\r\n            }\r\n            function sendSessionActivatedParam(name, nameParam, activated) {\r\n                session.onSessionActivatedParam(name, nameParam, activated);\r\n                applyAllParamsLocalSession(true);\r\n            }\r\n\r\n            //Приём данных сессии\r\n            session.responseHandlers[\"onChangeSessionGroups\"] = function() {\r\n                refreshMenuView();\r\n                applyAllParamsLocalSession(true);\r\n            }\r\n            session.responseHandlers[\"onSessionActivatedParam\"] = function(name, nameParam, activated) {\r\n                $(\".shab__session-groups-list-ul [data-name='\"+name+\"'] [data-param='\"+nameParam+\"']\").toggleClass(\"active\", activated);\r\n                applyAllParamsLocalSession(true);\r\n            }\r\n\r\n            //Применение новой локальной сессии\r\n            crossModulesFunctions[\"session.applyAllParamsLocalSession\"] = function(onlyChange) {\r\n                //Получаем сессию без куков потому что м в куках и так будет записано текущее состояние сессии\r\n                var ls = session.getLocalSessionParams(onlyChange);\r\n                //console.log(ls);\r\n                //Страница\r\n                if( ls && \"pages\" in ls && \"currentPage\" in ls.pages && (!onlyChange || ls.pages.currentPage !== pageManagerVisualizator.currentPage) ) {\r\n                    pageManagerVisualizator.$container.one(\"pmv.load.iframe\", pageLoaded);\r\n                    pageManagerVisualizator.selectPage(ls.pages.currentPage);\r\n                } else {\r\n                    pageLoaded();\r\n                }\r\n                function pageLoaded() {\r\n                    //Разрешение\r\n                    if( ls && \"iframe\" in ls && \"size\" in ls.iframe ) {\r\n                        pageManagerVisualizator.setSizeIFrame(ls.iframe.size.w, ls.iframe.size.h, true);\r\n                    } else if(ls && \"resolutions\" in ls && \"currentResolution\" in ls.resolutions) {\r\n                        pageManagerVisualizator.setSizeIFrame(ls.resolutions.currentResolution.w, ls.resolutions.currentResolution.h, true);\r\n                    }\r\n                    var screenshotsCollection = session.getCurrentRelatedScreenshotsCollection();\r\n                    pixelPerfect.refreshScrins(screenshotsCollection, session.getScreenshotsObjList());\r\n                    if(ls && \"resolutions\" in ls && \"showPageProofsOrDesign\" in ls.resolutions) {\r\n                        pixelPerfect.showPageProofsOrDesign(ls.resolutions.showPageProofsOrDesign);\r\n                        crossModulesFunctions[\"pp.refreshButtonsPageProofsOrDesign\"](ls.resolutions.showPageProofsOrDesign);\r\n                    }\r\n                    //iFrame\r\n                    if( ls && \"iframe\" in ls && \"size\" in ls.iframe ) {\r\n                        pageManagerVisualizator.setSizeIFrame(ls.iframe.size.w, ls.iframe.size.h, true);\r\n                    }\r\n                    if( ls && \"iframe\" in ls && \"position\" in ls.iframe ) {\r\n                        pageManagerVisualizator.setPositionIFrame(ls.iframe.position.left, ls.iframe.position.top);\r\n                    }\r\n                    if( ls && \"iframe\" in ls && \"scroll\" in ls.iframe ) {\r\n                        pageManagerVisualizator.setScrollIFrame(ls.iframe.scroll.left, ls.iframe.scroll.top);\r\n                    }\r\n                }\r\n            }\r\n            function applyAllParamsLocalSession(onlyChange) {\r\n                crossModulesFunctions[\"session.applyAllParamsLocalSession\"](onlyChange);\r\n            }\r\n        })();\r\n\r\n        /****************************************************/\r\n        /*Менеджер страниц и визуализатор*/\r\n        /****************************************************/\r\n        (function() {\r\n            pageManagerVisualizator = new modules.pageManagerVisualizator($(\"#wrap_iframe\"), session, {\r\n                $mapNavigatorContainer: $('.mnif__navigator-window'),\r\n                nameIFrame: \"PP_iframe\",\r\n                pixelsScrollableInSeconds: 2000,\r\n                minWOuterScroll: 23,\r\n                minHOuterScroll: 23,\r\n                minWDraggable: 15,\r\n                minHDraggable: 15,\r\n                minWIFrame: 320,\r\n                minHIFrame: 480,\r\n                responsiveToMovementOfTheCursorInAConfinedSpace: true,\r\n                movementOfTheCursorInAConfinedSpaceSpred: 10,\r\n                gorizontalFixation: \"center\",\r\n                verticalFixation: \"top\",\r\n                minHeightCalculateAuto: 480,\r\n                heightCalculateRatio: 16/9,\r\n                calculatedHeightAsMaxHeight: true,\r\n                stopAllAnimationsAtResize: true\r\n            });\r\n\r\n            /****************************************************/\r\n            /*Страницы*/\r\n            /****************************************************/\r\n            //Скроллбар для списка страниц\r\n            $(\".pmv__pages-sortable-scrollwrap\").mCustomScrollbar({\r\n                axis: \"y\",\r\n                theme: \"dark\",\r\n                scrollbarPosition: \"outside\",\r\n                scrollInertia: 100,\r\n                mouseWheel: {\r\n                    scrollAmount: 100\r\n                }\r\n            });\r\n\r\n            //Открыть-закрыть меню выбора страниц\r\n            $(\".pmv__select-page-open-list\").on(\"click\", function () {\r\n                $(this).toggleClass('active');\r\n            });\r\n            var dragItemList = false;\r\n            $(\"body\").on(\"click click.body.iframe\", function (e) {\r\n                if( $(e.target).closest($(\".pmv__select-page-open-list\").add($(\".pmv__pages-window, #modal-pmv-add-page-href, #pmv__modal-add-group, #shab__page-or-group-delete, #shab__page-or-group-update\"))).length == 0 && !dragItemList ) {\r\n                    $(\".pmv__select-page-open-list\").removeClass('active');\r\n                }\r\n            });\r\n\r\n            //Сменяем страницу\r\n            $('.pmv__pages-sortable').on('click', ' .pmv__pages-btn-page', function() {\r\n                $(\".pmv__pages-btn-page\").removeClass(\"active\");\r\n                $(this).addClass(\"active\");\r\n                pageManagerVisualizator.selectPage( $(this).closest(\".pmv__pages-item\").attr(\"data-name\") );\r\n                if( $(\".pmv__select-page-open-list\").hasClass('active') ) {\r\n                    $(\".pmv__select-page-open-list\").removeClass('active');\r\n                }\r\n                sendSelectPage();\r\n            });\r\n\r\n            //Добавляем страницу\r\n            $('#modal-pmv-add-page-href .btn-select').on('click', function(event){\r\n                var urn = $('#modal-pmv-add-page-href .pmv-href').val();\r\n\r\n                //Проверяем на ошибки\r\n                $('.pmv__modal-urn-exists').css({display: \"\"});\r\n                $('.pmv__modal-urn-empty').css({display: \"\"});\r\n                $('.pmv__modal-add-page-content').removeClass(\"has-error\");\r\n\r\n                if($.trim(urn)) {\r\n                    if(session.getPage(urn) === false) {\r\n                        next();\r\n                    } else {\r\n                        $('.pmv__modal-urn-exists').css({display: \"block\"});\r\n                        $('.pmv__modal-add-page-content').addClass(\"has-error\");\r\n                    }\r\n                } else {\r\n                    $('.pmv__modal-urn-empty').css({display: \"block\"});\r\n                    $('.pmv__modal-add-page-content').addClass(\"has-error\");\r\n                }\r\n\r\n                //Добавляем страницу\r\n                function next() {\r\n                    $(\".pmv__pages-sortable > ul\").prepend( createMenuItem(\"page\", $.trim(urn)) );\r\n                    $('#modal-pmv-add-page-href .modal').modal('hide');\r\n\r\n                    sendAddPage();\r\n                }\r\n            });\r\n            $('.pmv__add-page').on('click', function(){\r\n                $('.pmv__modal-urn-exists').css({display: \"\"});\r\n                $('.pmv__modal-urn-empty').css({display: \"\"});\r\n                $('.pmv__modal-add-page-content').removeClass(\"has-error\");\r\n\r\n                if(pageManagerVisualizator._options.nameIFrame in window) {\r\n                    //отделить домен от urn\r\n                    $('#modal-pmv-add-page-href .pmv-href').val( window[pageManagerVisualizator._options.nameIFrame].window.location.href );\r\n                }\r\n                $('#modal-pmv-add-page-href .modal').modal('show');\r\n            });\r\n            $('#modal-pmv-add-page-href').on('shown.bs.modal', function(e){\r\n                var input = $('#modal-pmv-add-page-href .pmv-href');\r\n                //Выделение\r\n                input.get(0).focus();\r\n                //input.get(0).setSelectionRange(0, input.val().length);\r\n            });\r\n\r\n            //Добавляем группу\r\n            $('#pmv__modal-add-group .btn-select').on('click', function(event){\r\n                var name = $('#pmv__modal-add-group .pmv__modal-name-group').val();\r\n\r\n                //Проверяем на ошибки\r\n                $('#pmv__modal-add-group .pmv__modal-name-exists').css({display: \"\"});\r\n                $('#pmv__modal-add-group .pmv__modal-name-empty').css({display: \"\"});\r\n                $('.pmv__modal-add-group-content').removeClass(\"has-error\");\r\n                if($.trim(name)) {\r\n                    if(session.getGroup(name) === false) {\r\n                        next();\r\n                    } else {\r\n                        $('.pmv__modal-name-exists').css({display: \"block\"});\r\n                        $('.pmv__modal-add-group-content').addClass(\"has-error\");\r\n                    }\r\n                } else {\r\n                    $('#pmv__modal-add-group .pmv__modal-name-empty').css({display: \"block\"});\r\n                    $('.pmv__modal-add-group-content').addClass(\"has-error\");\r\n                }\r\n\r\n                //Добавляем группу\r\n                function next() {\r\n                    $(\".pmv__pages-sortable > ul\").prepend( createMenuItem(\"group\", $.trim(name)) );\r\n                    $('#pmv__modal-add-group .modal').modal('hide');\r\n\r\n                    sendAddPageGroup();\r\n                }\r\n            });\r\n            $('.pmv__add-group').on('click', function(){\r\n                $('#pmv__modal-add-group .pmv__modal-name-exists').css({display: \"\"});\r\n                $('#pmv__modal-add-group .pmv__modal-name-empty').css({display: \"\"});\r\n                $('.pmv__modal-add-group-content').removeClass(\"has-error\");\r\n\r\n                $('#pmv__modal-add-group .modal').modal('show');\r\n            });\r\n\r\n            //Удаляем страницу или группу\r\n            $('.pmv__pages-sortable').on('click', \" .pmv__pages-btn-delete\", function(){\r\n                if($(this).closest(\".pmv__pages-item\").hasClass(\"have-nested\")) {\r\n                    $(\"#shab__page-or-group-delete .shab__page-or-group-delete-nested-btn\").css({display: \"inline-block\"});\r\n                } else {\r\n                    $(\"#shab__page-or-group-delete .shab__page-or-group-delete-nested-btn\").css({display: \"none\"});\r\n                }\r\n\r\n                $('#shab__page-or-group-delete .modal').modal('show');\r\n\r\n                var name = $(this).closest(\".pmv__pages-item\").attr(\"data-name\");\r\n                var type = $(this).closest(\".pmv__pages-item\").attr(\"data-type\");\r\n                $('#shab__page-or-group-delete .shab__page-or-group__name')\r\n                    .attr(\"data-name\", name)\r\n                    .text(name);\r\n                $('#shab__page-or-group-delete .shab__page-or-group__type').text((type == \"page\")?\"страницу\":\"группу\");\r\n            });\r\n            $('#shab__page-or-group-delete .shab__page-or-group-delete-btn').on('click', function(){\r\n                var name = $('#shab__page-or-group-delete .shab__page-or-group__name').attr(\"data-name\");\r\n                var $cutItems = $(\".pmv__pages-item[data-name='\"+name+\"'] > ul > .pmv__pages-item\").remove();\r\n                $(\".pmv__pages-item[data-name='\"+name+\"']\").after($cutItems);\r\n                $(\".pmv__pages-item[data-name='\"+name+\"']\").remove();\r\n\r\n                var $main = $(\".pmv__pages-sortable\");\r\n                clearEmptyUl($main);\r\n                refreshNestedEl($main);\r\n                clearCollapseNotNested($main);\r\n\r\n                $('#shab__page-or-group-delete .modal').modal('hide');\r\n\r\n                sendDeletePageOrGroup();\r\n            });\r\n            $('#shab__page-or-group-delete .shab__page-or-group-delete-nested-btn').on('click', function(){\r\n                var name = $('#shab__page-or-group-delete .shab__page-or-group__name').attr(\"data-name\");\r\n                $(\".pmv__pages-item[data-name='\"+name+\"']\").remove();\r\n\r\n                var $main = $(\".pmv__pages-sortable\");\r\n                clearEmptyUl($main);\r\n                refreshNestedEl($main);\r\n                clearCollapseNotNested($main);\r\n\r\n                $('#shab__page-or-group-delete .modal').modal('hide');\r\n\r\n                sendDeletePageOrGroup();\r\n            });\r\n\r\n            //Обновляем страницу или группу\r\n            $('.pmv__pages-sortable').on('click', \" .pmv__pages-btn-edit\", function(){\r\n                $('#shab__page-or-group-update .modal').modal('show');\r\n\r\n                var name = $(this).closest(\".pmv__pages-item\").attr(\"data-name\");\r\n                var type = $(this).closest(\".pmv__pages-item\").attr(\"data-type\");\r\n                $('#shab__page-or-group-update .shab__page-or-group__name')\r\n                    .attr(\"data-name\", name);\r\n                $('#shab__page-or-group-update .shab__page-or-group-update__name').val(name);\r\n\r\n                $('#shab__page-or-group-update .shab__page-or-group__type').attr(\"data-type\", type).text((type == \"page\")?\"новый URN\":\"новое имя\");\r\n            });\r\n            $('#shab__page-or-group-update .btn-select').on('click', function(){\r\n                var name = $('#shab__page-or-group-update .shab__page-or-group__name').attr(\"data-name\");\r\n                var type = $('#shab__page-or-group-update .shab__page-or-group__type').attr(\"data-type\");\r\n                var newName = $('#shab__page-or-group-update .shab__page-or-group-update__name').val();\r\n\r\n                //Проверяем на ошибки\r\n                $('#shab__page-or-group-update .pmv__modal-urn-exists').css({display: \"\"});\r\n                $('#shab__page-or-group-update .pmv__modal-name-exists').css({display: \"\"});\r\n                $('#shab__page-or-group-update .pmv__modal-empty').css({display: \"\"});\r\n                $('#shab__page-or-group-update .pmv__modal-content').removeClass(\"has-error\");\r\n\r\n                if(type == \"page\") {\r\n                    if($.trim(newName)) {\r\n                        if(session.getPage(newName) === false) {\r\n                            next();\r\n                        } else {\r\n                            $('#shab__page-or-group-update .pmv__modal-urn-exists').css({display: \"block\"});\r\n                            $('#shab__page-or-group-update .pmv__modal-content').addClass(\"has-error\");\r\n                        }\r\n                    } else {\r\n                        $('#shab__page-or-group-update .pmv__modal-empty').css({display: \"block\"});\r\n                        $('#shab__page-or-group-update .pmv__modal-content').addClass(\"has-error\");\r\n                    }\r\n                } else {\r\n                    if($.trim(newName)) {\r\n                        if(session.getGroup(newName) === false) {\r\n                            next();\r\n                        } else {\r\n                            $('#shab__page-or-group-update .pmv__modal-name-exists').css({display: \"block\"});\r\n                            $('#shab__page-or-group-update .pmv__modal-content').addClass(\"has-error\");\r\n                        }\r\n                    } else {\r\n                        $('#shab__page-or-group-update .pmv__modal-empty').css({display: \"block\"});\r\n                        $('#shab__page-or-group-update .pmv__modal-content').addClass(\"has-error\");\r\n                    }\r\n                }\r\n\r\n                //Обновляем страницу\r\n                function next() {\r\n                    var $li = $(\".pmv__pages-sortable .pmv__pages-item[data-type='\"+type+\"'][data-name='\"+name+\"']\")\r\n                    $li.attr(\"data-name\", newName)\r\n                        .find(\" > * > .pmv__pages-btn-name\").text(newName);\r\n\r\n                    $('#shab__page-or-group-update .modal').modal('hide');\r\n\r\n                    if(type == \"page\") {\r\n                        if($li.find(\" .pmv__pages-btn-page\").hasClass(\"active\")) {\r\n                            pageManagerVisualizator.selectPage( newName );\r\n                            sendUpdatePageOrGroup();\r\n                            sendSelectPage();\r\n                        } else {\r\n                            sendUpdatePageOrGroup();\r\n                        }\r\n                    } else {\r\n                        sendUpdatePageOrGroup();\r\n                    }\r\n                }\r\n            });\r\n\r\n            //Коллапсируем-расколлапсируем пункты с вложенными пунктами\r\n            $(\".pmv__pages-sortable\").on(\"click\", \" .pmv__pages-btn-collapsed\", function(){\r\n                var $item = $(this).closest(\".pmv__pages-item\");\r\n                if( $item.hasClass(\"collapsed\") ) {\r\n                    $item.removeClass(\"collapsed\")\r\n                        .find(\" > ul\").css({display: \"block\"});\r\n                } else {\r\n                    $item.addClass(\"collapsed\")\r\n                        .find(\" > ul\").css({display: \"none\"});\r\n                }\r\n\r\n                sendCollapseUncollapsePageOrGroup();\r\n            });\r\n\r\n            //Запись и отправка данных сессии\r\n            function sendSelectPage() {\r\n                session.onSelectPage(pageManagerVisualizator.currentPage);\r\n            }\r\n            function sendAddPage() {\r\n                session.onChangePages(pagesNestedToJson($('.pmv__pages-sortable')));\r\n            }\r\n            function sendAddPageGroup() {\r\n                session.onChangePages(pagesNestedToJson($('.pmv__pages-sortable')));\r\n            }\r\n            function sendDeletePageOrGroup() {\r\n                session.onChangePages(pagesNestedToJson($('.pmv__pages-sortable')));\r\n            }\r\n            function sendUpdatePageOrGroup() {\r\n                //обновить нетолько меню но и страницу которую мозможно модифицировали\r\n                session.onUpdatePageOrGroup(pagesNestedToJson($('.pmv__pages-sortable')));\r\n            }\r\n            function sendSortablePageOrGroup() {\r\n                session.onChangePages(pagesNestedToJson($('.pmv__pages-sortable')));\r\n            }\r\n            function sendCollapseUncollapsePageOrGroup() {\r\n                session.onChangePages(pagesNestedToJson($('.pmv__pages-sortable')));\r\n            }\r\n\r\n            //Приём данных сессии\r\n            session.responseHandlers[\"onSelectPage\"] = function(o) {\r\n                //Получаем сессию без куков потому что м в куках и так будет записано текущее состояние сессии\r\n                var ls = session.getLocalSessionParams(true);\r\n                //Страница\r\n                if( ls && \"pages\" in ls && \"currentPage\" in ls.pages && (ls.pages.currentPage !== pageManagerVisualizator.currentPage && true) ) {\r\n                    $(\".pmv__pages-btn-page\").removeClass(\"active\");\r\n                    $(\".pmv__pages-item[data-name='\"+(ls.pages.currentPage)+\"'] > * > .pmv__pages-btn-page\").addClass(\"active\");\r\n                    pageManagerVisualizator.selectPage(ls.pages.currentPage);\r\n                }\r\n            }\r\n            session.responseHandlers[\"onChangePages\"] = function(o) {\r\n                refreshMenuPages();\r\n            }\r\n            session.responseHandlers[\"onUpdatePageOrGroup\"] = function(o) {\r\n                refreshMenuPages();\r\n            }\r\n\r\n            //Генерируем пункт меню\r\n            function createMenuItem(type, name) {\r\n                var _class = (type == \"page\")?\"page\":\"group btn-yellow\";\r\n                return '<li class=\"pmv__pages-item\" data-type=\"'+type+'\" data-name=\"'+name+'\">' +\r\n                    '<div class=\"pmv__pages-item-content\">' +\r\n                    '<button class=\"btn btn-default btn-xs pmv__pages-btn-collapsed\"><span class=\"glyphicon glyphicon-minus\"></span><span class=\"glyphicon glyphicon-plus\"></span></button>' +\r\n                    '<button class=\"btn btn-default btn-xs btn-block pmv__pages-btn-name pmv__pages-btn-'+_class+'\">'+name+'</button>' +\r\n                    '<button class=\"btn btn-default btn-xs pmv__pages-btn-delete\"><span class=\"glyphicon glyphicon-remove\"></span></button>' +\r\n                    '<button class=\"btn btn-default btn-xs pmv__pages-btn-edit\"><span class=\"glyphicon glyphicon-edit\"></span></button>' +\r\n                    '<div class=\"btn btn-default btn-xs pmv__pages-btn-drag\"><span class=\"glyphicon glyphicon-move\"></span></div>' +\r\n                    '</div>' +\r\n                    '</li>';\r\n\r\n            }\r\n\r\n            //Обновляем список страниц в верхнем меню\r\n            $(\".pmv__pages-sortable\").prepend(\"<ul class='pmv__pages-sortable-ul'></ul>\");\r\n            $(\".pmv__pages-sortable-ul\").nestedSortable({\r\n                forcePlaceholderSize: true,\r\n                handle: 'div',\r\n                items: 'li',\r\n                placeholder: 'placeholder',\r\n                revert: 250,\r\n                tabSize: 25,\r\n                toleranceElement: '> div',\r\n                listType: \"ul\",\r\n                helper:\t'clone',\r\n                maxLevels: 3,\r\n                isTree: true,\r\n                start: function () {\r\n                    dragItemList = true;\r\n                },\r\n                stop: function () {\r\n                    dragItemList = false;\r\n                },\r\n                update: function( event, ui ) {\r\n                    var $main = $(\".pmv__pages-sortable\");\r\n                    clearEmptyUl($main);\r\n                    refreshNestedEl($main);\r\n                    clearCollapseNotNested($main);\r\n                    sendSortablePageOrGroup();\r\n                }\r\n            });\r\n\r\n            refreshMenuPages();\r\n\r\n            function refreshMenuPages() {\r\n                var localSession = session.getLocalSessionParams();\r\n                dragItemList = false;\r\n                var $main = $(\".pmv__pages-sortable-ul\");\r\n                $main.empty();\r\n\r\n                var res = (function recursion(el, html) {\r\n                    //li\r\n                    for(var i in el) {\r\n                        var name = (el[i].type == \"page\") ? el[i].urn : el[i].name;\r\n                        var _class = (el[i].type == \"page\")?\"page\":\"group btn-yellow\";\r\n                        var active = (el[i].type == \"page\" && localSession && \"pages\" in localSession && localSession.pages.currentPage === name)?\"active\":\"\";\r\n                        html += \"<li class='pmv__pages-item \"+((\"collapsed\" in el[i] && el[i].collapsed)?\"collapsed\":\"\")+\"' data-type='\"+(el[i].type)+\"' data-name='\"+name+\"'>\";\r\n                        html += '<div class=\"pmv__pages-item-content\">' +\r\n                            '<button class=\"btn btn-default btn-xs pmv__pages-btn-collapsed\"><span class=\"glyphicon glyphicon-minus\"></span><span class=\"glyphicon glyphicon-plus\"></span></button>' +\r\n                            '<button class=\"btn btn-default btn-xs btn-block pmv__pages-btn-name pmv__pages-btn-'+_class+' '+active+'\">'+name+'</button>' +\r\n                            '<button class=\"btn btn-default btn-xs pmv__pages-btn-delete\"><span class=\"glyphicon glyphicon-remove\"></span></button>' +\r\n                            '<button class=\"btn btn-default btn-xs pmv__pages-btn-edit\"><span class=\"glyphicon glyphicon-edit\"></span></button>' +\r\n                            '<div class=\"btn btn-default btn-xs pmv__pages-btn-drag\"><span class=\"glyphicon glyphicon-move\"></span></div>' +\r\n                            '</div>';\r\n\r\n                        //sub\r\n                        if(\"sub\" in el[i]) {\r\n                            html = recursion(el[i].sub, html+\"<ul>\")+\"</ul>\";\r\n                        }\r\n                        //sub (end)\r\n\r\n                        html += \"</li>\";\r\n\r\n                    }\r\n                    //li (end)\r\n\r\n                    return html;\r\n                })(session.data.globalSession.pages, \"\");\r\n\r\n                $main.append(res);\r\n                refreshNestedEl($(\".pmv__pages-sortable\"));\r\n                refreshCollapsed($(\".pmv__pages-sortable\"));\r\n            }\r\n\r\n            //Парсинг страниц в json обьект\r\n            function pagesNestedToJson($main) {\r\n                var json = [], previousLevel = 0, stack = {\"0\":json};\r\n\r\n                $main.find(\".pmv__pages-item\").each(function() {\r\n                    var level = $(this).parents(\".pmv__pages-item\").length;\r\n                    if(level > previousLevel) {\r\n                        var obj = stack[previousLevel][stack[previousLevel].length-1];\r\n                        if(!(\"sub\" in obj)) {\r\n                            obj.sub = [];\r\n                            stack[level] = obj.sub;\r\n                        }\r\n                        stack[level].push(itemToJson($(this)));\r\n                    } else {\r\n                        stack[level].push(itemToJson($(this)));\r\n                    }\r\n                    previousLevel = level;\r\n                });\r\n\r\n                return json;\r\n            }\r\n\r\n                function itemToJson($item) {\r\n                    var obj = {};\r\n                    obj.type = $item.attr(\"data-type\");\r\n\r\n                    if($item.attr(\"data-type\") == \"page\") {\r\n                        obj.urn = $item.attr(\"data-name\");\r\n                    } else {\r\n                        obj.name = $item.attr(\"data-name\");\r\n                    }\r\n\r\n                    if($item.hasClass(\"collapsed\")) {\r\n                        obj.collapsed = true;\r\n                    }\r\n                    return obj;\r\n                }\r\n\r\n            //удаляем пустые тэги ul которые остаються после перестановки\r\n            function clearEmptyUl($main) {\r\n                $main.find(\" ul\").addClass(\"not-childrens\");\r\n                $main.find(\" ul > li\").each(function() {\r\n                    $(this).parent().removeClass(\"not-childrens\");\r\n                });\r\n                $main.find(\" ul.not-childrens\").remove();\r\n            }\r\n\r\n            //очитстить от коллапсов\r\n            function clearCollapseNotNested($main) {\r\n                $main.find(\" .pmv__pages-item\").each(function() {\r\n                    if(!$(this).hasClass(\"have-nested\")) {\r\n                        $(this).removeClass(\"collapsed\");\r\n                    }\r\n                });\r\n            }\r\n            function refreshNestedEl($main) {\r\n                //Вставляем класс для вложенных\r\n                $main.find(\" .pmv__pages-item\").removeClass(\"have-nested\");\r\n                $main.find(\" ul\").each(function() {\r\n                    if($(this).parent(\".pmv__pages-item\").length) {\r\n                        $(this).parent(\".pmv__pages-item\").addClass(\"have-nested\");\r\n                    }\r\n                });\r\n            }\r\n            function refreshCollapsed($main) {\r\n                //Коллапсируем рассколапсируем\r\n                $main.find(\" .pmv__pages-item.collapsed > ul\").css({display: \"none\"});\r\n                $main.find(\" .pmv__pages-item > ul\").not($main.find(\" .pmv__pages-item.collapsed > ul\")).css({display: \"block\"});\r\n            }\r\n\r\n            /****************************************************/\r\n            /*Разрешения*/\r\n            /****************************************************/\r\n            //Добавляем разрешение\r\n            $('#pp__modal-add-resolution .btn-select').on('click', function(event){\r\n                var hasError = false;\r\n                var w = $.trim($('#pp__modal-add-resolution .pp__modal-add-resolution-w').val());\r\n                var h = $.trim($('#pp__modal-add-resolution .pp__modal-add-resolution-h').val());\r\n\r\n                //Проверяем на ошибки\r\n                if(!(/^[1-9]\\w{2,4}$/gim.test(w) && parseInt(w) >= 320 && parseInt(w) <= 99999)) {\r\n                    hasError = true;\r\n                    $('#pp__modal-add-resolution .pp__modal-add-resolution-w-group').addClass(\"has-error\");\r\n                    $('#pp__modal-add-resolution .pp__modal-val-not-digit').css({display: \"block\"});\r\n                }\r\n                if(!(h == \"auto\" || (/^[1-9]\\w{2,4}$/gim.test(h) && parseInt(h) >= 320 && parseInt(h) <= 99999))) {\r\n                    hasError = true;\r\n                    $('#pp__modal-add-resolution .pp__modal-add-resolution-h-group').addClass(\"has-error\");\r\n                    $('#pp__modal-add-resolution .pp__modal-val-not-digit').css({display: \"block\"});\r\n                }\r\n                if(!hasError) {\r\n                    for(var i in session.data.globalSession.resolutions) {\r\n                        var one = session.data.globalSession.resolutions[i];\r\n                        if(parseInt(w) === one.w && (h === \"auto\" || parseInt(h) === one.h)) {\r\n                            hasError = true;\r\n                            $('#pp__modal-add-resolution .pp__modal-add-resolution-w-group').addClass(\"has-error\");\r\n                            $('#pp__modal-add-resolution .pp__modal-add-resolution-h-group').addClass(\"has-error\");\r\n                            $('#pp__modal-add-resolution .pp__modal-val-exists').css({display: \"block\"});\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                //Добавляем страницу\r\n                if(!hasError) {\r\n                    var html =\r\n                        \"<li class='pp__resolutions-list-resolution' data-w='\"+w+\"' data-h='\"+h+\"'>\" +\r\n                        '<div class=\"pp__resolutions-list-resolution-content\">' +\r\n                        '<button class=\"btn btn-default btn-xs btn-block pp__resolutionforscreen-name-btn\">' +\r\n                        '<span class=\"pp__resolutionforscreen-name-btn-w\">'+w+'</span> | <span class=\"pp__resolutionforscreen-name-btn-h\">'+h+'</span>' +\r\n                        '</button>' +\r\n                        '<button class=\"btn btn-default btn-xs pp__resolutions-delete-btn\"><span class=\"glyphicon glyphicon-remove\"></span></button>' +\r\n                        '<div class=\"btn btn-default btn-xs pp__resolutions-drag-btn\"><span class=\"glyphicon glyphicon-move\"></span></div>' +\r\n                        '</div>' +\r\n                        '<ul class=\"pp__resolutions-list-screenshots\"></ul>' +\r\n                        '</li>';\r\n\r\n                    $(\".pp__resolutions-screenshots-list\").prepend(html);\r\n\r\n                    $('#pp__modal-add-resolution .modal').modal('hide');\r\n\r\n                    sendAddResolution();\r\n                }\r\n            });\r\n            $('.pp__add-resolution-btn').on('click', function(){\r\n                $('#pp__modal-add-resolution .pp__modal-val-exists').css({display: \"\"});\r\n                $('#pp__modal-add-resolution .pp__modal-val-not-digit').css({display: \"\"});\r\n                $('#pp__modal-add-resolution .pp__modal-add-resolution-w-group').removeClass(\"has-error\");\r\n                $('#pp__modal-add-resolution .pp__modal-add-resolution-h-group').removeClass(\"has-error\");\r\n\r\n                $('#pp__modal-add-resolution .modal').modal('show');\r\n            });\r\n\r\n            //Удаляем разрешение\r\n            $('.pp__screenshots-menu').on('click', \" .pp__resolutions-delete-btn\", function(){\r\n                var w = $(this).closest(\".pp__resolutions-list-resolution\").attr(\"data-w\");\r\n                var h = $(this).closest(\".pp__resolutions-list-resolution\").attr(\"data-h\");\r\n                $('#pp__modal-delete-resolution .pp__modal-delete-resolution-w')\r\n                    .attr(\"data-w\", w)\r\n                    .text(w);\r\n                $('#pp__modal-delete-resolution .pp__modal-delete-resolution-h')\r\n                    .attr(\"data-h\", h)\r\n                    .text(h);\r\n                $('#pp__modal-delete-resolution .modal').modal('show');\r\n            });\r\n            $('#pp__modal-delete-resolution .btn-select').on('click', function(){\r\n                var w = $('#pp__modal-delete-resolution .pp__modal-delete-resolution-w').attr(\"data-w\");\r\n                var h = $('#pp__modal-delete-resolution .pp__modal-delete-resolution-h').attr(\"data-h\");\r\n\r\n                $('.pp__screenshots-menu .pp__resolutions-list-resolution[data-w=\"'+w+'\"][data-h=\"'+h+'\"]').remove();\r\n\r\n                $('#pp__modal-delete-resolution .modal').modal('hide');\r\n\r\n                sendDeleteResolution();\r\n            });\r\n\r\n            //Выбор разрешения\r\n            $(\".pp__resolutions-menu\").on(\"click\", \" .pp__resolution-name-btn\", function(){\r\n                var $li = $(this).closest(\".pp__resolutions-list-item\");\r\n\r\n                var w = $li.attr(\"data-w\");\r\n                var h = $li.attr(\"data-h\");\r\n\r\n                $(\".pp__resolutions-list-item, .pp__resolution-name-btn, .pp__resolutionforscreen-name-btn\").removeClass(\"active\");\r\n                $(\".pp__resolutions-list-item[data-w='\"+(w)+\"'][data-h='\"+(h)+\"']\")\r\n                    .addClass(\"active\")\r\n                    .find(\" .pp__resolution-name-btn\")\r\n                    .addClass(\"active\");\r\n                $(\".pp__resolutions-list-resolution[data-w='\"+(w)+\"'][data-h='\"+(h)+\"'] .pp__resolutionforscreen-name-btn\").addClass(\"active\");\r\n\r\n                sendSelectResolution(w, h);\r\n\r\n                pageManagerVisualizator.setSizeIFrame(w, h);\r\n            });\r\n\r\n            //Запись и отправка данных сессии\r\n            function sendAddResolution() {\r\n                session.onChangeResolutions(resolutionsToJson());\r\n                refreshMenuResolutions();\r\n            }\r\n\r\n            function sendDeleteResolution() {\r\n                session.onChangeResolutions(resolutionsToJson());\r\n                refreshMenuResolutions();\r\n\r\n                //обновить скриншоты\r\n                //crossModulesFunctions[\"pmv.refreshMenuViewScreenshotsForResolutions\"]();\r\n\r\n                session.onChangeScreenshots(crossModulesFunctions[\"pp.allScreenshotsForCurPageToJson\"]());\r\n                var screenshotsCollection = session.getCurrentRelatedScreenshotsCollection();\r\n                pixelPerfect.refreshScrins(screenshotsCollection, session.getScreenshotsObjList());\r\n            }\r\n            function sendSelectResolution(w, h) {\r\n                session.onSelectResolution({\r\n                    w: parseInt(w),\r\n                    h: (h != \"auto\")?parseInt(h):h\r\n                });\r\n\r\n                var screenshotsCollection = session.getCurrentRelatedScreenshotsCollection();\r\n                pixelPerfect.refreshScrins(screenshotsCollection, session.getScreenshotsObjList());\r\n            }\r\n            crossModulesFunctions[\"pmv.sendSortableResolutions\"] = function() {\r\n                session.onChangeResolutions(resolutionsToJson());\r\n                refreshMenuResolutions();\r\n                //\r\n                crossModulesFunctions[\"pmv.refreshMenuViewScreenshotsForResolutions\"]();\r\n            }\r\n\r\n            //Приём данных сессии\r\n            session.responseHandlers[\"onChangeResolutions\"] = function(o) {\r\n                refreshMenuResolutions();\r\n                //\r\n                crossModulesFunctions[\"pmv.refreshMenuViewScreenshotsForResolutions\"]();\r\n            }\r\n            session.responseHandlers[\"onSelectResolution\"] = function(o) {\r\n                //Получаем сессию без куков потому что м в куках и так будет записано текущее состояние сессии\r\n                var ls = session.getLocalSessionParams(true);\r\n                //Разрешение\r\n                if(ls && \"resolutions\" in ls && \"currentResolution\" in ls.resolutions) {\r\n                    $(\".pp__resolutions-list-item, .pp__resolution-name-btn, .pp__resolutionforscreen-name-btn\").removeClass(\"active\");\r\n                    $(\".pp__resolutions-list-item[data-w='\"+(o.val.w)+\"'][data-h='\"+(o.val.h)+\"']\")\r\n                        .addClass(\"active\")\r\n                        .find(\" .pp__resolution-name-btn\")\r\n                        .addClass(\"active\");\r\n                    $(\".pp__resolutions-list-resolution[data-w='\"+(o.val.w)+\"'][data-h='\"+(o.val.h)+\"'] .pp__resolutionforscreen-name-btn\").addClass(\"active\");\r\n\r\n                    pageManagerVisualizator.setSizeIFrame(ls.resolutions.currentResolution.w, ls.resolutions.currentResolution.h);\r\n                }\r\n\r\n                var screenshotsCollection = session.getCurrentRelatedScreenshotsCollection();\r\n                pixelPerfect.refreshScrins(screenshotsCollection, session.getScreenshotsObjList());\r\n            }\r\n\r\n            function resolutionsToJson() {\r\n                var resolutions = [];\r\n\r\n                $(\".pp__screenshots-menu-window .pp__resolutions-list-resolution\").each(function() {\r\n                    resolutions.push({\r\n                        w: parseInt($(this).attr(\"data-w\")),\r\n                        h: ($(this).attr(\"data-h\") != \"auto\")?parseInt($(this).attr(\"data-h\")):\"auto\"\r\n                    });\r\n                });\r\n\r\n                return resolutions;\r\n            }\r\n\r\n            refreshMenuResolutions();\r\n            function refreshMenuResolutions() {\r\n                var localSession = session.getLocalSessionParams();\r\n                //dragItemList = false;\r\n                var $main = $(\".pp__resolutions-list\");\r\n                $main.empty();\r\n\r\n                if(localSession && \"pages\" in localSession && localSession.pages.currentPage !== null) {\r\n                    var res = (function recursion(resolutions, html) {\r\n                        for(var i in resolutions) {\r\n                            var one = resolutions[i];\r\n                            var w = one.w;\r\n                            var h = one.h;\r\n                            var active = (localSession && \"resolutions\" in localSession && localSession.resolutions.currentResolution.w === w && localSession.resolutions.currentResolution.h === h)?\"active\":\"\";\r\n                            html += \"<li class='pp__resolutions-list-item' data-w='\"+w+\"' data-h='\"+h+\"'>\";\r\n                            html += '<div class=\"pp__resolutions-list-item-content\">' +\r\n                                '<button class=\"btn btn-default btn-xs btn-block pp__resolution-name-btn '+active+'\">' +\r\n                                '<span class=\"pp__resolution-name-btn-w\">'+w+'</span> | <span class=\"pp__resolution-name-btn-h\">'+h+'</span>' +\r\n                                '</button>' +\r\n                                '</div>';\r\n\r\n                            html += \"</li>\";\r\n                        }\r\n\r\n                        return html;\r\n                    })(session.data.globalSession.resolutions, \"\");\r\n\r\n                    $main.append(res);\r\n                }\r\n            }\r\n\r\n            /****************************************************/\r\n            /*Айфрейм*/\r\n            /****************************************************/\r\n            //Скролл\r\n            pageManagerVisualizator.$container.on(\"csif.scroll\", sendScrollIFrame);\r\n            pageManagerVisualizator.$container.on(\"fcar.scroll\", sendScrollIFrame);\r\n\r\n            //Смена позиции окна Айфрейма\r\n            pageManagerVisualizator.$container.on(\"mnif.changePos\", sendChangePosIFrame);\r\n\r\n            //Ресайз Айфрейма\r\n            var resizeIFrame__timeoutId = null;\r\n            var curSizeIFrame = null;\r\n            var lastSizeIFrame = null;\r\n            pageManagerVisualizator.$container.on(\"rifStartResize\", function() {\r\n                sendResizeIFrame();\r\n                resizeIFrame__timeoutId = setInterval(function() {\r\n                    if(curSizeIFrame !== null && (lastSizeIFrame.w !== curSizeIFrame.w || lastSizeIFrame.h !== curSizeIFrame.h)) {\r\n                        sendResizeIFrame();\r\n                    }\r\n                }, 500);\r\n            });\r\n            pageManagerVisualizator.$container.on(\"rifResize\", function() {\r\n                var $fittingWrap = $(\"#\"+(pageManagerVisualizator._options.nameIFrame)).closest(\".pmv-fitting-wrap\");\r\n                curSizeIFrame = {\r\n                    w: $fittingWrap.width(),\r\n                    h: $fittingWrap.height()\r\n                };\r\n            });\r\n            pageManagerVisualizator.$container.on(\"rifStopResize\", function() {\r\n                if(resizeIFrame__timeoutId !== null) {\r\n                    clearInterval(resizeIFrame__timeoutId);\r\n                    resizeIFrame__timeoutId = null;\r\n                    curSizeIFrame = null;\r\n                    lastSizeIFrame = null;\r\n                }\r\n                sendResizeIFrame();\r\n            });\r\n\r\n            //Запись и отправка данных сессии\r\n            function sendScrollIFrame() {\r\n                var iframe = window[pageManagerVisualizator._options.nameIFrame];\r\n                var wWindow, wDocument, leftScroll, l_factor, hWindow, hDocument, topScroll, t_factor;\r\n\r\n                wWindow = $(iframe.window).width();\r\n                wDocument = $(iframe.document).width();\r\n                hWindow = $(iframe.window).height();\r\n                hDocument = $(iframe.document).height();\r\n                topScroll = $(iframe.window).scrollTop();\r\n                leftScroll = $(iframe.window).scrollLeft();\r\n\r\n                if(wDocument - wWindow == 0){l_factor = 0} else {l_factor = leftScroll / (wDocument - wWindow)}\r\n                if(hDocument - hWindow == 0){t_factor = 0} else {t_factor = topScroll / (hDocument - hWindow)}\r\n\r\n                session.onScrollIFrame({\r\n                    left: l_factor,\r\n                    top: t_factor\r\n                });\r\n            }\r\n            function sendChangePosIFrame() {\r\n                var $iframe = $(\"#\" + (pageManagerVisualizator._options.nameIFrame));\r\n                var $fittingWrap = $iframe.closest(\".pmv-fitting-wrap\");\r\n                var $outerWrap = $iframe.closest(\".pmv-outer-wrap\");\r\n                var w, h, w_c, h_c, l, t, l_factor, t_factor;\r\n\r\n                w = $fittingWrap.width();\r\n                h = $fittingWrap.height();\r\n                t =   $fittingWrap.position().top;\r\n                l =   $fittingWrap.position().left;\r\n                w_c = $outerWrap.width();\r\n                h_c = $outerWrap.height();\r\n\r\n                if(w_c - w == 0){l_factor = 0} else {l_factor = l / (w_c - w)}\r\n                if(h_c - h == 0){t_factor = 0} else {t_factor = t / (h_c - h)}\r\n\r\n                session.onChangePosIFrame({\r\n                    left: l_factor,\r\n                    top: t_factor\r\n                });\r\n            }\r\n            function sendResizeIFrame() {\r\n                var $fittingWrap = $(\"#\"+(pageManagerVisualizator._options.nameIFrame)).closest(\".pmv-fitting-wrap\");\r\n                lastSizeIFrame = {\r\n                    w: $fittingWrap.width(),\r\n                    h: $fittingWrap.height()\r\n                };\r\n                session.onResizeIFrame(lastSizeIFrame);\r\n            }\r\n\r\n            //Приём данных сессии\r\n            session.responseHandlers[\"onResizeIFrame\"] = function(o) {\r\n                var ls = session.getLocalSessionParams(true);\r\n                if( ls && \"iframe\" in ls && \"size\" in ls.iframe ) {\r\n                    pageManagerVisualizator.setSizeIFrame(ls.iframe.size.w, ls.iframe.size.h, true);\r\n                }\r\n            }\r\n            session.responseHandlers[\"onChangePosIFrame\"] = function(o) {\r\n                var ls = session.getLocalSessionParams(true);\r\n                if( ls && \"iframe\" in ls && \"position\" in ls.iframe ) {\r\n                    pageManagerVisualizator.setPositionIFrame(ls.iframe.position.left, ls.iframe.position.top);\r\n                }\r\n            }\r\n            session.responseHandlers[\"onScrollIFrame\"] = function(o) {\r\n                var ls = session.getLocalSessionParams(true);\r\n                if( ls && \"iframe\" in ls && \"scroll\" in ls.iframe ) {\r\n                    pageManagerVisualizator.setScrollIFrame(ls.iframe.scroll.left, ls.iframe.scroll.top);\r\n                }\r\n            }\r\n\r\n            //При загрузке iFrame скрываем всё окно шаблонизатора и показываем анимацию загрузки\r\n            pageManagerVisualizator.$container.on({\r\n                \"pmv.prepaste.iframe\": function() {\r\n                    $( \"#loading\" )\r\n                        .css({width: \"100%\", height: \"100%\"})\r\n                        .addClass( \"show\" );\r\n                },\r\n                \"pmv.load.iframe\": function() {\r\n                    $( \"#loading\" ).removeClass( \"show\" );\r\n                    setTimeout(function() {\r\n                        $( \"#loading\" ).css({width: \"0\", height: \"0\"});\r\n                    }, 500);\r\n                }\r\n            });\r\n\r\n            pageManagerVisualizator._create();\r\n        })();\r\n\r\n        /****************************************************/\r\n        /*Пиксель перфект*/\r\n        /****************************************************/\r\n        (function() {\r\n            pixelPerfect = new modules.pixelPerfect($(\"#wrap_iframe .pmv-fitting-wrap\"), {\r\n                dirScrins: \"design-screenshots\",\r\n                nameIFrame: \"PP_iframe\"\r\n            });\r\n\r\n            pageManagerVisualizator.$container.on( \"pmv.load.iframe\", function(){\r\n                pixelPerfect._destroy();\r\n                pixelPerfect._create();\r\n\r\n                var screenshotsCollection = session.getCurrentRelatedScreenshotsCollection();\r\n                pixelPerfect.refreshScrins(screenshotsCollection, session.getScreenshotsObjList());\r\n\r\n                var ls = session.getLocalSessionParams(false);\r\n                if(ls && \"resolutions\" in ls && \"showPageProofsOrDesign\" in ls.resolutions) {\r\n                    pixelPerfect.showPageProofsOrDesign(ls.resolutions.showPageProofsOrDesign);\r\n                }\r\n\r\n                refreshMenuViewScreenshotsForResolutions();\r\n            });\r\n\r\n            //Скроллбар для списка скриншотов привязанных к разрешениям и страницам\r\n            $(\".pp__screenshots-menu-scrollwrap, .pp__screenshots-files-menu-scrollwrap, .pp__screenshot-thumbnail-scrollwrap\").mCustomScrollbar({\r\n                axis: \"y\",\r\n                theme: \"dark\",\r\n                scrollbarPosition: \"outside\",\r\n                scrollInertia: 100,\r\n                mouseWheel: {\r\n                    scrollAmount: 100\r\n                },\r\n                callbacks: {\r\n                    onUpdate: function() {\r\n                        /*if($(\".pmv__pages-sortable-scrollwrap\").hasClass(\"_mCS_1 mCS_no_scrollbar\")) {\r\n                            $(\".pmv__pages-window\").addClass(\"no-scrollbar\");\r\n                        } else {\r\n                            $(\".pmv__pages-window\").removeClass(\"no-scrollbar\");\r\n                        }*/\r\n                    }\r\n                }\r\n            });\r\n\r\n            //Свернуть-развернуть список скриншотов привязанных к разрешениям и страницам\r\n            $(\".pp__btn-open-screenshots\").on(\"click\", function () {\r\n                if(!$(this).hasClass('active')) {\r\n                    $(this).addClass('active');\r\n                    $(\".pp__screenshots-menu-window, .pp__screenshots-files-menu-scrollwrap\").addClass('open');\r\n                } else {\r\n                    $(this).removeClass('active');\r\n                    $(\".pp__screenshots-menu-window, .pp__screenshots-files-menu-scrollwrap\").removeClass('open');\r\n                }\r\n            });\r\n            $(\"body\").on(\"click click.body.iframe\", function (e) {\r\n                if( $(e.target).closest($(\".pp__btn-open-screenshots\").add($(\".pp__screenshots-menu-window, .pp__screenshots-files-menu-scrollwrap, .pp__screenshot-thumbnail-scrollwrap, .pp__resolutions-menu, #pp__modal-add-resolution, #pp__modal-delete-resolution\"))).length == 0 ) {\r\n                    $(\".pp__btn-open-screenshots\").removeClass('active');\r\n                    $(\".pp__screenshots-menu-window, .pp__screenshots-files-menu-scrollwrap, .pp__screenshot-thumbnail-scrollwrap\").removeClass('open');\r\n                }\r\n            });\r\n\r\n            //Привязываем скриншот\r\n            $('.pp__screenshots-files-menu-scrollwrap').on('click', \" .pp__screenshots-btn-add-screenshot\", function(){\r\n                if($(\".pp__screenshots-menu-scrollwrap .pp__resolutions-list-resolution\").length) {\r\n                    var $li = $(this).closest(\".pp__screenshots-item\");\r\n                    var urn = $li.attr(\"data-urn\");\r\n                    var $size = $li.find(\" .pp__screenshots-btn-size\");\r\n                    var w = $size.attr(\"data-w\");\r\n                    var h = $size.attr(\"data-h\");\r\n                    var html = '' +\r\n                        '<li class=\"pp__resolutions-list-screenshot\" data-urn=\"'+urn+'\" data-w=\"'+w+'\" data-h=\"'+h+'\">' +\r\n                            '<div class=\"pp__screenshot-content\">' +\r\n                                '<button class=\"btn btn-default btn-xs btn-block pp__screenshot-name-btn\">' +\r\n                                    '<div class=\"btn btn-default btn-xs pp__resolutions-screenshots-btn-size\" data-w=\"'+w+'\" data-h=\"'+h+'\">' +\r\n                                        '<span class=\"pp__screenshot-name-btn-w\">'+w+'</span> | <span class=\"pp__screenshot-name-btn-h\">'+h+'</span>' +\r\n                                    '</div>' +\r\n                                    urn +\r\n                                '</button>' +\r\n                                '<button class=\"btn btn-default btn-xs pp__resolutions-screenshots-delete-btn\"><span class=\"glyphicon glyphicon-remove\"></span></button>' +\r\n                                '<div class=\"btn btn-default btn-xs pp__resolutions-screenshots-drag-btn\"><span class=\"glyphicon glyphicon-move\"></span></div>' +\r\n                                '<button class=\"pp__resolutions-screenshots-btn-deviation btn btn-default btn-xs\"><i class=\"glyphicon glyphicon-option-vertical\" aria-hidden=\"true\"></i></button>' +\r\n                            '</div>' +\r\n                        '</li>';\r\n\r\n                    $(\".pp__screenshots-menu-scrollwrap .pp__resolutions-list-screenshots\")\r\n                        .first()\r\n                        .prepend($(html));\r\n\r\n                    sendBindScreenshot();\r\n                }\r\n            });\r\n\r\n            //Удаляем (отвязываем) скриншот\r\n            $('.pp__screenshots-menu').on('click', \" .pp__resolutions-screenshots-delete-btn\", function(e){\r\n                e.stopPropagation();\r\n                $(this).closest(\".pp__resolutions-list-screenshot\").remove();\r\n\r\n                sendUnbindScreenshot();\r\n            });\r\n\r\n            //Активируем-деактивируем скриншот\r\n            $('.pp__screenshots-menu').on('click', ' .pp__screenshot-name-btn', function() {\r\n                var $li = $(this).closest(\".pp__resolutions-list-screenshot\");\r\n\r\n                if(!$(this).hasClass(\"active\")) {\r\n                    $(this).addClass(\"active\");\r\n                    $li.addClass(\"active\").data(\"screenshot\").active = true;\r\n                } else {\r\n                    $(this).removeClass(\"active\");\r\n                    $li.removeClass(\"active\").data(\"screenshot\").active = false;\r\n                }\r\n\r\n                sendActiveScreenshot();\r\n            });\r\n\r\n            //Показываем-скрываем окно \"отклонения\" для скриншота\r\n            $('.pp__screenshots-menu').on('click', \" .pp__resolutions-screenshots-btn-deviation\", function(e){\r\n                var _ = $(this).closest(\".pp__resolutions-list-screenshot\").data(\"screenshot\");\r\n                $(\".pp__deviation\").data(\"screenshot\", _);\r\n                setParamDeviation($(\".pp__deviation\"), _.pos, _.l, _.t, _.lpx, _.lper, _.tpx, _.tper);\r\n\r\n                $('.pp__deviation').addClass(\"open\");\r\n            });\r\n            $(\"body\").on(\"click click.body.iframe\", function (e) {\r\n                if( $(e.target).closest($(\".pp__resolutions-screenshots-btn-deviation\").add($(\".pp__deviation\"))).length == 0 ) {\r\n                    $('.pp__deviation').removeClass(\"open\");\r\n                }\r\n            });\r\n\r\n            //Смена \"Static\" и \"Fixed\" в \"окне отклонения\"\r\n            $('.pp__screenshots-menu-window').on(\"click\", \" .pp__deviation-fixed-or-static label\", function(){\r\n                if($(\".pp__deviation\").data(\"screenshot\") !== undefined) {\r\n                    var pos = ($(this).find(\" input\").val() == 1)?\"static\":\"fixed\";\r\n                    var b = $(\".pp__deviation\").data(\"screenshot\");\r\n\r\n                    b.pos = pos;\r\n\r\n                    if(b.pos == \"static\") {\r\n                        b.t = \"top\";\r\n                    }\r\n\r\n                    setParamDeviation__relative($(\".pp__deviation\"), b.pos, b.l, b.t);\r\n\r\n                    sendChangeSOrFScreenshotDeviation();\r\n                }\r\n            });\r\n\r\n            //Смена положения в сетке в \"окне отклонения\"\r\n            $('.pp__screenshots-menu-window').on(\"click\", \" .pp__deviation-relative .btn[data-left][data-top]\", function(){\r\n                if($(\".pp__deviation\").data(\"screenshot\") !== undefined) {\r\n                    var b = $(\".pp__deviation\").data(\"screenshot\");\r\n                    if(!(b.pos == \"static\" && $(this).attr(\"data-top\") != \"top\")) {\r\n                        b.l = $(this).attr(\"data-left\");\r\n                        b.t = $(this).attr(\"data-top\");\r\n\r\n                        setParamDeviation__relative($(\".pp__deviation\"), b.pos, b.l, b.t);\r\n\r\n                        sendChangeGridScreenshotDeviation();\r\n                    }\r\n                }\r\n            });\r\n\r\n            //Изменение значений отклонения в окне \"отклонения\"\r\n            function startDeviationSpinner(e, ui) {\r\n                sendStartSpinnerScreenshotDeviation(e, ui);\r\n            }\r\n            function spinDeviationSpinner(e, ui) {\r\n                sendSpinSpinnerScreenshotDeviation(e, ui);\r\n            }\r\n            function stopDeviationSpinner(e, ui) {\r\n                sendStopSpinnerScreenshotDeviation(e, ui);\r\n            }\r\n\r\n            //коллапсировать-рассколапсировать\r\n            $(\".pp__screenshots-files-menu-scrollwrap\").on(\"click\", \" .pp__screenshots-btn-collapsed\", function(){\r\n                var $item = $(this).closest(\".pp__screenshots-item\");\r\n                if( $item.hasClass(\"collapsed\") ) {\r\n                    $item.removeClass(\"collapsed\")\r\n                        .find(\" > ul\").css({display: \"block\"});\r\n                } else {\r\n                    $item.addClass(\"collapsed\")\r\n                        .find(\" > ul\").css({display: \"none\"});\r\n                }\r\n\r\n                sendCollapseUncollapseScreenshotsFolder();\r\n            });\r\n\r\n            //Показать верстку или скрины или 50 на 50\r\n            $('.pp__verstka-btn').on('click', function(){\r\n                pixelPerfect.showPageProofsOrDesign(0);\r\n                refreshButtonsPageProofsOrDesign(0);\r\n                sendHTMLOrDesign(0);\r\n            });\r\n            $('.pp__50p-btn').on('click', function(){\r\n                pixelPerfect.showPageProofsOrDesign(1);\r\n                refreshButtonsPageProofsOrDesign(1);\r\n                sendHTMLOrDesign(1);\r\n            });\r\n            $('.pp__design-btn').on('click', function(){\r\n                pixelPerfect.showPageProofsOrDesign(2);\r\n                refreshButtonsPageProofsOrDesign(2);\r\n                sendHTMLOrDesign(2);\r\n            });\r\n\r\n            //Горячие клавишы\r\n            $('body').on('keydown', handlerFastChangePageProofsOrDesign);\r\n            pageManagerVisualizator.$container.on( \"pmv.load.iframe\", function(){\r\n                $('#'+(pageManagerVisualizator._options.nameIFrame)).contents().find(\"body\").on('keydown', handlerFastChangePageProofsOrDesign);\r\n            });\r\n            function handlerFastChangePageProofsOrDesign(e) {\r\n                if(e.which == 81 && e.ctrlKey && !e.shiftKey && !e.altKey)//(e.which == 65 || e.which == 83 || e.which == 68)\r\n                {\r\n                    if($('.pp__50p-btn, .pp__design-btn').hasClass('active'))\r\n                    {\r\n                        pixelPerfect.showPageProofsOrDesign(0);\r\n                        sendHTMLOrDesign(0);\r\n                    }\r\n                    else\r\n                    {\r\n                        pixelPerfect.showPageProofsOrDesign(1);\r\n                        sendHTMLOrDesign(1);\r\n                    }\r\n\r\n                    e = e || window.e; if (e.stopPropagation) {e.stopPropagation()} else {e.cancelBubble = true} e.preventDefault();\r\n                }\r\n            }\r\n\r\n            crossModulesFunctions[\"pp.refreshButtonsPageProofsOrDesign\"] = function(show) {\r\n                $('.pp__verstka-design .btn').removeClass(\"active btn-primary btn-success btn-info btn-warning btn-danger\").addClass(\"btn-default\");\r\n                switch (show) {\r\n                    case 0:\r\n                        $('.pp__verstka-btn').removeClass(\"btn-default\").addClass(\"active btn-primary\");\r\n                        break;\r\n                    case 1:\r\n                        $('.pp__50p-btn').removeClass(\"btn-default\").addClass(\"active btn-warning\");\r\n                        break;\r\n                    case 2:\r\n                        $('.pp__design-btn').removeClass(\"btn-default\").addClass(\"active btn-danger\");\r\n                        break;\r\n                }\r\n            }\r\n            function refreshButtonsPageProofsOrDesign(show) {\r\n                crossModulesFunctions[\"pp.refreshButtonsPageProofsOrDesign\"](show);\r\n            }\r\n\r\n            //Запись и отправка данных сессии\r\n            var screenshotsCollectionTemp;\r\n            var screenshotsObjListTemp;\r\n            var allScreenshotsForCurPageToJsonTemp;\r\n\r\n            function sendBindScreenshot() {\r\n                session.onChangeScreenshots(allScreenshotsForCurPageToJson());\r\n\r\n                var screenshotsCollection = session.getCurrentRelatedScreenshotsCollection();\r\n                pixelPerfect.refreshScrins(screenshotsCollection, session.getScreenshotsObjList());\r\n            }\r\n            function sendUnbindScreenshot() {\r\n                session.onChangeScreenshots(allScreenshotsForCurPageToJson());\r\n\r\n                var screenshotsCollection = session.getCurrentRelatedScreenshotsCollection();\r\n                pixelPerfect.refreshScrins(screenshotsCollection, session.getScreenshotsObjList());\r\n            }\r\n            function sendSortableScreenshot() {\r\n                session.onChangeScreenshots(allScreenshotsForCurPageToJson());\r\n\r\n                var screenshotsCollection = session.getCurrentRelatedScreenshotsCollection();\r\n                pixelPerfect.refreshScrins(screenshotsCollection, session.getScreenshotsObjList());\r\n            }\r\n            function sendActiveScreenshot() {\r\n                session.onChangeScreenshots(allScreenshotsForCurPageToJson());\r\n\r\n                var screenshotsCollection = session.getCurrentRelatedScreenshotsCollection();\r\n                pixelPerfect.refreshScrins(screenshotsCollection, session.getScreenshotsObjList());\r\n            }\r\n            function sendChangeSOrFScreenshotDeviation() {\r\n                session.onChangeScreenshots(allScreenshotsForCurPageToJson());\r\n\r\n                var screenshotsCollection = session.getCurrentRelatedScreenshotsCollection();\r\n                pixelPerfect.refreshScrins(screenshotsCollection, session.getScreenshotsObjList());\r\n            }\r\n            function sendChangeGridScreenshotDeviation() {\r\n                session.onChangeScreenshots(allScreenshotsForCurPageToJson());\r\n\r\n                var screenshotsCollection = session.getCurrentRelatedScreenshotsCollection();\r\n                pixelPerfect.refreshScrins(screenshotsCollection, session.getScreenshotsObjList());\r\n            }\r\n            function sendStartSpinnerScreenshotDeviation(e, ui) {\r\n                if($(\".pp__deviation\").data(\"screenshot\") !== undefined) {\r\n                    var b = $(\".pp__deviation\").data(\"screenshot\");\r\n\r\n                    if($(e.currentTarget).hasClass(\"pp__deviation-left-px\")){b.lpx = parseInt($(e.currentTarget).val())}\r\n                    else if($(e.currentTarget).hasClass(\"pp__deviation-left-percent\")){b.lper = parseFloat($(e.currentTarget).val())}\r\n                    else if($(e.currentTarget).hasClass(\"pp__deviation-top-px\")){b.tpx = parseInt($(e.currentTarget).val())}\r\n                    else if($(e.currentTarget).hasClass(\"pp__deviation-top-percent\")){b.tper = parseFloat($(e.currentTarget).val())}\r\n\r\n                    allScreenshotsForCurPageToJsonTemp = allScreenshotsForCurPageToJson();\r\n                    session.onChangeScreenshots(allScreenshotsForCurPageToJsonTemp);\r\n                    screenshotsCollectionTemp = session.getCurrentRelatedScreenshotsCollection();\r\n                    screenshotsObjListTemp = session.getScreenshotsObjList();\r\n                    pixelPerfect.refreshScrins(screenshotsCollectionTemp, screenshotsObjListTemp);\r\n                }\r\n            }\r\n            function sendSpinSpinnerScreenshotDeviation(e, ui) {\r\n                if($(\".pp__deviation\").data(\"screenshot\") !== undefined) {\r\n                    var b = $(\".pp__deviation\").data(\"screenshot\");\r\n\r\n                    if($(e.currentTarget).hasClass(\"pp__deviation-left-px\")){b.lpx = parseInt($(e.currentTarget).val())}\r\n                    else if($(e.currentTarget).hasClass(\"pp__deviation-left-percent\")){b.lper = parseFloat($(e.currentTarget).val())}\r\n                    else if($(e.currentTarget).hasClass(\"pp__deviation-top-px\")){b.tpx = parseInt($(e.currentTarget).val())}\r\n                    else if($(e.currentTarget).hasClass(\"pp__deviation-top-percent\")){b.tper = parseFloat($(e.currentTarget).val())}\r\n\r\n                    session.onFastChangeScreenshots(allScreenshotsForCurPageToJsonTemp);//Fast\r\n                    pixelPerfect.refreshScrins(screenshotsCollectionTemp, screenshotsObjListTemp);\r\n                }\r\n            }\r\n            function sendStopSpinnerScreenshotDeviation(e, ui) {\r\n                if($(\".pp__deviation\").data(\"screenshot\") !== undefined) {\r\n                    var b = $(\".pp__deviation\").data(\"screenshot\");\r\n\r\n                    if($(e.currentTarget).hasClass(\"pp__deviation-left-px\")){b.lpx = parseInt($(e.currentTarget).val())}\r\n                    else if($(e.currentTarget).hasClass(\"pp__deviation-left-percent\")){b.lper = parseFloat($(e.currentTarget).val())}\r\n                    else if($(e.currentTarget).hasClass(\"pp__deviation-top-px\")){b.tpx = parseInt($(e.currentTarget).val())}\r\n                    else if($(e.currentTarget).hasClass(\"pp__deviation-top-percent\")){b.tper = parseFloat($(e.currentTarget).val())}\r\n\r\n                    session.onChangeScreenshots(allScreenshotsForCurPageToJson());\r\n\r\n                    var screenshotsCollection = session.getCurrentRelatedScreenshotsCollection();\r\n                    pixelPerfect.refreshScrins(screenshotsCollection, session.getScreenshotsObjList());\r\n                }\r\n            }\r\n\r\n            function sendCollapseUncollapseScreenshotsFolder() {\r\n                session.onCollapseUncollapseScreenshotsFolder(collapseUncollapseScreenshotsFolderToJson($(\".pp__screenshots-files-menu-scrollwrap\")));\r\n            }\r\n\r\n            function sendHTMLOrDesign(state) {\r\n                session.onHTMLOrDesign(state);\r\n            }\r\n\r\n            //Приём данных сессии\r\n            session.responseHandlers[\"onChangeScreenshots\"] = function() {\r\n                refreshMenuViewScreenshotsForResolutions();\r\n\r\n                var screenshotsCollection = session.getCurrentRelatedScreenshotsCollection();\r\n                pixelPerfect.refreshScrins(screenshotsCollection, session.getScreenshotsObjList());\r\n            }\r\n            session.responseHandlers[\"onFastChangeScreenshots\"] = function() {\r\n                //console.time(\"dd\");\r\n                var screenshotsCollection = session.getCurrentRelatedScreenshotsCollection();\r\n                //console.timeEnd(\"dd\");\r\n                pixelPerfect.refreshScrins(screenshotsCollection, session.getScreenshotsObjList());\r\n            }\r\n            session.responseHandlers[\"onCollapseUncollapseScreenshotsFolder\"] = function() {\r\n                refreshMenuAllScreenshots();\r\n            }\r\n            session.responseHandlers[\"onHTMLOrDesign\"] = function() {\r\n                var ls = session.getLocalSessionParams(true);\r\n                if(ls && \"resolutions\" in ls && \"showPageProofsOrDesign\" in ls.resolutions) {\r\n                    pixelPerfect.showPageProofsOrDesign(ls.resolutions.showPageProofsOrDesign);\r\n                    crossModulesFunctions[\"pp.refreshButtonsPageProofsOrDesign\"](ls.resolutions.showPageProofsOrDesign);\r\n                }\r\n            }\r\n\r\n            //Все скриншоты для текущей страницы в json\r\n            crossModulesFunctions[\"pp.allScreenshotsForCurPageToJson\"] = function () {\r\n                return allScreenshotsForCurPageToJson();\r\n            }\r\n            function allScreenshotsForCurPageToJson() {\r\n                var newScreenshotsForCurPage = {};\r\n\r\n                $(\".pp__screenshots-menu-window .pp__resolutions-list-screenshot\").each(function() {\r\n                    var $liResolution = $(this).closest(\".pp__resolutions-list-resolution\");\r\n                    var w = $liResolution.attr(\"data-w\");\r\n                    var h = $liResolution.attr(\"data-h\");\r\n                    var w_h = w+\"|\"+h;\r\n\r\n                    if(!(w_h in newScreenshotsForCurPage)) {\r\n                        newScreenshotsForCurPage[w_h] = [];\r\n                    }\r\n\r\n                    var newScrinshot;\r\n                    if($(this).data(\"screenshot\") === undefined) {\r\n                        newScrinshot = {\r\n                            urn: $(this).attr(\"data-urn\"),\r\n                            active: false,\r\n                            pos: \"static\",\r\n                            l: \"center\",\r\n                            t: \"top\",\r\n                            lpx: 0,\r\n                            tpx: 0,\r\n                            lper: 0,\r\n                            tper: 0\r\n                        };\r\n                        $(this).data(\"screenshot\", newScrinshot);\r\n                    }\r\n                    newScreenshotsForCurPage[w_h].push($(this).data(\"screenshot\"));\r\n                });\r\n\r\n                return newScreenshotsForCurPage;\r\n            }\r\n            //Формируем список разрешений с списком привязанных скриншотов\r\n\r\n            $(\".pp__screenshots-menu\").prepend(\"<ul class='pp__resolutions-screenshots-list'></ul>\");\r\n            refreshMenuViewScreenshotsForResolutions();\r\n            $(\".pp__resolutions-screenshots-list\").sortable({\r\n                revert: true,\r\n                cursor: 'move',\r\n                axis: 'y',\r\n                items: ' > li',\r\n                distance: 5,\r\n                placeholder: \"placeholder\",\r\n                forceHelperSize: true,\r\n                forcePlaceholderSize: true,\r\n                /*placeholder: {\r\n                    /!*element: function(currentItem) {\r\n                     return $('<div class=\"sm-placeholder-media\"></div>').height( currentItem.outerHeight() );\r\n                     },*!/\r\n                    update: function(container, p) {\r\n                        return;\r\n                    }\r\n                },*/\r\n                update: crossModulesFunctions[\"pmv.sendSortableResolutions\"]\r\n            });\r\n            var allScreenshotsForCurPageTemp;\r\n            crossModulesFunctions[\"pmv.refreshMenuViewScreenshotsForResolutions\"] = function() {\r\n                refreshMenuViewScreenshotsForResolutions();\r\n            }\r\n            function refreshMenuViewScreenshotsForResolutions() {\r\n                var localSession = session.getLocalSessionParams();\r\n                allScreenshotsForCurPageTemp = [];\r\n                //dragItemList = false;\r\n                var $main = $(\".pp__resolutions-screenshots-list\");\r\n                $main.empty();\r\n\r\n                if(localSession && \"pages\" in localSession && localSession.pages.currentPage !== null) {\r\n                    var res = (function recursion(resolutions, html) {\r\n                        for(var i in resolutions) {\r\n                            var one = resolutions[i];\r\n                            var w = one.w;\r\n                            var h = one.h;\r\n                            var active = (localSession && \"resolutions\" in localSession && localSession.resolutions.currentResolution.w === w && localSession.resolutions.currentResolution.h === h)?\"active\":\"\";\r\n                            html += \"<li class='pp__resolutions-list-resolution' data-w='\"+w+\"' data-h='\"+h+\"'>\";\r\n                            html += '<div class=\"pp__resolutions-list-resolution-content\">' +\r\n                                '<button class=\"btn btn-default btn-xs btn-block pp__resolutionforscreen-name-btn '+active+'\">' +\r\n                                '<span class=\"pp__resolutionforscreen-name-btn-w\">'+w+'</span> | <span class=\"pp__resolutionforscreen-name-btn-h\">'+h+'</span>' +\r\n                                '</button>' +\r\n                                '<button class=\"btn btn-default btn-xs pp__resolutions-delete-btn\"><span class=\"glyphicon glyphicon-remove\"></span></button>' +\r\n                                '<div class=\"btn btn-default btn-xs pp__resolutions-drag-btn\"><span class=\"glyphicon glyphicon-move\"></span></div>' +\r\n                                '</div>';\r\n\r\n\r\n                            html += \"<ul class='pp__resolutions-list-screenshots'>\" + createScreenshotsList(localSession.pages.currentPage, one, session.data.globalSession.designScreenshotsRelatedResolutionAndPage) + \"</ul>\";\r\n\r\n                            html += \"</li>\";\r\n                        }\r\n\r\n                        return html;\r\n                    })(session.data.globalSession.resolutions, \"\");\r\n\r\n                    $main.append(res);\r\n\r\n                    var i = 0;\r\n                    $main.find(\" .pp__resolutions-list-screenshot\").each(function() {\r\n                        $(this).data(\"screenshot\", allScreenshotsForCurPageTemp[i]);\r\n                        i++;\r\n                    });\r\n                }\r\n                refreshSortableScreensotsInResolutions();\r\n            }\r\n\r\n            createDeviation();\r\n            function createDeviation() {\r\n                var html = '' +\r\n                    '<div class=\"pp__deviation panel panel-primary\">' +\r\n                    '<div class=\"panel-body\">' +\r\n                    '<div class=\"row\">' +\r\n                    '<div class=\"col-xs-6 pp__deviation-col-left\">' +\r\n                    '<form class=\"pp__deviation-fixed-or-static btn-group-vertical btn-toggle-one-color\" data-toggle=\"buttons\">' +\r\n                    '<label class=\"btn\" data-btn-color=\"primary\">' +\r\n                    '<input type=\"radio\" name=\"sm-radio-fixed-or-static\" value=\"1\" />Static' +\r\n                    '</label>' +\r\n                    '<label class=\"btn\" data-btn-color=\"danger\">' +\r\n                    '<input type=\"radio\" name=\"sm-radio-fixed-or-static\" value=\"0\" />Fixed' +\r\n                    '</label>' +\r\n                    '</form>' +\r\n                    '</div>' +\r\n                    '<div class=\"col-xs-6 pp__deviation-col-right\">' +\r\n                    '<div class=\"pp__deviation-relative btn-group-table\">' +\r\n                    '<div class=\"btn-group btn-group-justified\" role=\"group\">' +\r\n                    '<div class=\"btn\" data-left=\"left\" data-top=\"top\" role=\"button\">&nbsp</div>' +\r\n                    '<div class=\"btn\" data-left=\"center\" data-top=\"top\" role=\"button\">&nbsp</div>' +\r\n                    '<div class=\"btn\" data-left=\"right\" data-top=\"top\" role=\"button\">&nbsp</div>' +\r\n                    '</div>' +\r\n                    '<div class=\"btn-group btn-group-justified\" role=\"group\">' +\r\n                    '<div class=\"btn disabled\" data-left=\"left\" data-top=\"center\" role=\"button\">&nbsp</div>' +\r\n                    '<div class=\"btn disabled\" data-left=\"center\" data-top=\"center\" role=\"button\">&nbsp</div>' +\r\n                    '<div class=\"btn disabled\" data-left=\"right\" data-top=\"center\" role=\"button\">&nbsp</div>' +\r\n                    '</div>' +\r\n                    '<div class=\"btn-group btn-group-justified\" role=\"group\">' +\r\n                    '<div class=\"btn disabled\" data-left=\"left\" data-top=\"bottom\" role=\"button\">&nbsp</div>' +\r\n                    '<div class=\"btn disabled\" data-left=\"center\" data-top=\"bottom\" role=\"button\">&nbsp</div>' +\r\n                    '<div class=\"btn disabled\" data-left=\"right\" data-top=\"bottom\" role=\"button\">&nbsp</div>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '<div class=\"row row-name-px-percent\">' +\r\n                    '<div class=\"col-xs-6 pp__deviation-col-left\">' +\r\n                    '<p>px</p>' +\r\n                    '</div>' +\r\n                    '<div class=\"col-xs-6 pp__deviation-col-right\">' +\r\n                    '<p>%</p>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '<div class=\"row row-otklonenie-1\">' +\r\n                    '<div class=\"col-xs-6 pp__deviation-col-left\">' +\r\n                    '<div class=\"input-group\">' +\r\n                    '<input type=\"text\" class=\"form-control input-sm pp__deviation-input pp__deviation-left-px\">' +\r\n                    '<div class=\"input-group-addon\"><span class=\"fa fa-long-arrow-right\"></span></div>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '<div class=\"col-xs-6 pp__deviation-col-right\">' +\r\n                    '<div class=\"input-group\">' +\r\n                    '<input type=\"text\" class=\"form-control input-sm pp__deviation-input pp__deviation-left-percent\">' +\r\n                    '<div class=\"input-group-addon\"><span class=\"fa fa-long-arrow-right\"></span></div>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '<div class=\"row row-otklonenie-2\">' +\r\n                    '<div class=\"col-xs-6 pp__deviation-col-left\">' +\r\n                    '<div class=\"input-group\">' +\r\n                    '<input type=\"text\" class=\"form-control input-sm pp__deviation-input pp__deviation-top-px\">' +\r\n                    '<div class=\"input-group-addon\">&nbsp<span class=\"fa fa-long-arrow-down\"></span>&nbsp</div>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '<div class=\"col-xs-6 pp__deviation-col-right\">' +\r\n                    '<div class=\"input-group\">' +\r\n                    '<input type=\"text\" class=\"form-control input-sm pp__deviation-input pp__deviation-top-percent\">' +\r\n                    '<div class=\"input-group-addon\">&nbsp<span class=\"fa fa-long-arrow-down\"></span>&nbsp</div>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '</div>';\r\n                $(\".pp__screenshots-menu-window\").append(html);\r\n                refreshSpinner($(\".pp__deviation\"));\r\n            }\r\n            function setParamDeviation($container, pos, l, t, lpx, lper, tpx, tper) {\r\n                setParamDeviation__relative($container, pos, l, t);\r\n                setParamDeviation__deviation($container, lpx, lper, tpx, tper);\r\n            }\r\n                //Радио кнопки \"Static\" и \"Fixed\" и положени в сетке\r\n                function setParamDeviation__relative($container, pos, l, t) {\r\n                    var $static = $container.find(\" .pp__deviation-fixed-or-static label\").first();\r\n                    var $fixed = $container.find(\" .pp__deviation-fixed-or-static label\").last();\r\n                    if(pos == \"static\") {\r\n                        $static.removeClass(\"btn-default\").addClass(\"btn-primary active\");\r\n                        $static.find(\" input\").prop(\"checked\", true);\r\n                        $fixed.addClass(\"btn-default\").removeClass(\"btn-danger active\");\r\n                        $fixed.find(\" input\").prop(\"checked\", false);\r\n                    } else {\r\n                        $static.addClass(\"btn-default\").removeClass(\"btn-primary active\");\r\n                        $static.find(\" input\").prop(\"checked\", false);\r\n                        $fixed.removeClass(\"btn-default\").addClass(\"btn-danger active\");\r\n                        $fixed.find(\" input\").prop(\"checked\", true);\r\n                    }\r\n\r\n                    if(pos == \"static\") {\r\n                        t = \"top\";\r\n                    }\r\n                    var $relative = $container.find(\" .pp__deviation-relative\");\r\n                    if(pos == \"static\") {\r\n                        $relative.addClass(\"pp__deviation-static\").removeClass(\"pp__deviation-fixed\");\r\n                        $relative.find(\" .btn[data-top!='top']\").addClass(\"disabled\");\r\n                    } else {\r\n                        $relative.removeClass(\"pp__deviation-static\").addClass(\"pp__deviation-fixed\");\r\n                        $relative.find(\" .btn[data-top!='top']\").removeClass(\"disabled\");\r\n                    }\r\n                    $relative.find(\" .btn\").removeClass(\"active btn-danger\").addClass(\"btn-default\");\r\n                    $relative.find(\" .btn[data-left='\"+l+\"'][data-top='\"+t+\"']\").addClass(\"active btn-danger\").removeClass(\"btn-default\");\r\n                }\r\n                //Отклонение заданное в пикселях и процентах\r\n                function setParamDeviation__deviation($container, lpx, lper, tpx, tper) {\r\n                    var deviationInput = $container.find(\" .pp__deviation-input\");\r\n                    deviationInput.filter(\".pp__deviation-left-px\").val(lpx);\r\n                    deviationInput.filter(\".pp__deviation-left-percent\").val(lper);\r\n                    deviationInput.filter(\".pp__deviation-top-px\").val(tpx);\r\n                    deviationInput.filter(\".pp__deviation-top-percent\").val(tper);\r\n                }\r\n            //Обновить спиннер\r\n            function refreshSpinner($container) {\r\n                $container.find(\" .pp__deviation-left-px\").add($container.find(\" .pp__deviation-top-px\")).spinner({\r\n                    min: -99999,\r\n                    max: 99999,\r\n                    start: startDeviationSpinner,\r\n                    spin: spinDeviationSpinner,\r\n                    stop: stopDeviationSpinner\r\n                });\r\n                $container.find(\" .pp__deviation-left-percent\").add($container.find(\" .pp__deviation-top-percent\")).spinner({\r\n                    min: -9999,\r\n                    max: 9999,\r\n                    step: 0.1,\r\n                    start: startDeviationSpinner,\r\n                    spin: spinDeviationSpinner,\r\n                    stop: stopDeviationSpinner\r\n                });\r\n            }\r\n\r\n            //Вывод привязанных скриншотов\r\n            function createScreenshotsList(currentPage, resolution, screenshotsRelated) {\r\n                if(currentPage in screenshotsRelated && (resolution.w+\"|\"+resolution.h) in  screenshotsRelated[currentPage]) {\r\n                    //nestet to object list\r\n                    var screenshotsObjList = session.getScreenshotsObjList();\r\n\r\n                    var screenshots = screenshotsRelated[currentPage][resolution.w+\"|\"+resolution.h];\r\n                    var html = \"\";\r\n                    for(var key in screenshots) {\r\n                        var s =  screenshots[key];//screenshot\r\n\r\n                        if(s.pos == \"static\") {\r\n                            s.t = \"top\";\r\n                        }\r\n                        allScreenshotsForCurPageTemp.push(s);\r\n\r\n                        html += '' +\r\n                        '<li class=\"pp__resolutions-list-screenshot '+((s.active)?\"active\":\"\")+'\" data-urn=\"'+s.urn+'\" data-w=\"'+screenshotsObjList[s.urn].w+'\" data-h=\"'+screenshotsObjList[s.urn].h+'\">' +\r\n                            '<div class=\"pp__screenshot-content\">' +\r\n                                '<button class=\"btn btn-default btn-xs btn-block pp__screenshot-name-btn '+((s.active)?\"active\":\"\")+'\">' +\r\n                                    '<div class=\"btn btn-default btn-xs pp__resolutions-screenshots-btn-size\" data-w=\"'+screenshotsObjList[s.urn].w+'\" data-h=\"'+screenshotsObjList[s.urn].h+'\">' +\r\n                                        '<span class=\"pp__screenshot-name-btn-w\">'+screenshotsObjList[s.urn].w+'</span> | <span class=\"pp__screenshot-name-btn-h\">'+screenshotsObjList[s.urn].h+'</span>' +\r\n                                    '</div>' +\r\n                                    s.urn +\r\n                                '</button>' +\r\n                                '<button class=\"btn btn-default btn-xs pp__resolutions-screenshots-delete-btn\"><span class=\"glyphicon glyphicon-remove\"></span></button>' +\r\n                                '<div class=\"btn btn-default btn-xs pp__resolutions-screenshots-drag-btn\"><span class=\"glyphicon glyphicon-move\"></span></div>' +\r\n                                '<button class=\"pp__resolutions-screenshots-btn-deviation btn btn-default btn-xs\"><i class=\"glyphicon glyphicon-option-vertical\" aria-hidden=\"true\"></i></button>' +\r\n                            '</div>' +\r\n                        '</li>';\r\n                    }\r\n                    return html;\r\n                }\r\n                return \"\";\r\n            }\r\n            //Просто обновляем сортировку\r\n            function refreshSortableScreensotsInResolutions() {\r\n                    $(\".pp__resolutions-list-screenshots\").sortable({\r\n                        revert: true,\r\n                        cursor: 'move',\r\n                        axis: 'y',\r\n                        items: ' > li',\r\n                        distance: 5,\r\n                        connectWith: \".pp__resolutions-list-screenshots\",\r\n                        placeholder: \"placeholder\",\r\n                        forceHelperSize: true,\r\n                        forcePlaceholderSize: true,\r\n                        /*placeholder: {\r\n                            element: function(currentItem) {\r\n                                return $('<div class=\"panel panel-default sm-placeholder-scrin\"></div>').height( currentItem.outerHeight() );\r\n                            },\r\n                            update: function(container, p) {\r\n                                return;\r\n                            }\r\n                        },*/\r\n                        remove: function(event, ui){//\"update\" заменил на \"remove\"\r\n                            /*if( ui.item.closest( \".sm-all-scrins\" ).size() ) {\r\n                                ui.item.remove();\r\n                            }*/\r\n                        },\r\n                        stop: function(){\r\n                            //$container.trigger(\"sm.change\");\r\n                        },\r\n                        update: sendSortableScreenshot\r\n                    });\r\n                }\r\n\r\n            //Список всех скриншотов\r\n            $(\".pp__screenshots-files-menu-scrollwrap\").prepend('<ul class=\"pp__screenshots-files-list\"></ul>');\r\n            refreshMenuAllScreenshots();\r\n            function refreshMenuAllScreenshots() {\r\n                var localSession = session.getLocalSessionParams();\r\n                //dragItemList = false;\r\n                var $main = $(\".pp__screenshots-files-list\");\r\n                $main.empty();\r\n\r\n                var res = (function recursion(el, html) {\r\n                    //li\r\n                    for(var i in el) {\r\n                        var one = el[i];\r\n                        //\r\n                        var collapsedToObj = {};\r\n                        for(key in session.data.globalSession.designScreenshotsFoldersUncollapsed) {\r\n                            collapsedToObj[session.data.globalSession.designScreenshotsFoldersUncollapsed[key]] = true;\r\n                        }\r\n                        var _class = (one.type == \"file\")?\"file\":\"folder btn-yellow\";\r\n                        html += \"<li class='pp__screenshots-item \"+((one.urn in collapsedToObj)?\"\":\"collapsed\")+\"' data-type='\"+one.type+\"' data-name='\"+one.name+\"' data-urn='\"+one.urn+\"'>\";\r\n                        html += '<div class=\"pp__screenshots-item-content\">' +\r\n                            '<button class=\"btn btn-default btn-xs pp__screenshots-btn-collapsed\"><span class=\"glyphicon glyphicon-minus\"></span><span class=\"glyphicon glyphicon-plus\"></span></button>' +\r\n                            '<div class=\"btn btn-default btn-xs btn-block pp__screenshots-btn-name pp__screenshots-btn-'+_class+'\">' +\r\n                                ((one.type == \"file\")?\r\n                                '<div class=\"btn btn-default btn-xs pp__screenshots-btn-size\" data-w=\"'+one.w+'\" data-h=\"'+one.h+'\">' +\r\n                                    '<span class=\"pp__screenshots-btn-size-w\">'+one.w+'</span> | <span class=\"pp__screenshots-btn-size-h\">'+one.h+'</span>' +\r\n                                '</div>':\"\") +\r\n                            one.name +\r\n                            '</div>' +\r\n                            ((one.type == \"file\")?'<button class=\"btn btn-success btn-xs pp__screenshots-btn-add-screenshot\"><span class=\"glyphicon glyphicon-plus-sign\"></span></button>':\"\") +\r\n                            '</div>';\r\n\r\n                        //sub\r\n                        if(\"sub\" in one) {\r\n                            html = recursion(one.sub, html+\"<ul>\")+\"</ul>\";\r\n                        }\r\n                        //sub (end)\r\n\r\n                        html += \"</li>\";\r\n\r\n                    }\r\n                    //li (end)\r\n\r\n                    return html;\r\n                })(session.data.globalSession.designScreenshots, \"\");\r\n\r\n                $main.append(res);\r\n                refreshMenuAllScreenshots__specific($(\".pp__screenshots-files-menu-scrollwrap\"));\r\n            }\r\n                //для вложенных добавляем класс \"have-nested\", удаляем \"collapsed\" для тех кто без вложенных, коллапсируем рассколапсируем\r\n                function refreshMenuAllScreenshots__specific($main) {\r\n                    //Вставляем класс для вложенных\r\n                    $main.find(\" .pp__screenshots-item\").removeClass(\"have-nested\");\r\n                    $main.find(\" ul\").each(function() {\r\n                        if($(this).parent(\".pp__screenshots-item\").length) {\r\n                            $(this).parent(\".pp__screenshots-item\").addClass(\"have-nested\");\r\n                        }\r\n                    });\r\n                    //\r\n                    $main.find(\" .pp__screenshots-item\").each(function() {\r\n                        if(!$(this).hasClass(\"have-nested\")) {\r\n                            $(this).removeClass(\"collapsed\");\r\n                        }\r\n                    });\r\n                    //Коллапсируем рассколапсируем\r\n                    $main.find(\" .pp__screenshots-item.collapsed > ul\").css({display: \"none\"});\r\n                    $main.find(\" .pp__screenshots-item > ul\").not($main.find(\" .pp__screenshots-item.collapsed > ul\")).css({display: \"block\"});\r\n                }\r\n                function collapseUncollapseScreenshotsFolderToJson($main) {\r\n                    return $main.find(\" .pp__screenshots-item\")\r\n                        .map(function() {\r\n                            return ($(this).hasClass(\"have-nested\") && (!$(this).hasClass(\"collapsed\"))) ? $(this).attr(\"data-urn\") : null;\r\n                        })\r\n                        .get()\r\n                        .filter(function(el) {\r\n                            return el !== false;\r\n                        });\r\n                }\r\n\r\n            //Отображаем миниатюрку\r\n            var windowThumbnail__timeoutId = null;\r\n            $(\".pp__screenshots-files-menu-scrollwrap\").on(\"mouseenter\", \" .pp__screenshots-item[data-type='file']\", function(){\r\n                $(\".pp__screenshot-thumbnail\")\r\n                    .empty()\r\n                    .append('<img src=\"'+(\"/design-screenshots/design-thumbnails/\"+$(this).attr(\"data-urn\"))+'\" width=\"320\" height=\"auto\" />');\r\n                $(\".pp__screenshot-thumbnail-scrollwrap\").addClass(\"open\");\r\n                $(\".pp__screenshots-files-menu-scrollwrap\").addClass(\"shadow-hidden\");\r\n            });\r\n            //Скрываем только при уводе с блоков \".pp__screenshots-files-menu-scrollwrap, .pp__screenshot-thumbnail-scrollwrap\" на другой\r\n            $(\".pp__screenshots-files-menu-scrollwrap, .pp__screenshot-thumbnail-scrollwrap\").on({\r\n                \"mouseenter\": function() {\r\n                    if(windowThumbnail__timeoutId !== null) {\r\n                        clearTimeout(windowThumbnail__timeoutId);\r\n                    }\r\n                },\r\n                \"mouseleave\": function() {\r\n                    windowThumbnail__timeoutId = setTimeout(function() {\r\n                        windowThumbnail__timeoutId = null;\r\n                        $(\".pp__screenshot-thumbnail-scrollwrap\").removeClass(\"open\");\r\n                        $(\".pp__screenshots-files-menu-scrollwrap\").removeClass(\"shadow-hidden\");\r\n                    }, 10);\r\n                }\r\n            });\r\n        })();\r\n\r\n        //Первое применение сессии\r\n        crossModulesFunctions[\"session.applyAllParamsLocalSession\"](false);\r\n\r\n        /****************************************************/\r\n        /*Для тестов*/\r\n        /****************************************************/\r\n        $(document).ready(function(){\r\n            $(\"body\").on('keydown', function(e) {\r\n                if(e.which == 49 && e.altKey) {//(e.which == 65 || e.which == 83 || e.which == 68)\r\n                    //console.log(parseFloat(\"900.5\"));//Возвращает целое число\r\n                    //console.log($(\"body\").data(\"dfsdfsd\"));//Возвращает undefined\r\n                    /*var obj = {a: 1, b: 2};\r\n                    $(\"body\").data(\"dfsdfsd\", obj);\r\n                    $(\"body\").data(\"dfsdfsd\").a = 10;\r\n                    console.log(obj);*///обект не клонируеться, а остаёться оригинальным\r\n                    console.log(navigator.userAgent);\r\n                }\r\n            });\r\n        });\r\n\r\n        /****************************************************/\r\n        /*Вспомогательная хрень*/\r\n        /****************************************************/\r\n        $(document).ready(function(){\r\n            //Подсказки\r\n            $('[data-toggle=\"tooltip\"]').tooltip();\r\n            $('[data-toggle=\"popover\"]').popover();\r\n            //==========\r\n        });\r\n    }\r\n});\r\n\r\n"]}