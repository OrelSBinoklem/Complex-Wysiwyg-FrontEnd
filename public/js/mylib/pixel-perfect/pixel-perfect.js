!function(e){var i=function(i,t){this._options=t;var s=this;s.$container=i;var n=new modules.screenshotsManipulator(s._options.$screenshotsManipulatorContainer,this._options);s.screenshotsManipulator=n,this._create=function(t){s.setCurrentPage(t),i.append('<div class="pp-design"></div>'),s.$listAllScrins,s.intervalRefreshByResizeDocument,s.wIFrame,s.changePositionTemp={},e(window[s._options.nameIFrame].window).on("scroll",s._refreshByScroll),e(window[s._options.nameIFrame].window).on("resize",s._refreshByResizeDocument),s.intervalRefreshByResizeDocument=setInterval(function(){var i=window[s._options.nameIFrame];void 0!==s.wIFrame&&s.wIFrame==Math.round(e(i.document).width())||(s.wIFrame=Math.round(e(i.document).width()),s._refreshByResizeDocument())},1e3),i.on("pp.change.sizelist",function(){s._saveSession(),n.refresh(s.$session,s.$listAllScrins,s.currentPage)}),i.on("pp.create.sizelist",function(){n._create(),n.createListScrins(s.$session,s.$listAllScrins,s.currentPage)}),n.$container.on("sm.change",function(){n._setSession(s.$session,s.$listAllScrins,s.currentPage),s.reload(),s._saveSession(),n.$container.trigger("sm.change_post_set_session")}),n.$container.on("sm.change.size",function(e,i,t){s.setSizeIFrame(i,t)}),n.$container.on("sm.changeoffsetstart",s._refreshByChangePositionStart),n.$container.on("sm.changeoffset",s._refreshByChangePosition),s._restoreSession()},this._destroy=function(){clearInterval(s.intervalRefreshByResizeDocument),s._saveSession(),i.find(" .pp-design").remove()},this.setCurrentPage=function(e){s.currentPage=e},this.addSize=function(i,t){var n=s.$session.find(" page[href='"+s.currentPage+"']");0==n.size()&&(s.$session.find(" wrap").append(e('<page href="'+s.currentPage+'"></page>')),n=s.$session.find(" page[href='"+s.currentPage+"']"));var a=n.find(" media[width="+i+"][height="+t+"]");a.size()?(alert("Такое разрешение уже есть в списке!"),"true"!=a.attr("active")&&s.selectSize(i,t)):(n.append(e('<media width="'+i+'" height="'+t+'" active="false" ></media>')),s.selectSize(i,t))},this.removeSize=function(e,t){var n=s.$session.find(" page[href='"+s.currentPage+"']");if(n.size()){var a=n.find(" media[width="+e+"][height="+t+"]");if(a.size()){var r="true"==a.attr("active");if(a.remove(),n.find(" media[width][height]").size()&&r){var o=n.find(" media[width][height]").first();o.attr("active","true"),s.selectSize(o.attr("width"),o.attr("height"))}i.trigger("pp.change.sizelist"),s.reload()}}},this.selectSize=function(e,t){var n=s.$session.find(" page[href='"+s.currentPage+"']");if(n.size()){var a=n.find(" media[width="+e+"][height="+t+"]");a.size()&&("true"!=a.attr("active")?(n.find(" media[width][height]").attr("active","false"),a.attr("active","true"),i.trigger("pp.change.sizelist"),s.setSizeIFrame(e,t)):(n.find(" media[width][height]").attr("active","false"),a.attr("active","true")),s.reload())}},this.setSizeIFrame=function(i,t){var n=e("#"+s._options.nameIFrame).closest(".pmv-fitting-wrap");n.stop().animate({width:i+"px",height:t+"px"},1e3)},this.reload=function(){s._deleteScrins(),s._pasteScrins()},this._refreshByChangePositionStart=function(e,t){s._refreshIndexesForScrins(),s.changePositionTemp.currentScreenIsActive=!1;var n=t.closest(".sm-scrin");if(n.is("[data-active-index]")){var a,r,o=parseInt(n.attr("data-active-index")),c=n.find(" .sm-deviation-relative .btn.active"),p=c.attr("data-left"),h=c.attr("data-top");switch(p){case"left":a=0;break;case"center":a=50;break;case"right":a=100}switch(h){case"top":r=0;break;case"center":r=50;break;case"bottom":r=100}s.changePositionTemp.currentScreenIsActive=!0,s.changePositionTemp.l=a,s.changePositionTemp.t=r,s.changePositionTemp.$currentInput=t,s.changePositionTemp.$currentScrin=i.find(" .pp-design > *").eq(o)}},this._refreshByChangePosition=function(){if(s.changePositionTemp.currentScreenIsActive){var e=s.changePositionTemp.$currentInput,i=s.changePositionTemp.$currentScrin,t=s.changePositionTemp.l,n=s.changePositionTemp.t,a=parseInt(e.val());e.hasClass("sm-deviation-left-px")?i.find(" .pp-wrap-deviation-pixels").css({left:a}):e.hasClass("sm-deviation-left-percent")?i.find(" .pp-wrap-deviation-percent").css({left:t+a+"%"}):e.hasClass("sm-deviation-top-px")?i.find(" .pp-wrap-deviation-pixels").css({top:a}):e.hasClass("sm-deviation-top-percent")&&(console.log(n+a),i.find(" .pp-wrap-deviation-percent").css({top:n+a+"%"}))}},this._refreshByScroll=function(){var t=i.find(" .pp-design"),n=window[s._options.nameIFrame];t.find(" .pp-screen-static").css({top:"-"+Math.round(e(n.window).scrollTop())+"px",left:"-"+Math.round(e(n.window).scrollLeft())+"px"})},this._refreshByResizeDocument=function(){var t=i.find(" .pp-design"),n=window[s._options.nameIFrame];t.find(" .pp-screen-static").css({width:Math.round(e(n.document).width())})},this._pasteScrins=function(){var t=i.find(" .pp-design"),n="";s.$session.find("page[href='"+s.currentPage+"'] media[active='true'] scrin[active='true']").each(function(){var i,t,a,r,o=e(this).attr("deviation").split("|"),c=o.length-1,p=o[0],h=o[1],d="static"==p?"top":o[2],f=parseInt(o[c-3]),l=parseInt(o[c-2]),g=parseInt(o[c-1]),u=parseInt(o[c]),m=s.$listAllScrins.find("scrin[src='"+e(this).attr("src")+"']"),v=m.attr("width"),_=m.attr("height");switch(h){case"left":i=0,a=0;break;case"center":i=50,a=-50;break;case"right":i=100,a=-100}switch(d){case"top":t=0,r=0;break;case"center":t=50,r=-50;break;case"bottom":t=100,r=-100}n+='                <div class="pp-screen-'+("static"==p?"static":"fixed")+'">                    <div style="left: '+(l+i)+"%; top: "+(u+t)+'%;" class="pp-wrap-deviation-percent">                        <div style="width: '+v+"px; height: "+_+"px; left: "+f+"px; top: "+g+'px;" class="pp-wrap-deviation-pixels">                            <img src="'+(shablonizator.base_url+s._options.dirScrins+"/"+e(this).attr("src"))+'" style="width: '+v+"px; height: "+_+"px; left: "+a+"%; top: "+r+'%;"/>                        </div>                    </div>                </div>'}),t.append(n),s._refreshByScroll(),s._refreshByResizeDocument()},this._deleteScrins=function(){i.find(" .pp-design").empty()},this.showPageProofsOrDesign=function(t){switch(t){case 0:i.find(" .pp-design").css({opacity:0}),e("#"+s._options.nameIFrame).css({opacity:1});break;case 1:i.find(" .pp-design").css({opacity:1}),e("#"+s._options.nameIFrame).css({opacity:.5});break;case 2:i.find(" .pp-design").css({opacity:1}),e("#"+s._options.nameIFrame).css({opacity:0})}i.trigger("pp.changepageproofsordesign",t),s.$session.find("show_page_proofs_or_design").text(t),s._saveSession()},this._restoreSession=function(){"$session"in s||(e.ajax({url:"sb.php",type:"POST",cache:!1,data:{module:"pixel_perfect",dir_scrins:s._options.dirScrins,dir_miniatyrki:s._options.dirThumbnail,width_miniatyrki:s._options.widthThumbnail},async:!1,success:function(i){s.$listAllScrins=e(e.parseXML("<wrap>"+i+"</wrap>"))}}),e.ajax({url:"sb.php",type:"POST",cache:!1,data:{module:"getfile",dir:s._options.urlXML,text_encoding:"UTF-8"},async:!1,success:function(i){s.$session=e(e.parseXML(i)),s.$session.find("scrin").each(function(){0==s.$listAllScrins.find("scrin[src='"+e(this).attr("src")+"']").size()&&e(this).remove()})}}),i.trigger("pp.create.sizelist")),s._pasteScrins(),s.showPageProofsOrDesign(parseInt(s.$session.find("show_page_proofs_or_design").text())),n._restoreSession(s.$session)},this._saveSession=function(){if("$session"in s){var i=s.$session.xml().join("");e.ajax({url:"sb.php",async:!0,cache:!1,type:"POST",data:{module:"setfile",dir:s._options.urlXML,file_text:i,text_encoding:"UTF-8"}})}},this._saveSessionAndClearDeletedPages=function(i){s.$session.find("page").each(function(){e(this).attr("href")in i||e(this).remove()})},this._refreshIndexesForScrins=function(){var i=0;n.$container.find(" .sm-container .sm-media").each(function(){i=0,e(this).find(" .sm-scrin").each(function(){e(this).hasClass("active")&&(e(this).attr("data-active-index",i),i++)})})}};modules.pixelPerfect=i}(jQuery);
//# sourceMappingURL=pixel-perfect.js.map
