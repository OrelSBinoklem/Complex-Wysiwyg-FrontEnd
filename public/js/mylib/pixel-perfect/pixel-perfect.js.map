{"version":3,"sources":["js/mylib/pixel-perfect/pixel-perfect.js"],"names":["$","pixelPerfect","$container","options","this","_options","____","screenshotsManipulator","modules","$screenshotsManipulatorContainer","_create","href","setCurrentPage","append","$listAllScrins","intervalRefreshByResizeDocument","wIFrame","changePositionTemp","window","nameIFrame","on","_refreshByScroll","_refreshByResizeDocument","setInterval","iframe","undefined","Math","round","document","width","_saveSession","refresh","$session","currentPage","createListScrins","_setSession","reload","trigger","e","w","h","setSizeIFrame","_refreshByChangePositionStart","_refreshByChangePosition","_restoreSession","_destroy","clearInterval","find","remove","addSize","$page","size","$media","alert","attr","selectSize","removeSize","removeMediaActive","$firstMedia","first","$fittingWrap","closest","stop","animate","height","_deleteScrins","_pasteScrins","$input","_refreshIndexesForScrins","currentScreenIsActive","$scrin","is","l","t","indexActiveScrin","parseInt","$relative","left","top","$currentInput","$currentScrin","eq","val","hasClass","css","console","log","$design","scrollTop","scrollLeft","resScrins","each","l_img","t_img","arrDeviation","split","lastIndex","length","position","l_px","l_per","t_px","t_per","wImg","hImg","shablonizator","base_url","dirScrins","empty","showPageProofsOrDesign","show","opacity","text","ajax","url","type","cache","data","module","dir_scrins","dir_miniatyrki","dirThumbnail","width_miniatyrki","widthThumbnail","async","success","parseXML","dir","urlXML","text_encoding","resxml","xml","join","file_text","_saveSessionAndClearDeletedPages","pageList","index","jQuery"],"mappings":"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","file":"pixel-perfect.js","sourcesContent":["(function($){//Модули: getfile, setfile, .xml(), malihu-custom-scrollbar\r\n\r\nvar defaultOptions = {\r\n    urlXML: \"sb/pixel-perfect.xml\",\r\n    dirScrins: \"design\",\r\n    dirThumbnail: \"sb/design-thumbnails\",\r\n    widthThumbnail: 240,\r\n    nameIFrame: \"PP_iframe\",\r\n    $screenshotsManipulatorContainer: null,//Умолчания нету\r\n    thumbnailScrollAmount: 100,\r\n    mainWindowScrollAmount: 100\r\n};\r\n\r\nvar pixelPerfect = function($container, options) {\r\n    this._options = options;\r\n    var ____ = this;\r\n    ____.$container = $container;\r\n    \r\n    var screenshotsManipulator = new modules.screenshotsManipulator( ____._options.$screenshotsManipulatorContainer, this._options);\r\n    ____.screenshotsManipulator = screenshotsManipulator;\r\n    \r\n    this._create = function( href ) {\r\n        ____.setCurrentPage( href );\r\n        \r\n        $container.append('<div class=\"pp-design\"></div>');\r\n        \r\n        //свойства\r\n        ____.$listAllScrins;\r\n        ____.intervalRefreshByResizeDocument;\r\n        ____.wIFrame;\r\n        \r\n        ____.changePositionTemp = {};\r\n        \r\n        //Установка событий\r\n        $(window[____._options.nameIFrame].window).on(\"scroll\", ____._refreshByScroll);\r\n        $(window[____._options.nameIFrame].window).on('resize', ____._refreshByResizeDocument);\r\n        ____.intervalRefreshByResizeDocument = setInterval(function(){\r\n            var iframe = window[____._options.nameIFrame];\r\n            if( ____.wIFrame === undefined || ____.wIFrame != Math.round( $(iframe.document).width() ) ) {\r\n                ____.wIFrame = Math.round( $(iframe.document).width() );\r\n                ____._refreshByResizeDocument();\r\n            }\r\n        }, 1000);\r\n        $container.on( \"pp.change.sizelist\", function(){\r\n            ____._saveSession();\r\n            \r\n            screenshotsManipulator.refresh( ____.$session, ____.$listAllScrins, ____.currentPage );\r\n        });\r\n        $container.on(\"pp.create.sizelist\", function(){\r\n            screenshotsManipulator._create();\r\n            \r\n            screenshotsManipulator.createListScrins( ____.$session, ____.$listAllScrins, ____.currentPage );\r\n        });\r\n        \r\n        screenshotsManipulator.$container.on(\"sm.change\", function(){\r\n            screenshotsManipulator._setSession( ____.$session, ____.$listAllScrins, ____.currentPage );\r\n\r\n            ____.reload();\r\n\r\n            ____._saveSession();\r\n\r\n            screenshotsManipulator.$container.trigger( \"sm.change_post_set_session\" );\r\n        });\r\n        screenshotsManipulator.$container.on(\"sm.change.size\", function(e, w, h){\r\n            ____.setSizeIFrame( w, h );\r\n        });\r\n        screenshotsManipulator.$container.on(\"sm.changeoffsetstart\", ____._refreshByChangePositionStart);\r\n        screenshotsManipulator.$container.on(\"sm.changeoffset\", ____._refreshByChangePosition);\r\n        \r\n        ____._restoreSession();\r\n    }\r\n    \r\n    this._destroy = function() {\r\n        clearInterval( ____.intervalRefreshByResizeDocument );\r\n        ____._saveSession();\r\n        $container.find( \" .pp-design\" ).remove();\r\n    }\r\n    \r\n    this.setCurrentPage = function( href ) {\r\n        ____.currentPage = href;\r\n    }\r\n    \r\n    this.addSize = function( w, h ) {\r\n        var $page = ____.$session.find( \" page[href='\" + ____.currentPage + \"']\" );\r\n        if( $page.size() == 0 ) {\r\n            ____.$session.find( \" wrap\" ).append( $('<page href=\"' + ____.currentPage + '\"></page>') );\r\n            $page = ____.$session.find( \" page[href='\" + ____.currentPage + \"']\" );\r\n        }\r\n        \r\n        var $media = $page.find( \" media[width=\"+( w )+\"][height=\"+( h )+\"]\" );\r\n        if( $media.size() ) {\r\n            alert( \"Такое разрешение уже есть в списке!\" );\r\n            \r\n            if( $media.attr( \"active\" ) != \"true\" ) {\r\n                //если неактивно\r\n                ____.selectSize( w, h );\r\n            }\r\n        } else {\r\n            $page.append( $('<media width=\"'+( w )+'\" height=\"'+( h )+'\" active=\"false\" ></media>') );\r\n            ____.selectSize( w, h );\r\n        }\r\n    }\r\n    \r\n    this.removeSize = function( w, h ) {\r\n        var $page = ____.$session.find( \" page[href='\" + ____.currentPage + \"']\" );\r\n        if( $page.size() ) {\r\n            var $media = $page.find( \" media[width=\"+( w )+\"][height=\"+( h )+\"]\" );\r\n            if( $media.size() ) {\r\n                var removeMediaActive = $media.attr( \"active\" ) == \"true\";\r\n                $media.remove();\r\n                \r\n                if( $page.find( \" media[width][height]\" ).size() && removeMediaActive ) {\r\n                    var $firstMedia = $page.find( \" media[width][height]\" ).first();\r\n                    $firstMedia.attr( \"active\", \"true\" );\r\n                    ____.selectSize( $firstMedia.attr( \"width\" ), $firstMedia.attr( \"height\" ) );\r\n                }\r\n                \r\n                $container.trigger(\"pp.change.sizelist\");\r\n                ____.reload();\r\n            }\r\n        }\r\n    }\r\n    \r\n    this.selectSize = function( w, h ) {\r\n        var $page = ____.$session.find( \" page[href='\" + ____.currentPage + \"']\" );\r\n        if( $page.size() ) {\r\n            var $media = $page.find( \" media[width=\"+( w )+\"][height=\"+( h )+\"]\" );\r\n            if( $media.size() ) {\r\n                if( $media.attr( \"active\" ) != \"true\" ) {\r\n                    $page.find( \" media[width][height]\" ).attr( \"active\", \"false\" );\r\n                    $media.attr( \"active\", \"true\" );\r\n                    $container.trigger(\"pp.change.sizelist\");\r\n                    ____.setSizeIFrame( w, h );\r\n                } else {\r\n                    $page.find( \" media[width][height]\" ).attr( \"active\", \"false\" );\r\n                    $media.attr( \"active\", \"true\" );\r\n                }\r\n                ____.reload();\r\n            }\r\n        }\r\n    }\r\n\r\n        this.setSizeIFrame = function( w, h ) {\r\n            var $fittingWrap = $(\"#\"+(____._options.nameIFrame)).closest(\".pmv-fitting-wrap\");\r\n            $fittingWrap.stop().animate({width: w+'px', height: h+'px'}, 1000);\r\n        }\r\n    \r\n    this.reload = function() {\r\n        ____._deleteScrins();\r\n        ____._pasteScrins();\r\n    }\r\n    \r\n    this._refreshByChangePositionStart = function(e, $input) {\r\n        //проверять активен ли текущий медиазапрос (проверяеться при вызове события)\r\n        ____._refreshIndexesForScrins();\r\n        \r\n        ____.changePositionTemp.currentScreenIsActive = false;\r\n        \r\n        var $scrin = $input.closest( \".sm-scrin\" );\r\n        if( $scrin.is( \"[data-active-index]\" ) ) {\r\n            var indexActiveScrin = parseInt( $scrin.attr( \"data-active-index\" ) );\r\n            \r\n            var $relative = $scrin.find(' .sm-deviation-relative .btn.active');\r\n            var left = $relative.attr( \"data-left\" );\r\n            var top = $relative.attr( \"data-top\" );\r\n            \r\n            var l, t;\r\n            switch( left ) {\r\n                case \"left\":\r\n                    l = 0;\r\n                    break;\r\n                case \"center\":\r\n                    l = 50;\r\n                    break;\r\n                case \"right\":\r\n                    l = 100;\r\n                    break;\r\n            }\r\n            switch( top ) {\r\n                case \"top\":\r\n                    t = 0;\r\n                    break;\r\n                case \"center\":\r\n                    t = 50;\r\n                    break;\r\n                case \"bottom\":\r\n                    t = 100;\r\n                    break;\r\n            }\r\n            \r\n            ____.changePositionTemp.currentScreenIsActive = true;\r\n            \r\n            ____.changePositionTemp.l = l;\r\n            ____.changePositionTemp.t = t;\r\n            \r\n            ____.changePositionTemp.$currentInput = $input;\r\n            ____.changePositionTemp.$currentScrin = $container.find( \" .pp-design > *\" ).eq( indexActiveScrin );\r\n        }\r\n    }\r\n    \r\n    this._refreshByChangePosition = function() {\r\n        if( ____.changePositionTemp.currentScreenIsActive ) {\r\n            var $currentInput = ____.changePositionTemp.$currentInput;\r\n            var $currentScrin = ____.changePositionTemp.$currentScrin;\r\n            \r\n            var l = ____.changePositionTemp.l;\r\n            var t = ____.changePositionTemp.t;\r\n            \r\n            var val = parseInt( $currentInput.val() );\r\n            \r\n            if( $currentInput.hasClass( \"sm-deviation-left-px\" ) ) {\r\n                $currentScrin.find( \" .pp-wrap-deviation-pixels\" ).css({left: val});\r\n                \r\n            } else if ( $currentInput.hasClass( \"sm-deviation-left-percent\" ) ) {\r\n                $currentScrin.find( \" .pp-wrap-deviation-percent\" ).css({left: ( l + val )+\"%\"});\r\n                \r\n            } else if ( $currentInput.hasClass( \"sm-deviation-top-px\" ) ) {\r\n                $currentScrin.find( \" .pp-wrap-deviation-pixels\" ).css({top: val});\r\n                \r\n            } else if ( $currentInput.hasClass( \"sm-deviation-top-percent\" ) ) {\r\n                console.log( t + val );\r\n                $currentScrin.find( \" .pp-wrap-deviation-percent\" ).css({top: ( t + val )+\"%\"});\r\n            }\r\n        }\r\n    }\r\n    \r\n    this._refreshByScroll = function() {\r\n        var $design = $container.find( \" .pp-design\" );\r\n        var iframe = window[____._options.nameIFrame];\r\n        \r\n        $design.find( \" .pp-screen-static\" ).css({\r\n            top: \"-\" + Math.round( $(iframe.window).scrollTop() ) + \"px\",\r\n            left: \"-\" + Math.round( $(iframe.window).scrollLeft() ) + \"px\"\r\n        });\r\n    }\r\n    \r\n    this._refreshByResizeDocument = function() {\r\n        var $design = $container.find( \" .pp-design\" );\r\n        var iframe = window[____._options.nameIFrame];\r\n        \r\n        $design.find( \" .pp-screen-static\" ).css({\r\n            width: Math.round( $(iframe.document).width() )\r\n        });\r\n    }\r\n    \r\n    this._pasteScrins = function() {\r\n        var $design = $container.find( \" .pp-design\" );\r\n        var resScrins = \"\";\r\n        ____.$session.find( \"page[href='\"+ ____.currentPage +\"'] media[active='true'] scrin[active='true']\" ).each(function(){\r\n            var arrDeviation = $(this).attr( \"deviation\" ).split(\"|\");\r\n            var lastIndex = arrDeviation.length - 1;\r\n            \r\n            var position = arrDeviation[0];\r\n            var left = arrDeviation[1];\r\n            var top = ( position == \"static\" ) ? \"top\" : arrDeviation[2];\r\n            var l_px =  parseInt( arrDeviation[lastIndex-3] );\r\n            var l_per = parseInt( arrDeviation[lastIndex-2] );\r\n            var t_px =  parseInt( arrDeviation[lastIndex-1] );\r\n            var t_per = parseInt( arrDeviation[lastIndex] );\r\n            \r\n            var $scrin = ____.$listAllScrins.find( \"scrin[src='\"+( $(this).attr( \"src\" ) )+\"']\" );\r\n            var wImg = $scrin.attr( \"width\" );\r\n            var hImg = $scrin.attr( \"height\" );\r\n        \r\n            var l, t, l_img, t_img;\r\n            switch( left ) {\r\n                case \"left\":\r\n                    l = 0;\r\n                    l_img = 0;\r\n                    break;\r\n                case \"center\":\r\n                    l = 50;\r\n                    l_img = -50;\r\n                    break;\r\n                case \"right\":\r\n                    l = 100;\r\n                    l_img = -100;\r\n                    break;\r\n            }\r\n            switch( top ) {\r\n                case \"top\":\r\n                    t = 0;\r\n                    t_img = 0;\r\n                    break;\r\n                case \"center\":\r\n                    t = 50;\r\n                    t_img = -50;\r\n                    break;\r\n                case \"bottom\":\r\n                    t = 100;\r\n                    t_img = -100;\r\n                    break;\r\n            }\r\n            resScrins += '\\\r\n                <div class=\"pp-screen-'+( ( position == \"static\" ) ? \"static\" : \"fixed\" )+'\">\\\r\n                    <div style=\"left: '+( l_per + l )+'%; top: '+( t_per + t )+'%;\" class=\"pp-wrap-deviation-percent\">\\\r\n                        <div style=\"width: ' + wImg + 'px; height: ' + hImg + 'px; left: ' + l_px + 'px; top: ' + t_px + 'px;\" class=\"pp-wrap-deviation-pixels\">\\\r\n                            <img src=\"'+( shablonizator.base_url + ____._options.dirScrins + \"/\" + $(this).attr( \"src\" ) )+'\" style=\"width: ' + wImg + 'px; height: ' + hImg + 'px; left: ' + l_img + '%; top: ' + t_img + '%;\"/>\\\r\n                        </div>\\\r\n                    </div>\\\r\n                </div>';\r\n        });\r\n        $design.append( resScrins );\r\n            \r\n        ____._refreshByScroll();\r\n        ____._refreshByResizeDocument();\r\n    }\r\n    \r\n    this._deleteScrins = function() {\r\n        $container.find( \" .pp-design\" ).empty();\r\n    }\r\n    \r\n    this.showPageProofsOrDesign = function( show ) {\r\n        //0 - показать верстку,\r\n        //1 - показать на половину и верстку и дизайн,\r\n        //2 - показать дизайн\r\n        switch ( show ) {\r\n            case 0:\r\n                $container.find( \" .pp-design\" ).css({opacity: 0});\r\n                $( '#'+(____._options.nameIFrame) ).css({opacity: 1});\r\n                break;\r\n            case 1:\r\n                $container.find( \" .pp-design\" ).css({opacity: 1});\r\n                $( '#'+(____._options.nameIFrame) ).css({opacity: 0.5});\r\n                break;\r\n            case 2:\r\n                $container.find( \" .pp-design\" ).css({opacity: 1});\r\n                $( '#'+(____._options.nameIFrame) ).css({opacity: 0});\r\n                break;\r\n        }\r\n        \r\n        $container.trigger( \"pp.changepageproofsordesign\", show );\r\n        \r\n        ____.$session.find( \"show_page_proofs_or_design\" ).text( show );\r\n        ____._saveSession();\r\n    }\r\n    \r\n    this._restoreSession = function() {\r\n        if( !(\"$session\" in ____) ) {\r\n            //Отдаём запрос на создание миниатюрок из скринов и получаем список всех скринов и их разрешения\r\n            \r\n            $.ajax({\r\n                url: \"sb.php\",\r\n                type: \"POST\",\r\n                cache: false,\r\n                data: ({\r\n                    module: 'pixel_perfect',\r\n                    dir_scrins: ____._options.dirScrins,\r\n                    dir_miniatyrki: ____._options.dirThumbnail,\r\n                    width_miniatyrki: ____._options.widthThumbnail\r\n                }),\r\n                async: false,\r\n                success: function(data){\r\n                    ____.$listAllScrins = $($.parseXML(\"<wrap>\"+data+\"</wrap>\"));\r\n                }\r\n            });\r\n            \r\n            //Загружаем сессию\r\n            $.ajax({\r\n                url: \"sb.php\",\r\n                type: \"POST\",\r\n                cache: false,\r\n                data: ({module: 'getfile', dir: ____._options.urlXML, text_encoding: 'UTF-8'}),\r\n                async: false,\r\n                success: function(data){\r\n                    ____.$session = $($.parseXML(data));\r\n                    //Удаляем скрины из сессии которых уже нет (например пользователь удалил из папки)\r\n                    ____.$session.find( \"scrin\" ).each(function(){\r\n                        if( ____.$listAllScrins.find( \"scrin[src='\"+($(this).attr( \"src\" ))+\"']\" ).size() == 0 ) {\r\n                            $(this).remove();\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n            \r\n            $container.trigger(\"pp.create.sizelist\");\r\n        }\r\n        \r\n        ____._pasteScrins();\r\n        \r\n        ____.showPageProofsOrDesign( parseInt(____.$session.find( \"show_page_proofs_or_design\" ).text()) );\r\n        \r\n        screenshotsManipulator._restoreSession( ____.$session );\r\n    }\r\n    \r\n    this._saveSession = function() {\r\n        if( \"$session\" in ____ ) {\r\n            var resxml = ____.$session.xml().join('');\r\n            \r\n            //Записываем в файл\r\n            $.ajax({\r\n                url: \"sb.php\",\r\n                async: true,\r\n                cache: false,\r\n                type: \"POST\",\r\n                data: ({module: 'setfile', dir: ____._options.urlXML, file_text: resxml, text_encoding: 'UTF-8'})\r\n            });\r\n        }\r\n    }\r\n    \r\n        //надо удалять страницы которых уже нет\r\n        this._saveSessionAndClearDeletedPages = function( pageList ) {\r\n            ____.$session.find( \"page\" ).each(function(){\r\n                if( !( $(this).attr( \"href\" ) in pageList ) ) {\r\n                    $(this).remove();\r\n                }\r\n            });\r\n        }\r\n    \r\n    //Кроссмодульные методы\r\n    //Обновления индексов для \"_refreshByChangePosition\" чтобы можно было легко находить скрин в дизайне по левой панели\r\n    this._refreshIndexesForScrins = function() {\r\n        var index = 0;\r\n        \r\n        screenshotsManipulator.$container.find( \" .sm-container .sm-media\" ).each(function(){\r\n            index = 0;\r\n            $(this).find( \" .sm-scrin\" ).each(function(){\r\n                if( $(this).hasClass( \"active\" ) ) {\r\n                    $(this).attr( \"data-active-index\", index );\r\n                    index++;\r\n                }\r\n            });\r\n        });\r\n    }\r\n}\r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n\r\n    modules.pixelPerfect = pixelPerfect;\r\n    \r\n})(jQuery);"]}