{"version":3,"sources":["js/mylib/pixel-perfect/pixel-perfect.js"],"names":["$","pixelPerfect","$container","options","this","_options","____","_create","href","append","intervalRefreshByResizeDocument","wIFrame","changePositionTemp","window","nameIFrame","on","_refreshByScroll","_refreshByResizeDocument","setInterval","iframe","Math","round","document","width","_destroy","clearInterval","find","remove","$design","undefined","css","top","scrollTop","left","scrollLeft","refreshScrins","collectionScrins","sizeScrins","scrinsModified","scrinsChangePos","collectionScrinsTemp","length","i","a","b","urn","active","pos","l","t","lpx","tpx","lper","tper","refreshAllScrins","refreshPosScrins","_deleteScrins","empty","html","s","newObj","push","l_img","t_img","w","h","dirScrins","each","hasClass","removeClass","addClass","showPageProofsOrDesign","show","opacity","modules","jQuery"],"mappings":"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","file":"pixel-perfect.js","sourcesContent":["(function($){//Модули: malihu-custom-scrollbar\r\n\r\nvar defaultOptions = {\r\n    dirScrins: \"design-screenshots\",\r\n    nameIFrame: \"PP_iframe\"\r\n};\r\n\r\nvar pixelPerfect = function($container, options) {\r\n    this._options = options;\r\n    var ____ = this;\r\n    ____.$container = $container;\r\n    \r\n    this._create = function( href ) {\r\n        $container.append('<div class=\"pp-design\"></div>');\r\n        \r\n        //свойства\r\n        ____.intervalRefreshByResizeDocument = null;\r\n        ____.wIFrame = null;\r\n        \r\n        ____.changePositionTemp = {};\r\n        \r\n        //Установка событий\r\n        $(window[____._options.nameIFrame].window).on(\"scroll\", ____._refreshByScroll);\r\n        $(window[____._options.nameIFrame].window).on('resize', ____._refreshByResizeDocument);\r\n        ____.intervalRefreshByResizeDocument = setInterval(function(){\r\n            var iframe = window[____._options.nameIFrame];\r\n            if( ____.wIFrame === null || ____.wIFrame !== Math.round( $(iframe.document).width() ) ) {\r\n                ____.wIFrame = Math.round( $(iframe.document).width() );\r\n                ____._refreshByResizeDocument();\r\n            }\r\n        }, 1000);\r\n\r\n        //____.showPageProofsOrDesign( parseInt(____.$session.find( \"show_page_proofs_or_design\" ).text()) );\r\n    }\r\n    \r\n    this._destroy = function() {\r\n        if(____.intervalRefreshByResizeDocument !== null) {\r\n            clearInterval( ____.intervalRefreshByResizeDocument );\r\n        }\r\n        $container.find( \" .pp-design\" ).remove();\r\n    }\r\n    \r\n    this._refreshByScroll = function() {\r\n        var $design = $container.find( \" .pp-design\" );\r\n        var iframe = window[____._options.nameIFrame];\r\n\r\n        if(iframe !== undefined) {\r\n            $design.find( \" .pp-screen-static\" ).css({\r\n                top: \"-\" + Math.round( $(iframe.window).scrollTop() ) + \"px\",\r\n                left: \"-\" + Math.round( $(iframe.window).scrollLeft() ) + \"px\"\r\n            });\r\n        }\r\n    }\r\n    \r\n    this._refreshByResizeDocument = function() {\r\n        var iframe = window[____._options.nameIFrame];\r\n        if(iframe !== undefined) {\r\n            var $design = $container.find( \" .pp-design\" );\r\n\r\n            $design.find( \" .pp-screen-static\" ).css({\r\n                width: Math.round( $(iframe.document).width() )\r\n            });\r\n        }\r\n    }\r\n    \r\n    this.refreshScrins = function(collectionScrins, sizeScrins) {\r\n        if(collectionScrins !== null) {\r\n            var scrinsModified = false;\r\n            var scrinsChangePos = false;\r\n            if(!(\"collectionScrinsTemp\" in ____)) {\r\n                scrinsModified = true;\r\n            } else if(typeof ____.collectionScrinsTemp !== typeof collectionScrins) {//null или обьект\r\n                scrinsModified = true;\r\n            } else if(____.collectionScrinsTemp.length != collectionScrins.length) {\r\n                scrinsModified = true;\r\n            } else {\r\n                for(var i in ____.collectionScrinsTemp) {\r\n                    var a = ____.collectionScrinsTemp[i];\r\n                    var b = collectionScrins[i];\r\n                    if(a.urn !== b.urn || a.active !== b.active) {\r\n                        scrinsModified = true;\r\n                        break;\r\n                    } else if(a.pos !== b.pos || a.l !== b.l || a.t !== b.t || a.lpx !== b.lpx || a.tpx !== b.tpx || a.lper !== b.lper || a.tper !== b.tper) {\r\n                        scrinsChangePos = true;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if(scrinsModified) {\r\n                ____.refreshAllScrins(collectionScrins, sizeScrins);\r\n            } else if(scrinsChangePos) {\r\n                ____.refreshPosScrins(collectionScrins);\r\n            }\r\n\r\n            ____._refreshByScroll();\r\n            ____._refreshByResizeDocument();\r\n        } else {\r\n            ____._deleteScrins();\r\n        }\r\n    }\r\n\r\n    this._deleteScrins = function() {\r\n        $container.find( \" .pp-design\" ).empty();\r\n    }\r\n\r\n    this.refreshAllScrins = function(collectionScrins, sizeScrins) {\r\n        ____._deleteScrins();\r\n        var $design = $container.find( \" .pp-design\" );\r\n        var html = \"\";\r\n\r\n        ____.collectionScrinsTemp = [];\r\n\r\n        for(var i in collectionScrins) {\r\n            var s = collectionScrins[i];\r\n            //сохраним изменения\r\n            var newObj = {};\r\n            ____.collectionScrinsTemp.push(newObj);\r\n            //\r\n\r\n            if(s.active) {\r\n                if(s.pos == \"static\") {\r\n                    s.t = \"top\";\r\n                }\r\n\r\n                var l, t, l_img, t_img;\r\n                switch(s.l) {\r\n                    case \"left\": l = 0; l_img = 0; break;\r\n                    case \"center\": l = 50; l_img = -50; break;\r\n                    case \"right\": l = 100; l_img = -100; break;\r\n                }\r\n                switch(s.t) {\r\n                    case \"top\": t = 0; t_img = 0; break;\r\n                    case \"center\": t = 50; t_img = -50; break;\r\n                    case \"bottom\": t = 100; t_img = -100; break;\r\n                }\r\n                html += '\\\r\n                    <div class=\"pp-screen-design pp-screen-'+((s.pos == \"static\")?\"static\":\"fixed\")+'\">\\\r\n                        <div style=\"left: '+(s.lper + l)+'%; top: '+(s.tper + t)+'%;\" class=\"pp-wrap-deviation-percent\">\\\r\n                            <div style=\"width: ' + sizeScrins[s.urn].w + 'px; height: ' + sizeScrins[s.urn].h + 'px; left: ' + s.lpx + 'px; top: ' + s.tpx + 'px;\" class=\"pp-wrap-deviation-pixels\">\\\r\n                                <img src=\"'+(____._options.dirScrins + \"/\" + s.urn)+'\" style=\"width: ' + sizeScrins[s.urn].w + 'px; height: ' + sizeScrins[s.urn].h + 'px; left: ' + l_img + '%; top: ' + t_img + '%;\"/>\\\r\n                            </div>\\\r\n                        </div>\\\r\n                    </div>';\r\n            }\r\n        }\r\n\r\n        $design.append(html);\r\n\r\n        ____._refreshByScroll();\r\n        ____._refreshByResizeDocument();\r\n    }\r\n\r\n    this.refreshPosScrins = function(collectionScrins) {\r\n        var $design = $container.find( \" .pp-design\" );\r\n\r\n        var i = 0;\r\n        $design.find(\" .pp-screen-design\").each(function() {\r\n            do {\r\n                i++;\r\n                var a = ____.collectionScrinsTemp[i-1];\r\n                var b = collectionScrins[i-1];\r\n                if((a.pos !== b.pos || a.l !== b.l || a.t !== b.t || a.lpx !== b.lpx || a.tpx !== b.tpx || a.lper !== b.lper || a.tper !== b.tper)) {\r\n                    //записываем изменения\r\n                    a.pos = b.pos, a.l = b.l, a.t = b.t, a.lpx = b.lpx, a.tpx = b.tpx, a.lper = b.lper, a.tper = b.tper;\r\n                    if(b.active) {\r\n                        if(b.pos == \"static\") {\r\n                            b.t = \"top\";\r\n                        }\r\n\r\n                        var l, t, l_img, t_img;\r\n                        switch(b.l) {\r\n                            case \"left\": l = 0; l_img = 0; break;\r\n                            case \"center\": l = 50; l_img = -50; break;\r\n                            case \"right\": l = 100; l_img = -100; break;\r\n                        }\r\n                        switch(b.t) {\r\n                            case \"top\": t = 0; t_img = 0; break;\r\n                            case \"center\": t = 50; t_img = -50; break;\r\n                            case \"bottom\": t = 100; t_img = -100; break;\r\n                        }\r\n\r\n                        //применяем\r\n                        if(b.pos == \"static\") {\r\n                            if(!$(this).hasClass(\"pp-screen-static\")) {\r\n                                $(this).removeClass(\"pp-screen-fixed\").addClass(\"pp-screen-static\");\r\n                            }\r\n                        } else {\r\n                            if(!$(this).hasClass(\"pp-screen-fixed\")) {\r\n                                $(this).removeClass(\"pp-screen-static\").addClass(\"pp-screen-fixed\");\r\n                            }\r\n                        }\r\n                        $(this).find(\" .pp-wrap-deviation-percent\").css({left: (b.lper + l) + \"%\", top: (b.tper + t) + \"%\"});\r\n                        $(this).find(\" .pp-wrap-deviation-pixels\").css({left: b.lpx, top: b.tpx});\r\n                        $(this).find(\" img\").css({left: l_img + \"%\", top: t_img + \"%\"});\r\n                    } else {\r\n                        continue;\r\n                    }\r\n                }\r\n            } while(false);\r\n        });\r\n    }\r\n    \r\n    this.showPageProofsOrDesign = function(show) {\r\n        //0 - показать верстку,\r\n        //1 - показать на половину и верстку и дизайн,\r\n        //2 - показать дизайн\r\n        switch (show) {\r\n            case 0:\r\n                $container.find( \" .pp-design\" ).css({opacity: 0});\r\n                $( '#'+(____._options.nameIFrame) ).css({opacity: 1});\r\n                break;\r\n            case 1:\r\n                $container.find( \" .pp-design\" ).css({opacity: 1});\r\n                $( '#'+(____._options.nameIFrame) ).css({opacity: 0.5});\r\n                break;\r\n            case 2:\r\n                $container.find( \" .pp-design\" ).css({opacity: 1});\r\n                $( '#'+(____._options.nameIFrame) ).css({opacity: 0});\r\n                break;\r\n        }\r\n    }\r\n}\r\n\r\n    modules.pixelPerfect = pixelPerfect;\r\n    \r\n})(jQuery);"]}