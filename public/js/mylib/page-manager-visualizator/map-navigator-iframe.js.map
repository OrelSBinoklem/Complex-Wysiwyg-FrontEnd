{"version":3,"sources":["js/mylib/page-manager-visualizator/map-navigator-iframe.js"],"names":["$","mapNavigatorIFrame","$container","options","this","_options","____","_last_cursor_Y","_last_cursor_X","_create","$iFrame","contents","append","_draggable","_cursor_Y","_cursor_X","_draggableTopTemp","_draggableLeftTemp","find","on","_handlerMove","_handlerDown","_handlerUp","_destroy","remove","off","reload","e","which","ctrlKey","shiftKey","altKey","$mnif","attr","css","display","w","outerWidth","h","outerHeight","w_c","width","h_c","height","Math","round","top","left","position","updateDraggable","preventDefault","stop","returnValue","stopPropagation","t","l","wDrag","hDrag","tDrag","lDrag","wDrag_c","hDrag_c","$iframe","$fittingWrap","closest","$outerWrap","minHDraggable","minWDraggable","screenX","screenY","stepVertical","stepGorizontal","resTop","resLeft","responsiveToMovementOfTheCursorInAConfinedSpace","modules","jQuery"],"mappings":"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","file":"map-navigator-iframe.js","sourcesContent":["(function($){//Модули: \r\n\r\nvar defaultOptions = {\r\n    nameIFrame: \"\",\r\n    minWDraggable: 15,\r\n    minHDraggable: 15,\r\n    responsiveToMovementOfTheCursorInAConfinedSpace: false//при активации реагировать на движение в определённой области при движеннии в которой навигатор может отобразить все части вёрстки. Если отключить то при выходе из области она начнет следовать за курсором и остановиться если он сменит направление и будет реагировать\r\n    //доделать спред(чтоб запоминалось например на 5 пикселей)\r\n};\r\n\r\nvar mapNavigatorIFrame = function($container, options) {\r\n    this._options = options;\r\n    var ____ = this;\r\n\r\n    ____._last_cursor_Y = 0;\r\n    ____._last_cursor_X = 0;\r\n\r\n    this._create = function()\r\n    {\r\n        var $iFrame = $(\"#\"+(____._options.nameIFrame)).contents();\r\n        \r\n        $container.append('<div class=\"mnif-show-space panel panel-primary\"><div class=\"mnif-draggable panel-body\"></div></div>');\r\n        \r\n        //Свойства для навигатора\r\n        ____._draggable = false;\r\n        ____._cursor_Y = 0;\r\n        ____._cursor_X = 0;\r\n        ____._draggableTopTemp = 0;\r\n        ____._draggableLeftTemp = 0;\r\n        \r\n        //Установка обработчиков событий\r\n        $iFrame.find('body').on('mousemove', ____._handlerMove);\r\n        $('body').on('mousemove', ____._handlerMove);\r\n        $('body').on('keydown', ____._handlerDown);\r\n        $iFrame.find('body').on('keydown', ____._handlerDown);\r\n        $('body').on('keyup', ____._handlerUp);\r\n        $iFrame.find('body').on('keyup', ____._handlerUp);\r\n    }\r\n    \r\n    this._destroy = function()\r\n    {\r\n        $container.find(\" .mnif-show-space\").remove();\r\n        \r\n        var $iFrame = $(\"#\"+(____._options.nameIFrame)).contents();\r\n        \r\n        $iFrame.find('body').off('mousemove', ____._handlerMove);\r\n        $('body').off('mousemove', ____._handlerMove);\r\n        $('body').off('keydown', ____._handlerDown);\r\n        $iFrame.find('body').off('keydown', ____._handlerDown);\r\n        $('body').off('keyup', ____._handlerUp);\r\n        $iFrame.find('body').off('keyup', ____._handlerUp);\r\n    }\r\n    \r\n    this.reload = function()\r\n    {\r\n        ____._destroy();\r\n        ____._create();\r\n    }\r\n    \r\n    //Нажатие на комбинацию клавиш\r\n    this._handlerDown = function(e)\r\n    {\r\n        if(e.which == 69 && e.ctrlKey && !e.shiftKey && !e.altKey)\r\n        {\r\n            if( !____._draggable ) {\r\n                //Фиксация в пикселах (чтоб меньше багов при расчётах было) и центрирование\r\n                var $mnif = $container.find(\" .mnif-show-space\");\r\n                $mnif\r\n                .attr(\"style\", \"\")\r\n                .css({display: \"block\"});\r\n                var w = $mnif.outerWidth();\r\n                var h = $mnif.outerHeight();\r\n                var w_c = $container.find(\".pmv-outer-wrap\").width();\r\n                var h_c = $container.find(\".pmv-outer-wrap\").height();\r\n                \r\n                $mnif.css({\r\n                    width: Math.round( w ),\r\n                    height: Math.round( h ),\r\n                    top: Math.round( (h_c - h) / 2 ),\r\n                    left: Math.round( (w_c - w) / 2 ),\r\n                });\r\n                \r\n                ____._draggable = true;\r\n                ____._cursor_X = false;\r\n                ____._cursor_Y = false;\r\n                ____._draggableTopTemp = $container.find(\".pmv-fitting-wrap\").position().top;\r\n                ____._draggableLeftTemp = $container.find(\".pmv-fitting-wrap\").position().left;\r\n                \r\n                ____.updateDraggable();\r\n            }\r\n                \r\n            \r\n            if(e.preventDefault){ e.preventDefault()}\r\n  \t\t    else{e.stop()};\r\n    \t\te.returnValue = false;\r\n    \t\te.stopPropagation();\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    //Отпускание клавиш\r\n    this._handlerUp = function(e)\r\n    {\r\n        if( ____._draggable ) {\r\n            var $mnif = $container.find(\" .mnif-show-space\");\r\n            $mnif.css({display: \"none\"});\r\n            ____._draggable = false;\r\n        }\r\n    }\r\n    \r\n    //Обновление карты\r\n    this.updateDraggable = function()\r\n    {\r\n        var $iframe = $(\"#\"+(____._options.nameIFrame));\r\n        var $fittingWrap = $iframe.closest(\".pmv-fitting-wrap\");\r\n        var $outerWrap = $iframe.closest(\".pmv-outer-wrap\");\r\n        var $mnif = $container.find(\" .mnif-show-space\");\r\n        var w, h, w_c, t, l, h_c,\r\n        wDrag, hDrag, tDrag, lDrag, wDrag_c, hDrag_c;\r\n        \r\n        w =   $fittingWrap.width();\r\n        h =   $fittingWrap.height();\r\n        t =   $fittingWrap.position().top;\r\n        l =   $fittingWrap.position().left;\r\n        w_c = $outerWrap.width();\r\n        h_c = $outerWrap.height();\r\n        \r\n        wDrag_c = $mnif.width();\r\n        hDrag_c = $mnif.height();\r\n        \r\n        hDrag = h_c / h * hDrag_c;\r\n        if(hDrag < ____._options.minHDraggable) {hDrag = ____._options.minHDraggable;}\r\n        if(hDrag > hDrag_c) {hDrag = hDrag_c;}\r\n        tDrag = t / - (h - h_c) * (hDrag_c - hDrag);\r\n        \r\n        wDrag = w_c / w * wDrag_c;\r\n        if(wDrag < ____._options.minWDraggable){wDrag = ____._options.minWDraggable;}\r\n        if(wDrag > wDrag_c) {wDrag = wDrag_c;}\r\n        lDrag = l / - (w - w_c) * (wDrag_c - wDrag);\r\n        \r\n        $mnif.find( \".mnif-draggable\" ).css({\r\n            width: Math.round( wDrag ),\r\n            height: Math.round( hDrag ),\r\n            top: Math.round( tDrag ),\r\n            left: Math.round( lDrag ),\r\n        });\r\n    }\r\n    \r\n    //Обновление скрытого скролла в IFrame\r\n    this._handlerMove = function(e)\r\n    {\r\n        ____._last_cursor_X = e.screenX;\r\n        ____._last_cursor_Y = e.screenY;\r\n        \r\n        if( ____._draggable )\r\n        {\r\n            if(____._cursor_Y === false) {\r\n                ____._cursor_X = ____._last_cursor_X;\r\n                ____._cursor_Y = ____._last_cursor_Y;\r\n            }\r\n            \r\n            var $iframe = $(\"#\"+(____._options.nameIFrame));\r\n            var $fittingWrap = $iframe.closest(\".pmv-fitting-wrap\");\r\n            var $outerWrap = $iframe.closest(\".pmv-outer-wrap\");\r\n            var $mnif = $container.find(\" .mnif-show-space\");\r\n            var w, h, w_c, h_c, t, l,\r\n            wDrag, hDrag, tDrag, lDrag, wDrag_c, hDrag_c,\r\n            stepVertical, stepGorizontal,\r\n            resTop, resLeft;\r\n            \r\n            w =   $fittingWrap.width();\r\n            h =   $fittingWrap.height();\r\n            t =   $fittingWrap.position().top;\r\n            l =   $fittingWrap.position().left;\r\n            w_c = $outerWrap.width();\r\n            h_c = $outerWrap.height();\r\n            \r\n            wDrag_c = $mnif.width();\r\n            hDrag_c = $mnif.height();\r\n            \r\n            //Вычисляем размеры элементов \"за которые можно прокручивать\" на внешнем скролле и отступы для смешения чтоб показать насколько прокручена страница\r\n            hDrag = h_c / h * hDrag_c;\r\n            if(hDrag < ____._options.minHDraggable) {hDrag = ____._options.minHDraggable;}\r\n            \r\n            wDrag = w_c / w * wDrag_c;\r\n            if(wDrag < ____._options.minWDraggable){wDrag = ____._options.minWDraggable;}\r\n            \r\n            //Количество пикселей при перемещении курсора на 1 пиксель\r\n            stepVertical = - (h - h_c) / (hDrag_c - hDrag);\r\n            stepGorizontal = - (w - w_c) / (wDrag_c - wDrag);\r\n            \r\n            if(h > h_c) {\r\n                resTop = (e.screenY - ____._cursor_Y) * stepVertical + ____._draggableTopTemp;\r\n                if( resTop > 0 ) {\r\n                    resTop = 0;\r\n                    if(!____._options.responsiveToMovementOfTheCursorInAConfinedSpace) {\r\n                        ____._cursor_Y = e.screenY; ____._draggableTopTemp = t;\r\n                    } \r\n                }\r\n                if( resTop < - (h - h_c) ) {\r\n                    resTop = - (h - h_c);\r\n                    if(!____._options.responsiveToMovementOfTheCursorInAConfinedSpace) {\r\n                        ____._cursor_Y = e.screenY; ____._draggableTopTemp = t;\r\n                    } \r\n                }\r\n                \r\n                $fittingWrap.css({top: Math.round( resTop )});\r\n            }\r\n            \r\n            if(w > w_c) {\r\n                resLeft = (e.screenX - ____._cursor_X) * stepGorizontal + ____._draggableLeftTemp;\r\n                if( resLeft > 0 ) {\r\n                    resLeft = 0;\r\n                    if(!____._options.responsiveToMovementOfTheCursorInAConfinedSpace) {\r\n                        ____._cursor_X = e.screenX; ____._draggableLeftTemp = l;\r\n                    }                    \r\n                }\r\n                if( resLeft < - (w - w_c) ) {\r\n                    resLeft = - (w - w_c);\r\n                    if(!____._options.responsiveToMovementOfTheCursorInAConfinedSpace) {\r\n                        ____._cursor_X = e.screenX; ____._draggableLeftTemp = l;\r\n                                            \r\n                    } \r\n                }\r\n    \t\t\t\r\n                $fittingWrap.css({left: Math.round( resLeft )});\r\n            }\r\n            \r\n            ____.updateDraggable();\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodules.mapNavigatorIFrame = mapNavigatorIFrame;\r\n    \r\n})(jQuery);"]}