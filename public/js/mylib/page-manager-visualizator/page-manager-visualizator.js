!function(e){var t=function(t,i,a){this._options=a;var s=this;s.$container=t;var o=new modules.customScrollIFrame(t,this._options),n=new modules.mapNavigatorIFrame(a.$mapNavigatorContainer,this._options),r=new modules.resizeIFrame(t,this._options),p=new modules.fixationContentAtResize(t,this._options);o._initPasteHTML(),t.on("pmv.load.iframe",function(){o.reload()}),t.on("pmv.load.iframe",n.reload),t.on("pmv.load.iframe",r.reload),t.on({"pmv.load.iframe":p.reload,"rif.start.resize":p.startFixation,"rif.stop.resize":p.stopFixation}),this._create=function(){this._init(),t.on("wheel",o._handlerMouseWheel)},this._destroy=function(){t.off("wheel",o._handlerMouseWheel),s._saveSession(),t.find(".pmv-outer-wrap").remove()},this._init=function(){t.append('<div class="pmv-outer-wrap"><div class="pmv-fitting-wrap"></div></div>'),t.append('<div class="pmv-container-bl"></div><div class="pmv-container-bb"></div><div class="pmv-container-br"></div>'),a.pageList={},s._restoreSession("pagelist"),t.on("pmv.load.iframe",function(){s._restoreSession("size_iframe"),s._restoreSession("scroll_iframe"),s._restoreSession("position_iframe"),r._centerIFrameAndNoEmptySpace()})},this.selectPage=function(e){s.currentPage=e,s._destroyIFrame(),s._createIFrame(e)},this._createIFrame=function(i){t.trigger("pmv.prepaste.iframe"),s.lastLoadPage=i,s.currentPage=i,t.find(".pmv-fitting-wrap").append('<iframe id="'+s._options.nameIFrame+'" name="'+s._options.nameIFrame+'" src="'+i+'" width="100%" height="100%"></iframe>'),e("#"+s._options.nameIFrame).load(function(){t.trigger("pmv.load.iframe"),e("#"+s._options.nameIFrame).contents().find("body").on("click",function(t){e("body").trigger("click.body.iframe")})})},this._destroyIFrame=function(){s._saveSession(),e("#"+s._options.nameIFrame).remove()},this._restoreSession=function(t){switch("$session"in s||s.$session.find("pages page").each(function(){s._options.pageList[e(this).attr("href")]={active:"true"==e(this).attr("active")}}),t){case"pagelist":for(var i in s._options.pageList)if(s._options.pageList[i].active){s.selectPage(i);break}break;case"scroll_iframe":var a,o,n=window[s._options.nameIFrame],r=s.$session.find(" page[href='"+s.lastLoadPage+"'][scrolltop][scrollleft]");r.size()&&s.lastLoadPage in s._options.pageList&&(a=parseInt(r.attr("scrolltop")),o=parseInt(r.attr("scrollleft")),e(n.window).scrollTop(a),e(n.window).scrollLeft(o));break;case"position_iframe":var p,l,n=window[s._options.nameIFrame],m=e("#"+s._options.nameIFrame),d=m.closest(".pmv-fitting-wrap"),r=s.$session.find(" page[href='"+s.lastLoadPage+"'][l][t]");r.size()&&s.lastLoadPage in s._options.pageList&&(l=parseInt(r.attr("l")),p=parseInt(r.attr("t")),d.css({left:l,top:p}));break;case"size_iframe":var f,c,n=window[s._options.nameIFrame],m=e("#"+s._options.nameIFrame),d=m.closest(".pmv-fitting-wrap"),r=s.$session.find(" page[href='"+s.lastLoadPage+"'][w][h]");r.size()&&(f=parseInt(r.attr("w")),c=parseInt(r.attr("h")),d.css({width:f,height:c}))}},this._saveSession=function(){if("$session"in s){var t,i=s.$session.find(" pages");for(var a in s._options.pageList){var o=s._options.pageList[a],n=i.find("page[href='"+a+"']");if(n.size())n.attr("active",o.active);else if(t){var n=i.find("page[href='"+t+"']");n.after('<page href="'+a+'" active="'+o.active+'" />')}else i.append('<page href="'+a+'" active="'+o.active+'" />');t=a}if(i.find(" page").each(function(){e(this).attr("href")in s._options.pageList||e(this).remove()}),s._options.nameIFrame in window){var r=s.$session.find("pages page[href='"+s.lastLoadPage+"']");if(r.size()){var p=window[s._options.nameIFrame],l=e("#"+s._options.nameIFrame),m=l.closest(".pmv-fitting-wrap");r.attr("scrolltop",Math.round(e(p.window).scrollTop()||0)).attr("scrollleft",Math.round(e(p.window).scrollLeft()||0)).attr("l",Math.round(m.position().left)).attr("t",Math.round(m.position().top)).attr("w",Math.round(m.width())).attr("h",Math.round(m.height()))}}var d=s.$session.xml().join("");e.ajax({url:"sb.php",async:!0,cache:!1,type:"POST",data:{module:"setfile",dir:s._options.urlXML,file_text:d,text_encoding:"UTF-8"}})}},this._restoreSessionFromSubModules=function(){r._restoreSession(),o._restoreSession(),n._restoreSession(),r._centerIFrameAndNoEmptySpace()}};modules.pageManagerVisualizator=t}(jQuery);
//# sourceMappingURL=page-manager-visualizator.js.map
