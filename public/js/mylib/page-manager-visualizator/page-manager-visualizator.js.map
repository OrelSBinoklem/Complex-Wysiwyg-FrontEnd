{"version":3,"sources":["js/mylib/page-manager-visualizator/page-manager-visualizator.js"],"names":["$","pageManagerVisualizator","$container","sessionModel","options","this","_options","____","customScrollIFrame","modules","mapNavigatorIFrame","$mapNavigatorContainer","resizeIFrame","fixationContentAtResize","_initPasteHTML","on","reload","pmv.load.iframe","rif.start.resize","startFixation","rif.stop.resize","stopFixation","_create","_init","_handlerMouseWheel","_destroy","off","_saveSession","find","remove","addPage","href","pageList","key","active","currentPage","trigger","selectPage","removePage","firstPage","_destroyIFrame","_createIFrame","reloadPage","changePage","lastLoadPage","append","load","contents","e","_restoreSession","specific","$session","each","attr","scrollTop","scrollLeft","iframe","window","nameIFrame","$page","size","parseInt","t","l","$iframe","$fittingWrap","closest","css","left","top","w","h","width","height","pre_href","$pages","page","after","$thisPage","Math","round","position","resxml","xml","join","ajax","url","async","cache","type","data","module","dir","urlXML","file_text","text_encoding","_restoreSessionFromSubModules","_centerIFrameAndNoEmptySpace","jQuery"],"mappings":"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","file":"page-manager-visualizator.js","sourcesContent":["(function($){//Модули: getfile, setfile, .xml(), customScrollIFrame\r\n\r\nvar defaultOptions = {\r\n    $mapNavigatorContainer: undefined,\r\n    nameIFrame: \"PP_iframe\",\r\n    pixelsScrollableInSeconds: 2000,\r\n    minWOuterScroll: 23,\r\n    minHOuterScroll: 23,\r\n    minWDraggable: 15,\r\n    minHDraggable: 15,\r\n    minWIFrame: 320,\r\n    minHIFrame: 480,\r\n    responsiveToMovementOfTheCursorInAConfinedSpace: false,\r\n    \r\n    gorizontalFixation: \"center\",\r\n    verticalFixation: \"top\"\r\n};\r\n\r\nvar pageManagerVisualizator = function($container, sessionModel, options) {\r\n    this._options = options;\r\n    var ____ = this;\r\n    ____.$container = $container;\r\n    \r\n    var customScrollIFrame = new modules.customScrollIFrame($container, this._options);\r\n    var mapNavigatorIFrame = new modules.mapNavigatorIFrame(options.$mapNavigatorContainer, this._options);\r\n    var resizeIFrame = new modules.resizeIFrame($container, this._options);\r\n    var fixationContentAtResize = new modules.fixationContentAtResize($container, this._options);\r\n    \r\n    //Синхронизируем с кастомным скроллом\r\n    customScrollIFrame._initPasteHTML();\r\n    $container.on(\"pmv.load.iframe\", function(){\r\n        customScrollIFrame.reload();\r\n    });\r\n    //Синхронизируем с мап навигатором\r\n    $container.on(\"pmv.load.iframe\", mapNavigatorIFrame.reload);\r\n    //Синхронизируем с ресайзером\r\n    $container.on(\"pmv.load.iframe\", resizeIFrame.reload);\r\n    //Синхронизируем с фиксатором контента при ресайзе\r\n    $container.on({\r\n        \"pmv.load.iframe\": fixationContentAtResize.reload,\r\n        \"rif.start.resize\": fixationContentAtResize.startFixation,\r\n        \"rif.stop.resize\": fixationContentAtResize.stopFixation\r\n    });\r\n    \r\n    this._create = function() {\r\n        this._init();\r\n        \r\n        //Чтобы скролл работал не только в iFrame Но и во всём блоке\r\n        $container.on('wheel', customScrollIFrame._handlerMouseWheel);\r\n    }\r\n    \r\n    this._destroy = function() {\r\n        //Чтобы скролл работал не только в iFrame Но и во всём блоке\r\n        $container.off('wheel', customScrollIFrame._handlerMouseWheel);\r\n        ____._saveSession();\r\n        \r\n        $container.find( \".pmv-outer-wrap\" ).remove();\r\n    }\r\n    \r\n    this._init = function() {\r\n        /*$container.append('<div class=\"pmv-outer-wrap\"><div class=\"pmv-fitting-wrap\"></div></div>');\r\n        $container.append('<div class=\"pmv-container-bl\"></div><div class=\"pmv-container-bb\"></div><div class=\"pmv-container-br\"></div>');\r\n        //Получем список страниц\r\n        options.pageList = {};\r\n        ____._restoreSession( \"pagelist\" );\r\n        $container.on(\"pmv.load.iframe\", function(){\r\n            ____._restoreSession( \"size_iframe\" );\r\n            ____._restoreSession( \"scroll_iframe\" );\r\n            ____._restoreSession( \"position_iframe\" );\r\n            \r\n            resizeIFrame._centerIFrameAndNoEmptySpace();//И так сработает после всех методов - потому что события выполняються позже (КРОМЕ FIREFOX)\r\n        });*/\r\n    }\r\n    \r\n    this.addPage = function(href) {\r\n        if( !(href in ____._options.pageList) ) {\r\n            //Если такой страницы нету\r\n            for( var key in ____._options.pageList ) {\r\n                ____._options.pageList[key].active = false;\r\n            }\r\n            ____._options.pageList[href] = {active: true};\r\n            ____.currentPage = href;\r\n            $container.trigger(\"pmv.change.pagelist\");\r\n            ____.selectPage(href);\r\n        } else {\r\n            if( !(____._options.pageList[href].active) ) {\r\n                //Если страница есть но она неактивна - делаем её активной\r\n                for( var key in ____._options.pageList ) {\r\n                    ____._options.pageList[key].active = false;\r\n                }\r\n                ____._options.pageList[href].active = true;\r\n                ____.currentPage = href;\r\n                $container.trigger(\"pmv.change.pagelist\");\r\n                ____.selectPage(href);\r\n            }\r\n        }\r\n    }\r\n    \r\n    this.removePage = function(href) {\r\n        var firstPage = false;\r\n        if( href in ____._options.pageList ) {\r\n            if(____._options.pageList[href].active) {\r\n                //Если страница активна то удаляем её и переводим фокус в первую страницу (если она есть)\r\n                delete ____._options.pageList[href];\r\n                for( var key in ____._options.pageList ) {\r\n                    ____._options.pageList[key].active = true;\r\n                    firstPage = key;\r\n                    ____.currentPage = href;\r\n                    break;\r\n                }\r\n\r\n                $container.trigger(\"pmv.change.pagelist\");\r\n                ____._destroyIFrame();\r\n            } else {\r\n                //Если неактивна удаляем\r\n                delete ____._options.pageList[href];\r\n                $container.trigger(\"pmv.change.pagelist\");\r\n                ____._saveSession();\r\n            }\r\n            \r\n            if(firstPage !== false) {____._createIFrame(firstPage)};\r\n        }\r\n    }\r\n    \r\n    this.reloadPage = function() {\r\n        for(var key in ____._options.pageList) {\r\n            if(____._options.pageList[key].active) {\r\n                ____.selectPage(key);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    \r\n    this.selectPage = function(href) {\r\n        var changePage = false;\r\n        \r\n        for(var key in ____._options.pageList) {\r\n            if( href == key ) {\r\n                if( ____._options.pageList[key].active === false) {\r\n                    changePage = true;\r\n                }\r\n                ____._options.pageList[key].active = true;\r\n            } else {\r\n                ____._options.pageList[key].active = false;\r\n            }\r\n        }\r\n        \r\n        if( changePage ) {\r\n            ____.currentPage = href;\r\n            $container.trigger(\"pmv.change.pagelist\");\r\n        }\r\n        ____._destroyIFrame();\r\n        ____._createIFrame(href);\r\n    }\r\n    \r\n    this._createIFrame = function(href) {\r\n        $container.trigger(\"pmv.prepaste.iframe\");\r\n        ____.lastLoadPage = href;\r\n        ____.currentPage = href;\r\n        $container.find( \".pmv-fitting-wrap\" ).append('<iframe id=\"'+(____._options.nameIFrame)+'\" name=\"'+(____._options.nameIFrame)+'\" src=\"'+href+'\" width=\"100%\" height=\"100%\"></iframe>');\r\n        $( '#'+(____._options.nameIFrame) ).load(function(){\r\n            $container.trigger( \"pmv.load.iframe\" );\r\n            $( '#'+(____._options.nameIFrame) ).contents().find('body').on('click', function(e){\r\n                $( \"body\" ).trigger( \"click.body.iframe\" );\r\n            });\r\n        });\r\n    }\r\n    \r\n    this._destroyIFrame = function() {\r\n        ____._saveSession();        \r\n        $( '#'+(____._options.nameIFrame) ).remove();\r\n    }\r\n    \r\n    this._restoreSession = function( specific ) {\r\n        if( !(\"$session\" in ____) ) {\r\n            ____.$session.find( \"pages page\" ).each(function(){\r\n                ____._options.pageList[$(this).attr(\"href\")] = {\r\n                    active: ($(this).attr(\"active\") == \"true\") ? true : false\r\n                }\r\n            });\r\n        }\r\n        \r\n        switch( specific ) {\r\n            //Загрузка активной страницы \r\n            case \"pagelist\":\r\n                for(var key in ____._options.pageList) {\r\n                    if(____._options.pageList[key].active) {\r\n                        ____.selectPage(key);\r\n                        break;\r\n                    }\r\n                } \r\n                break;\r\n            case \"scroll_iframe\":\r\n                var iframe = window[____._options.nameIFrame];\r\n                var scrollTop, scrollLeft;\r\n                \r\n                var $page = ____.$session.find( \" page[href='\"+____.lastLoadPage+\"'][scrolltop][scrollleft]\" );\r\n                if( $page.size() && ____.lastLoadPage in ____._options.pageList ) {\r\n                    scrollTop = parseInt( $page.attr( \"scrolltop\" ) );\r\n                    scrollLeft = parseInt( $page.attr( \"scrollleft\" ) );\r\n                    \r\n                    $(iframe.window).scrollTop( scrollTop );\r\n                    $(iframe.window).scrollLeft( scrollLeft );\r\n                }\r\n                break;\r\n            case \"position_iframe\": \r\n                var iframe = window[____._options.nameIFrame];\r\n                var $iframe = $(\"#\"+(____._options.nameIFrame));\r\n                var $fittingWrap = $iframe.closest(\".pmv-fitting-wrap\");\r\n                var t, l;\r\n                \r\n                var $page = ____.$session.find( \" page[href='\"+____.lastLoadPage+\"'][l][t]\" );\r\n                if( $page.size() && ____.lastLoadPage in ____._options.pageList ) {\r\n                    l = parseInt( $page.attr( \"l\" ) );\r\n                    t = parseInt( $page.attr( \"t\" ) );\r\n                    \r\n                    $fittingWrap.css({\r\n                        left: l,\r\n                        top: t\r\n                    });\r\n                }\r\n                break;\r\n            case \"size_iframe\":\r\n                var iframe = window[____._options.nameIFrame];\r\n                var $iframe = $(\"#\"+(____._options.nameIFrame));\r\n                var $fittingWrap = $iframe.closest(\".pmv-fitting-wrap\");\r\n                var w, h;\r\n                \r\n                var $page = ____.$session.find( \" page[href='\"+____.lastLoadPage+\"'][w][h]\" );\r\n                if( $page.size() ) {\r\n                    w = parseInt( $page.attr( \"w\" ) );\r\n                    h = parseInt( $page.attr( \"h\" ) );\r\n                    \r\n                    $fittingWrap.css({\r\n                        width: w,\r\n                        height: h\r\n                    });\r\n                }\r\n                break;\r\n        }\r\n    }\r\n    \r\n    this._saveSession = function() {\r\n        if( \"$session\" in ____ ) {\r\n            //Сохраняем страницы (синхронизируем pageList и xml)\r\n                var $pages = ____.$session.find( \" pages\" );\r\n                var pre_href;\r\n                //вставляем которых нет в xml\r\n                for(var href in ____._options.pageList) {\r\n                    var page = ____._options.pageList[href];\r\n                    \r\n                    var $page = $pages.find( \"page[href='\"+(href)+\"']\" );\r\n                    if( $page.size() ) {\r\n                        $page.attr( \"active\", page.active );\r\n                    } else {\r\n                        if( pre_href ) {\r\n                            var $page = $pages.find( \"page[href='\"+(pre_href)+\"']\" );\r\n                            $page.after( '<page href=\"'+(href)+'\" active=\"'+(page.active)+'\" />' );\r\n                        } else {\r\n                            $pages.append( '<page href=\"'+(href)+'\" active=\"'+(page.active)+'\" />' );\r\n                        }\r\n                    }\r\n                    pre_href = href;\r\n                }\r\n                //удаляем которых нет в pageList\r\n                $pages.find( \" page\" ).each(function(){\r\n                    if( !($(this).attr( \"href\" ) in ____._options.pageList) ) {\r\n                        $(this).remove();\r\n                    }\r\n                });\r\n            \r\n            //Сохраняем состояние iFrame (если он есть)\r\n            if( ____._options.nameIFrame in window ) {\r\n                var $thisPage = ____.$session.find( \"pages page[href='\"+(____.lastLoadPage)+\"']\" );\r\n                if( $thisPage.size() ) {\r\n                    var iframe = window[____._options.nameIFrame];\r\n                    var $iframe = $(\"#\"+(____._options.nameIFrame));\r\n                    var $fittingWrap = $iframe.closest(\".pmv-fitting-wrap\");\r\n                    \r\n                    $thisPage\r\n                        .attr( \"scrolltop\", Math.round( $(iframe.window).scrollTop() || 0) )\r\n                        .attr( \"scrollleft\",  Math.round( $(iframe.window).scrollLeft() || 0) )\r\n                        .attr( \"l\", Math.round( $fittingWrap.position().left) )\r\n                        .attr( \"t\", Math.round( $fittingWrap.position().top) )\r\n                        .attr( \"w\", Math.round( $fittingWrap.width()) )\r\n                        .attr( \"h\", Math.round( $fittingWrap.height()) );\r\n                }\r\n            }\r\n            \r\n            //'<\\?xml version=\"1.0\" encoding=\"UTF-8\"\\?>'+\r\n            var resxml = ____.$session.xml().join('');\r\n            \r\n            //Записываем в файл\r\n            $.ajax({\r\n                url: \"sb.php\",\r\n                async: true,\r\n                cache: false,\r\n                type: \"POST\",\r\n                data: ({module: 'setfile', dir: ____._options.urlXML, file_text: resxml, text_encoding: 'UTF-8'})\r\n            });\r\n        }\r\n    }\r\n    \r\n    this._restoreSessionFromSubModules = function() {\r\n        resizeIFrame._restoreSession();\r\n        customScrollIFrame._restoreSession();\r\n        mapNavigatorIFrame._restoreSession();\r\n        \r\n        resizeIFrame._centerIFrameAndNoEmptySpace();//И так сработает после всех методов - потому что события выполняються позже (КРОМЕ FIREFOX)\r\n    }          \r\n}\r\n    \r\n/*jQuery.fn.responsiveBlock = function(options){\r\n    options = $.extend({\r\n        defColor:\"white\",\r\n        hoverColor:\"red\"\r\n    }, options});\r\n\r\n    var make = function(){\r\n        \r\n    };\r\n\r\n    return this.each(make);*/\r\n    modules.pageManagerVisualizator = pageManagerVisualizator;\r\n    \r\n})(jQuery);"]}