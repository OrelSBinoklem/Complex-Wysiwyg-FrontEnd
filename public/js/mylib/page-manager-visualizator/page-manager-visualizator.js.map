{"version":3,"sources":["js/mylib/page-manager-visualizator/page-manager-visualizator.js"],"names":["$","pageManagerVisualizator","$container","sessionModel","options","this","_options","____","customScrollIFrame","modules","mapNavigatorIFrame","resizeIFrame","fixationContentAtResize","_initPasteHTML","on","reload","pmv.load.iframe","rif.center-iframe","updateDraggable","rif.start.resize","startFixation","rif.stop.resize","stopFixation","_create","_init","_handlerMouseWheel","_destroy","off","find","remove","append","localSession","getLocalSessionParams","pageList","_restoreSession","_centerIFrameAndNoEmptySpace","handlerSelectPage","href","currentPage","_destroyIFrame","_createIFrame","trigger","selectPage","lastLoadPage","load","contents","e","specific","pages","iframe","window","nameIFrame","scrollTop","scroll","top","scrollLeft","left","$iframe","$fittingWrap","closest","css","position","width","size","w","height","h","_saveSession","jQuery"],"mappings":"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","file":"page-manager-visualizator.js","sourcesContent":["(function($){//Модули: getfile, setfile, .xml(), customScrollIFrame\r\n\r\nvar defaultOptions = {\r\n    $mapNavigatorContainer: undefined,\r\n    nameIFrame: \"PP_iframe\",\r\n    pixelsScrollableInSeconds: 2000,\r\n    minWOuterScroll: 23,\r\n    minHOuterScroll: 23,\r\n    minWDraggable: 15,\r\n    minHDraggable: 15,\r\n    minWIFrame: 320,\r\n    minHIFrame: 480,\r\n    responsiveToMovementOfTheCursorInAConfinedSpace: true,\r\n    movementOfTheCursorInAConfinedSpaceSpred: 10,\r\n    \r\n    gorizontalFixation: \"center\",\r\n    verticalFixation: \"top\"\r\n};\r\n\r\nvar pageManagerVisualizator = function($container, sessionModel, options) {\r\n    this._options = options;\r\n    var ____ = this;\r\n    ____.$container = $container;\r\n    \r\n    var customScrollIFrame = new modules.customScrollIFrame($container, this._options);\r\n    var mapNavigatorIFrame = new modules.mapNavigatorIFrame($container, this._options);\r\n    var resizeIFrame = new modules.resizeIFrame($container, this._options);\r\n    var fixationContentAtResize = new modules.fixationContentAtResize($container, this._options);\r\n    \r\n    //Синхронизируем с кастомным скроллом\r\n    customScrollIFrame._initPasteHTML();\r\n    $container.on(\"pmv.load.iframe\", function(){\r\n        customScrollIFrame.reload();\r\n    });\r\n    //Синхронизируем с мап навигатором\r\n    $container.on({\r\n        \"pmv.load.iframe\": mapNavigatorIFrame.reload,\r\n        \"rif.center-iframe\": mapNavigatorIFrame.updateDraggable\r\n    });\r\n    //Синхронизируем с ресайзером\r\n    $container.on(\"pmv.load.iframe\", resizeIFrame.reload);\r\n    //Синхронизируем с фиксатором контента при ресайзе\r\n    $container.on({\r\n        \"pmv.load.iframe\": fixationContentAtResize.reload,\r\n        \"rif.start.resize\": fixationContentAtResize.startFixation,\r\n        \"rif.stop.resize\": fixationContentAtResize.stopFixation\r\n    });\r\n    \r\n    this._create = function() {\r\n        this._init();\r\n        \r\n        //Чтобы скролл работал не только в iFrame Но и во всём блоке\r\n        $container.on('wheel', customScrollIFrame._handlerMouseWheel);\r\n    }\r\n    \r\n    this._destroy = function() {\r\n        //Чтобы скролл работал не только в iFrame Но и во всём блоке\r\n        $container.off('wheel', customScrollIFrame._handlerMouseWheel);\r\n        \r\n        $container.find( \".pmv-outer-wrap\" ).remove();\r\n    }\r\n    \r\n    this._init = function() {\r\n        $container.append('<div class=\"pmv-outer-wrap\"><div class=\"pmv-fitting-wrap\"></div></div>');\r\n        $container.append('<div class=\"pmv-container-bl\"></div><div class=\"pmv-container-bb\"></div><div class=\"pmv-container-br\"></div>');\r\n        //Получем список страниц\r\n        ____.localSession = sessionModel.getLocalSessionParams();\r\n        options.pageList = {};\r\n        ____._restoreSession(\"pagelist\");\r\n        $container.on(\"pmv.load.iframe\", function(){\r\n            ____._restoreSession( \"size_iframe\" );\r\n            ____._restoreSession( \"scroll_iframe\" );\r\n            ____._restoreSession( \"position_iframe\" );\r\n            \r\n            resizeIFrame._centerIFrameAndNoEmptySpace();//И так сработает после всех методов - потому что события выполняються позже (КРОМЕ FIREFOX)\r\n        });\r\n    }\r\n\r\n    this.handlerSelectPage = function(href) {\r\n        ____.currentPage = href;\r\n        ____._destroyIFrame();\r\n        if(href !== null) {\r\n            ____._createIFrame(href);\r\n        }\r\n        $container.trigger(\"pmv.user.changepage\");\r\n    }\r\n    \r\n    this.selectPage = function(href) {\r\n        ____.currentPage = href;\r\n        ____._destroyIFrame();\r\n        if(href !== null) {\r\n            ____._createIFrame(href);\r\n        }\r\n    }\r\n    \r\n    this._createIFrame = function(href) {\r\n        $container.trigger(\"pmv.prepaste.iframe\");\r\n        ____.lastLoadPage = href;\r\n        ____.currentPage = href;\r\n        $container.find( \".pmv-fitting-wrap\" ).append('<iframe id=\"'+(____._options.nameIFrame)+'\" name=\"'+(____._options.nameIFrame)+'\" src=\"'+href+'\" width=\"100%\" height=\"100%\"></iframe>');\r\n        $('#'+(____._options.nameIFrame)).load(function(){\r\n            $container.trigger( \"pmv.load.iframe\");\r\n            $('#'+(____._options.nameIFrame)).contents().find('body').on('click', function(e){\r\n                $(\"body\").trigger( \"click.body.iframe\" );\r\n            });\r\n        });\r\n    }\r\n    \r\n    this._destroyIFrame = function() {\r\n        $( '#'+(____._options.nameIFrame) ).remove();\r\n    }\r\n    \r\n    this._restoreSession = function( specific ) {\r\n        switch( specific ) {\r\n            //Загрузка активной страницы \r\n            case \"pagelist\":\r\n                if( ____.localSession && \"pages\" in ____.localSession ) {\r\n                    ____.selectPage(\"/\" + ____.localSession.pages.currentPage);\r\n                } else {\r\n\r\n                }\r\n                break;\r\n            case \"scroll_iframe\":\r\n                var iframe = window[____._options.nameIFrame];\r\n\r\n                if( ____.localSession && \"iframe\" in ____.localSession ) {\r\n                    $(iframe.window).scrollTop( ____.localSession.iframe.scroll.top );\r\n                    $(iframe.window).scrollLeft( ____.localSession.iframe.scroll.left );\r\n                }\r\n                break;\r\n            case \"position_iframe\":\r\n                var $iframe = $(\"#\"+(____._options.nameIFrame));\r\n                var $fittingWrap = $iframe.closest(\".pmv-fitting-wrap\");\r\n\r\n                if( ____.localSession && \"iframe\" in ____.localSession ) {\r\n                    //доделать чтоб учитывались проценты\r\n                    $fittingWrap.css({\r\n                        left: ____.localSession.iframe.position.top,\r\n                        top: ____.localSession.iframe.position.left\r\n                    });\r\n                }\r\n                break;\r\n            case \"size_iframe\":\r\n                var $iframe = $(\"#\"+(____._options.nameIFrame));\r\n                var $fittingWrap = $iframe.closest(\".pmv-fitting-wrap\");\r\n\r\n                if( ____.localSession && \"iframe\" in ____.localSession ) {\r\n                    $fittingWrap.css({\r\n                        width: ____.localSession.iframe.size.w,\r\n                        height: ____.localSession.iframe.size.h\r\n                    });\r\n                }\r\n                break;\r\n        }\r\n    }\r\n    \r\n    this._saveSession = function() {\r\n        /*if( \"$session\" in ____ ) {\r\n            //Сохраняем страницы (синхронизируем pageList и xml)\r\n                var $pages = ____.$session.find( \" pages\" );\r\n                var pre_href;\r\n                //вставляем которых нет в xml\r\n                for(var href in ____._options.pageList) {\r\n                    var page = ____._options.pageList[href];\r\n                    \r\n                    var $page = $pages.find( \"page[href='\"+(href)+\"']\" );\r\n                    if( $page.size() ) {\r\n                        $page.attr( \"active\", page.active );\r\n                    } else {\r\n                        if( pre_href ) {\r\n                            var $page = $pages.find( \"page[href='\"+(pre_href)+\"']\" );\r\n                            $page.after( '<page href=\"'+(href)+'\" active=\"'+(page.active)+'\" />' );\r\n                        } else {\r\n                            $pages.append( '<page href=\"'+(href)+'\" active=\"'+(page.active)+'\" />' );\r\n                        }\r\n                    }\r\n                    pre_href = href;\r\n                }\r\n                //удаляем которых нет в pageList\r\n                $pages.find( \" page\" ).each(function(){\r\n                    if( !($(this).attr( \"href\" ) in ____._options.pageList) ) {\r\n                        $(this).remove();\r\n                    }\r\n                });\r\n            \r\n            //Сохраняем состояние iFrame (если он есть)\r\n            if( ____._options.nameIFrame in window ) {\r\n                var $thisPage = ____.$session.find( \"pages page[href='\"+(____.lastLoadPage)+\"']\" );\r\n                if( $thisPage.size() ) {\r\n                    var iframe = window[____._options.nameIFrame];\r\n                    var $iframe = $(\"#\"+(____._options.nameIFrame));\r\n                    var $fittingWrap = $iframe.closest(\".pmv-fitting-wrap\");\r\n                    \r\n                    $thisPage\r\n                        .attr( \"scrolltop\", Math.round( $(iframe.window).scrollTop() || 0) )\r\n                        .attr( \"scrollleft\",  Math.round( $(iframe.window).scrollLeft() || 0) )\r\n                        .attr( \"l\", Math.round( $fittingWrap.position().left) )\r\n                        .attr( \"t\", Math.round( $fittingWrap.position().top) )\r\n                        .attr( \"w\", Math.round( $fittingWrap.width()) )\r\n                        .attr( \"h\", Math.round( $fittingWrap.height()) );\r\n                }\r\n            }\r\n            \r\n            //'<\\?xml version=\"1.0\" encoding=\"UTF-8\"\\?>'+\r\n            var resxml = ____.$session.xml().join('');\r\n            \r\n            //Записываем в файл\r\n            $.ajax({\r\n                url: \"sb.php\",\r\n                async: true,\r\n                cache: false,\r\n                type: \"POST\",\r\n                data: ({module: 'setfile', dir: ____._options.urlXML, file_text: resxml, text_encoding: 'UTF-8'})\r\n            });\r\n        }*/\r\n    }\r\n}\r\n\r\n    modules.pageManagerVisualizator = pageManagerVisualizator;\r\n    \r\n})(jQuery);"]}