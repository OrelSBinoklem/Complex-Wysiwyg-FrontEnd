{"version":3,"sources":["js/mylib/page-manager-visualizator/resize-iframe.js"],"names":["$","resizeIFrame","$container","options","this","_options","____","_last_cursor_Y","_last_cursor_X","_create","$iFrame","contents","append","_resize","_cursor_Y","_cursor_X","find","on","_handlerMove","_handlerDown","_handlerUp","window","_handlerResize","nameIFrame","_destroy","remove","off","reload","e","which","ctrlKey","shiftKey","altKey","trigger","$rif","attr","css","display","w","outerWidth","h","outerHeight","w_c","width","h_c","height","Math","round","top","left","_reloadShowDimensions","preventDefault","stop","returnValue","stopPropagation","_centerIFrameAndNoEmptySpace","t","l","$iframe","$fittingWrap","closest","$outerWrap","position","text","screenX","screenY","minWIFrame","minHIFrame","modules","jQuery"],"mappings":"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","file":"resize-iframe.js","sourcesContent":["(function($){//Модули: \r\n\r\nvar defaultOptions = {\r\n    nameIFrame: \"\",\r\n    minWIFrame: 320,\r\n    minHIFrame: 480\r\n};\r\n\r\nvar resizeIFrame = function($container, options) {\r\n    this._options = options;\r\n    var ____ = this;\r\n\r\n    ____._last_cursor_Y = 0;\r\n    ____._last_cursor_X = 0;\r\n\r\n    this._create = function()\r\n    {\r\n        var $iFrame = $(\"#\"+(____._options.nameIFrame)).contents();\r\n        \r\n        $container.append('<div class=\"rif-show-dimensions panel panel-primary\"><div class=\"panel-body\"><span class=\"rif-width btn btn-default btn-lg\">0</span> X <span class=\"rif-height btn btn-default btn-lg\">0</span></div></div>');\r\n        \r\n        //Свойства для навигатора\r\n        ____._resize = false;\r\n        ____._cursor_Y = 0;\r\n        ____._cursor_X = 0;\r\n        \r\n        //Установка обработчиков событий\r\n        $iFrame.find('body').on('mousemove', ____._handlerMove);\r\n        $('body').on('mousemove', ____._handlerMove);\r\n        $('body').on('keydown', ____._handlerDown);\r\n        $iFrame.find('body').on('keydown', ____._handlerDown);\r\n        $('body').on('keyup', ____._handlerUp);\r\n        $iFrame.find('body').on('keyup', ____._handlerUp);\r\n        \r\n        $(window).on('resize', ____._handlerResize);\r\n        $(window[____._options.nameIFrame].window).on('resize', ____._handlerResize);\r\n        \r\n    }\r\n    \r\n    this._destroy = function()\r\n    {\r\n        var $iFrame = $(\"#\"+(____._options.nameIFrame)).contents();\r\n        \r\n        $container.find(\" .rif-show-dimensions\").remove();\r\n        \r\n        $iFrame.find('body').off('mousemove', ____._handlerMove);\r\n        $('body').off('mousemove', ____._handlerMove);\r\n        $('body').off('keydown', ____._handlerDown);\r\n        $iFrame.find('body').off('keydown', ____._handlerDown);\r\n        $('body').off('keyup', ____._handlerUp);\r\n        $iFrame.find('body').off('keyup', ____._handlerUp);\r\n        \r\n        $(window).off('resize', ____._handlerResize);\r\n        $(window[____._options.nameIFrame].window).off('resize', ____._handlerResize);\r\n    }\r\n    \r\n    this.reload = function()\r\n    {\r\n        ____._destroy();\r\n        ____._create();\r\n    }\r\n    \r\n    //Нажатие на комбинацию клавиш\r\n    this._handlerDown = function(e)\r\n    {\r\n        if(e.which == 82 && e.ctrlKey && !e.shiftKey && !e.altKey)\r\n        {\r\n            if(!____._resize) {\r\n                $container.trigger( \"rif.start.resize\" );\r\n                //Фиксация в пикселах (чтоб меньше багов при расчётах было) и центрирование\r\n                var $rif = $container.find(\" .rif-show-dimensions\");\r\n                $rif\r\n                .attr(\"style\", \"\")\r\n                .css({display: \"block\"});\r\n                var w = $rif.outerWidth();\r\n                var h = $rif.outerHeight();\r\n                var w_c = $container.find(\".pmv-outer-wrap\").width();\r\n                var h_c = $container.find(\".pmv-outer-wrap\").height();\r\n                \r\n                $rif.css({\r\n                    width: Math.round( w ),\r\n                    height: Math.round( h ),\r\n                    top: Math.round( (h_c - h) / 2 ),\r\n                    left: Math.round( (w_c - w) / 2 ),\r\n                });\r\n                \r\n                ____._resize = true;\r\n                ____._cursor_X = false;\r\n                ____._cursor_Y = false;\r\n                \r\n                ____._reloadShowDimensions();\r\n            }\r\n                \r\n            if(e.preventDefault){ e.preventDefault()}\r\n  \t\t    else{e.stop()};\r\n    \t\te.returnValue = false;\r\n    \t\te.stopPropagation();\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    //Отпускание клавиш\r\n    this._handlerUp = function(e)\r\n    {\r\n        if( ____._resize ) {\r\n            var $mnif = $container.find(\" .rif-show-dimensions\");\r\n            $mnif.css({display: \"none\"});\r\n            \r\n            ____._resize = false;\r\n            \r\n            $container.trigger( \"rif.stop.resize\" );\r\n        }\r\n    }\r\n    \r\n    this._handlerResize = function()\r\n    {\r\n        ____._centerIFrameAndNoEmptySpace();\r\n        ____._reloadShowDimensions();\r\n    }\r\n    \r\n    //Центрирование iFrame при ресайзе если он меньше контейнера, а также если рамер iFrame больше чем размер контенера то правый край лепим к правому и нижний к нижнему чтобы небыло пустого пространства\r\n    //нужно для нормальной работы \"map-navigator-iframe\"\r\n    this._centerIFrameAndNoEmptySpace = function()\r\n    {\r\n        var $iframe = $(\"#\"+(____._options.nameIFrame));\r\n        var $fittingWrap = $iframe.closest(\".pmv-fitting-wrap\");\r\n        var $outerWrap = $iframe.closest(\".pmv-outer-wrap\");\r\n        var w, h, w_c, t, l, h_c;\r\n        \r\n        w =   $fittingWrap.width();\r\n        h =   $fittingWrap.height();\r\n        t =   $fittingWrap.position().top;\r\n        l =   $fittingWrap.position().left;\r\n        w_c = $outerWrap.width();\r\n        h_c = $outerWrap.height();\r\n        \r\n        if( w > w_c ) {\r\n            if( (l + w) <  w_c ) {\r\n                $fittingWrap.css({left: Math.round( - w + w_c )});\r\n            }\r\n            //fix\r\n            if( l > 0 ) {\r\n                $fittingWrap.css({left: Math.round( 0 )});\r\n            }\r\n        } else {\r\n            $fittingWrap.css({left: Math.round( (w_c - w) / 2 )});\r\n        }\r\n        \r\n        if( h > h_c ) {\r\n            if( (t + h) <  h_c ) {\r\n                $fittingWrap.css({top: Math.round( - h + h_c )});\r\n            }\r\n        } else {\r\n            $fittingWrap.css({top: 0});\r\n        }\r\n\r\n        $container.trigger(\"rif.center-iframe\");\r\n    }\r\n    \r\n    //Обновление показывателя текущих размеров\r\n    this._reloadShowDimensions = function()\r\n    {\r\n        var $fittingWrap = $(\"#\"+(____._options.nameIFrame)).closest(\".pmv-fitting-wrap\");\r\n        var w =   $fittingWrap.width();\r\n        var h =   $fittingWrap.height();\r\n        \r\n        $container.find(\" .rif-width\").text( Math.round( w ) );\r\n        $container.find(\" .rif-height\").text( Math.round( h ) );\r\n    }\r\n    \r\n    //Обновление размеров IFrame\r\n    this._handlerMove = function(e)\r\n    {\r\n        ____._last_cursor_X = e.screenX;\r\n        ____._last_cursor_Y = e.screenY;\r\n        \r\n        if( ____._resize )\r\n        {\r\n            if(____._cursor_Y === false) {\r\n                ____._cursor_X = ____._last_cursor_X;\r\n                ____._cursor_Y = ____._last_cursor_Y;\r\n            }\r\n            \r\n            var $iframe = $(\"#\"+(____._options.nameIFrame));\r\n            var $fittingWrap = $iframe.closest(\".pmv-fitting-wrap\");\r\n            \r\n            var w =   $fittingWrap.width();\r\n            var h =   $fittingWrap.height();\r\n            \r\n            w += e.screenX - ____._cursor_X;\r\n            h += e.screenY - ____._cursor_Y;\r\n            \r\n            ____._cursor_X = e.screenX;\r\n            ____._cursor_Y = e.screenY;\r\n            \r\n            if(w < ____._options.minWIFrame) {w = ____._options.minWIFrame}\r\n            if(h < ____._options.minHIFrame) {h = ____._options.minHIFrame}\r\n            \r\n            $fittingWrap.css({\r\n                width: Math.round( w ),\r\n                height: Math.round( h )\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodules.resizeIFrame = resizeIFrame;\r\n    \r\n})(jQuery);"]}